<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaria Heroes: Save Nyanja Village</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Quicksand:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');

        :root {
            --hero-blue: #3b82f6;
            --victory-green: #10b981;
            --warning-amber: #f59e0b;
            --danger-red: #ef4444;
            --neutral-slate: #64748b;
            --light-background: #f8fafc;
            --white: #ffffff;
            --clinic-red: #dc2626;
            --school-blue: #3b82f6;
            --market-green: #059669;
            --homes-orange: #ea580c;
            --success-glow: #10b981;
            --error-glow: #ef4444;
            --primary-glow: #3b82f6;
            --gold: #fbbf24;
            --purple: #8b5cf6;
            --pink: #ec4899;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1f2937;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Language Toggle */
        .language-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            background: white;
            border-radius: 25px;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--hero-blue);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            color: var(--neutral-slate);
        }

        .lang-btn.active {
            background: var(--hero-blue);
            color: white;
        }

        .lang-btn:hover:not(.active) {
            background: var(--light-background);
        }

        .lang-btn.reset-btn {
            background: var(--warning-amber);
            color: white;
            margin-left: 0.5rem;
        }

        .lang-btn.reset-btn:hover {
            background: #d97706;
        }

        /* Hindi Text Styling */
        .hindi-text {
            font-family: 'Noto Sans Devanagari', sans-serif;
            font-weight: 500;
        }

        /* Hide inactive language content */
        .lang-content {
            display: none;
        }

        .lang-content.active {
            display: block;
        }

        /* Header Styles */
        .game-header {
            background: linear-gradient(135deg, var(--hero-blue), #1d4ed8, var(--purple));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.4);
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .game-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #fff, #f0f9ff, #e0f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 2s ease-in-out infinite alternate;
            position: relative;
            z-index: 1;
        }

        @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8)); }
        }

        .game-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        /* Stats Bar */
        .stats-container {
            background: white;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .stats-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 0 2rem;
        }

        .stat-card {
            background: var(--light-background);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--hero-blue);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--neutral-slate);
            font-weight: 600;
            margin-top: 0.25rem;
        }

        /* Village Map */
        .village-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        .village-map {
            background: 
                linear-gradient(135deg, #87CEEB 0%, #98FB98 30%, #90EE90 70%, #228B22 100%),
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
            border-radius: 24px;
            padding: 2rem;
            position: relative;
            min-height: 600px;
            box-shadow: 0 20px 50px rgba(22, 163, 74, 0.4);
            border: 4px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            animation: mapPulse 6s ease-in-out infinite;
        }

        .village-map::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Sky gradient */
                linear-gradient(to bottom, rgba(135, 206, 235, 0.3) 0%, transparent 30%),
                /* Ground texture */
                radial-gradient(ellipse at 50% 100%, rgba(139, 69, 19, 0.1) 0%, transparent 60%),
                /* Path lines */
                linear-gradient(45deg, transparent 48%, rgba(139, 69, 19, 0.2) 49%, rgba(139, 69, 19, 0.2) 51%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(139, 69, 19, 0.2) 49%, rgba(139, 69, 19, 0.2) 51%, transparent 52%),
                /* Vegetation spots */
                radial-gradient(circle at 20% 30%, rgba(34, 139, 34, 0.2) 0%, transparent 15%),
                radial-gradient(circle at 80% 70%, rgba(34, 139, 34, 0.2) 0%, transparent 15%),
                radial-gradient(circle at 60% 40%, rgba(34, 139, 34, 0.2) 0%, transparent 15%);
            pointer-events: none;
        }

        .village-map::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Trees */
                radial-gradient(circle at 15% 25%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                radial-gradient(circle at 85% 75%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                radial-gradient(circle at 25% 75%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                radial-gradient(circle at 75% 25%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                /* Rocks */
                radial-gradient(circle at 40% 60%, rgba(105, 105, 105, 0.3) 0%, transparent 5%),
                radial-gradient(circle at 70% 40%, rgba(105, 105, 105, 0.3) 0%, transparent 5%);
            pointer-events: none;
        }

        @keyframes mapPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .map-title {
            text-align: center;
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 2rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .location {
            position: absolute;
            width: 140px;
            height: 140px;
            border-radius: 30px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid white;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.8),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .location::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.6s;
        }

        .location:hover::before {
            left: 100%;
        }

        .location::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--gold), var(--victory-green), var(--hero-blue), var(--pink));
            border-radius: 32px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .location:hover::after {
            opacity: 1;
        }

        .location:hover {
            transform: translateY(-12px) scale(1.1) rotateY(5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--gold);
        }

        .location:active {
            transform: translateY(-6px) scale(1.05);
        }

        .location.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        .location.completed {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
        }

        .location.completed::after {
            content: "✓";
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--victory-green);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.1rem;
            border: 3px solid white;
        }

        .location-icon {
            font-size: 4rem;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
            animation: iconFloat 4s ease-in-out infinite;
            position: relative;
        }

        .location:hover .location-icon {
            transform: scale(1.3) rotate(15deg);
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.4));
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-2px) rotate(1deg); }
            50% { transform: translateY(-4px) rotate(0deg); }
            75% { transform: translateY(-2px) rotate(-1deg); }
        }

        .location-name {
            font-weight: 700;
            font-size: 0.75rem;
            text-align: center;
            line-height: 1.2;
        }

        .priority-badge {
            position: absolute;
            top: -8px;
            left: -8px;
            background: var(--danger-red);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            border: 3px solid white;
        }

        /* Location positioning - spread across all corners */
        .clinic { top: 10%; right: 10%; }
        .clinic .location-icon { color: var(--clinic-red); }

        .school { top: 10%; left: 10%; }
        .school .location-icon { color: var(--school-blue); }

        .market { bottom: 10%; right: 10%; }
        .market .location-icon { color: var(--market-green); }

        .homes { bottom: 10%; left: 10%; }
        .homes .location-icon { color: var(--homes-orange); }

        /* Mission Panel */
        .mission-panel {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
            border: 2px solid var(--hero-blue);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--hero-blue);
            text-align: center;
            font-family: 'Fredoka', sans-serif;
        }

        .emergency-alert {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid var(--danger-red);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .alert-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-title {
            font-weight: 700;
            color: var(--danger-red);
            font-size: 1.1rem;
        }

        .current-mission {
            background: var(--light-background);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .mission-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .mission-title {
            font-weight: 700;
            color: var(--hero-blue);
            font-size: 1.1rem;
        }

        /* Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            max-width: 900px;
            width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-background);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .close-btn {
            background: var(--danger-red);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: scale(1.1);
        }

        /* Mission Content */
        .mission-intro {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid var(--hero-blue);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .npc-dialogue {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .npc-avatar {
            width: 80px;
            height: 80px;
            background: var(--hero-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            flex-shrink: 0;
        }

        .dialogue-bubble {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            flex: 1;
            border: 2px solid var(--light-background);
            position: relative;
        }

        .dialogue-bubble::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 30px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-right: 12px solid white;
            border-bottom: 10px solid transparent;
        }

        .npc-name {
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
        }

        /* Challenge Section */
        .challenge-section {
            background: var(--light-background);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .challenge-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 1rem;
            text-align: center;
            font-family: 'Fredoka', sans-serif;
        }

        .challenge-description {
            color: var(--neutral-slate);
            margin-bottom: 2rem;
            text-align: center;
            line-height: 1.6;
        }

        /* Option Grids */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .option-card {
            background: white;
            border: 2px solid var(--light-background);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .option-card.selected {
            border-color: var(--hero-blue);
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
        }

        .option-card.correct {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .option-card.incorrect {
            border-color: var(--danger-red);
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
        }

        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .option-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.95rem;
        }

        /* Student Grid for School */
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .student-card {
            background: white;
            border: 2px solid var(--light-background);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .student-card.protected {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .student-card.high-risk {
            border-color: var(--danger-red);
        }

        .student-card.medium-risk {
            border-color: var(--warning-amber);
        }

        .student-card.low-risk {
            border-color: var(--victory-green);
        }

        .bed-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .student-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .student-age {
            font-size: 0.85rem;
            color: var(--neutral-slate);
        }

        /* Compound Map for Homes */
        .compound-container {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 20px;
            padding: 1rem;
            margin: 2rem 0;
            position: relative;
            height: 400px;
            width: 100%;
            border: 3px solid var(--warning-amber);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 20px, transparent 20px),
                radial-gradient(circle at 80% 20%, rgba(34, 197, 94, 0.1) 15px, transparent 15px),
                radial-gradient(circle at 60% 70%, rgba(245, 158, 11, 0.1) 25px, transparent 25px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .compound-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .compound-title {
            text-align: center;
            font-weight: 700;
            color: var(--homes-orange);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .breeding-progress {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            border: 2px solid var(--warning-amber);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .breeding-progress:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .progress-item {
            text-align: center;
        }

        .progress-number {
            font-size: 1.8rem;
            font-weight: 800;
            display: block;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .progress-number:hover {
            transform: scale(1.1);
        }

        .progress-number.found { color: var(--victory-green); }
        .progress-number.attempts { color: var(--danger-red); }
        .progress-number.target { color: var(--warning-amber); }
        .progress-number.score { color: var(--hero-blue); }

        .progress-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--neutral-slate);
        }

        .breeding-site {
            position: absolute;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            border: 2px solid var(--light-background);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }

        .breeding-site::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.5s;
        }

        .breeding-site:hover::before {
            left: 100%;
        }

        .breeding-site:hover {
            transform: scale(1.2) rotateY(5deg);
            border-color: var(--gold);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(248, 250, 252, 1) 100%);
        }

        .breeding-site.correct {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            animation: correctPulse 1s ease-out;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }

        .breeding-site.incorrect {
            border-color: var(--danger-red);
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            animation: incorrectShake 0.6s ease-out;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        @keyframes correctPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7); }
            70% { transform: scale(1.2); box-shadow: 0 0 0 10px rgba(22, 163, 74, 0); }
            100% { transform: scale(1.15); box-shadow: 0 0 0 0 rgba(22, 163, 74, 0); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Particle effects */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gold);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 2s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        /* Celebration animation */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--gold);
            animation: confettiFall 3s linear forwards;
        }

        .confetti:nth-child(odd) {
            background: var(--victory-green);
        }

        .confetti:nth-child(3n) {
            background: var(--hero-blue);
        }

        .confetti:nth-child(4n) {
            background: var(--pink);
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Breeding site positions - properly contained within compound */
        .site-1 { top: 30px; left: 30px; }
        .site-2 { top: 30px; left: 90px; }
        .site-3 { top: 30px; left: 150px; }
        .site-4 { top: 30px; left: 210px; }
        .site-5 { top: 90px; left: 30px; }
        .site-6 { top: 90px; left: 90px; }
        .site-7 { top: 90px; left: 150px; }
        .site-8 { top: 90px; left: 210px; }
        .site-9 { top: 150px; left: 30px; }
        .site-10 { top: 150px; left: 90px; }
        .site-11 { top: 150px; left: 150px; }
        .site-12 { top: 150px; left: 210px; }

        /* Help Panel */
        .help-panel {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid var(--hero-blue);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 2rem 0;
            display: none;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
            transition: all 0.3s ease;
        }

        .help-panel.show {
            display: block;
            animation: slideDown 0.5s ease;
            box-shadow: 0 12px 35px rgba(37, 99, 235, 0.25);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .help-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 1rem;
        }

        /* Action Buttons */
        .action-btn {
            background: linear-gradient(135deg, var(--victory-green), #16a34a);
            color: white;
            border: none;
            padding: 1.4rem 3rem;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 2rem auto;
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);
            font-family: 'Quicksand', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(22, 163, 74, 0.4);
            background: linear-gradient(135deg, #16a34a, var(--victory-green));
        }

        .action-btn:disabled {
            background: var(--neutral-slate);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Feedback Panels */
        .feedback-panel {
            background: var(--light-background);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            display: none;
        }

        .feedback-panel.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .feedback-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .feedback-icon.success {
            background: var(--victory-green);
            color: white;
        }

        .feedback-icon.warning {
            background: var(--warning-amber);
            color: white;
        }

        .feedback-icon.error {
            background: var(--danger-red);
            color: white;
        }

        .feedback-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .feedback-title.success { color: var(--victory-green); }
        .feedback-title.warning { color: var(--warning-amber); }
        .feedback-title.error { color: var(--danger-red); }

        /* Completion Modal */
        .completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .completion-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .completion-content {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            max-width: 800px;
            width: 95vw;
            text-align: center;
            transform: scale(0.8);
            transition: all 0.5s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .completion-modal.show .completion-content {
            transform: scale(1);
        }

        .completion-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--victory-green);
            margin-bottom: 1rem;
            font-family: 'Fredoka', sans-serif;
        }

        .completion-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .completion-stat {
            background: var(--light-background);
            border-radius: 16px;
            padding: 2rem;
        }

        .completion-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .completion-label {
            font-weight: 600;
            color: var(--neutral-slate);
        }

        /* Certificate Styles */
        .certificate-modal {
            z-index: 3000;
        }

        .certificate-container {
            border: 4px solid var(--hero-blue);
            border-radius: 16px;
            padding: 2rem;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            position: relative;
            min-height: 400px;
        }

        .certificate-decorations {
            position: absolute;
            font-size: 2rem;
        }

        .cert-trophy { top: 10px; right: 10px; }
        .cert-globe { top: 10px; left: 10px; }
        .cert-mosquito { bottom: 10px; right: 10px; }
        .cert-medical { bottom: 10px; left: 10px; }

        .certificate-title {
            color: var(--hero-blue);
            font-size: 2.5rem;
            margin: 1rem 0;
            font-family: 'Fredoka', sans-serif;
        }

        .certificate-subtitle {
            color: var(--victory-green);
            font-family: 'Quicksand', sans-serif;
            margin: 1rem 0;
            font-size: 1.5rem;
        }

        .certificate-name {
            color: var(--hero-blue);
            font-size: 2rem;
            margin: 1rem 0;
            border-bottom: 2px solid var(--hero-blue);
            display: inline-block;
            padding: 0.5rem 1rem;
            min-width: 300px;
        }

        .certificate-stats {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 12px;
        }

        .cert-stat {
            text-align: center;
        }

        .cert-stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .cert-stat-number.lives { color: var(--victory-green); }
        .cert-stat-number.points { color: var(--hero-blue); }
        .cert-stat-number.success { color: var(--warning-amber); }

        .cert-stat-label {
            font-size: 0.9rem;
            color: var(--neutral-slate);
        }

        .certificate-footer {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: var(--neutral-slate);
        }

        .certificate-signature {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
        }

        .signature-line {
            border-top: 2px solid var(--hero-blue);
            width: 200px;
            text-align: center;
            padding-top: 0.5rem;
        }

        .signature-title {
            font-size: 0.8rem;
            color: var(--neutral-slate);
        }

        .name-input {
            padding: 0.75rem 1rem;
            border: 2px solid var(--hero-blue);
            border-radius: 8px;
            font-size: 1rem;
            width: 300px;
            text-align: center;
            margin: 1rem 0;
        }

        .cert-buttons {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cert-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cert-btn.generate {
            background: var(--hero-blue);
            color: white;
        }

        .cert-btn.download {
            background: var(--victory-green);
            color: white;
        }

        .cert-btn.close {
            background: var(--neutral-slate);
            color: white;
        }

        .cert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Tutorial System */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tutorial-overlay.active {
            display: flex;
            opacity: 1;
        }

        .tutorial-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
            position: relative;
        }

        .tutorial-overlay.active .tutorial-card {
            transform: scale(1);
        }

        .tutorial-mascot {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: mascotBounce 2s ease-in-out infinite;
        }

        @keyframes mascotBounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .tutorial-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 1rem;
            font-family: 'Fredoka', sans-serif;
        }

        .tutorial-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #374151;
            margin-bottom: 2rem;
        }

        .tutorial-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: background 0.3s ease;
        }

        .progress-dot.active {
            background: var(--hero-blue);
        }

        .tutorial-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tutorial-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tutorial-btn.primary {
            background: var(--hero-blue);
            color: white;
        }

        .tutorial-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .tutorial-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .tutorial-highlight {
            position: absolute;
            border: 3px solid var(--gold);
            border-radius: 12px;
            background: rgba(251, 191, 36, 0.1);
            pointer-events: none;
            animation: highlightPulse 2s ease-in-out infinite;
        }

        @keyframes highlightPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
        }

        .help-icon {
            position: fixed;
            top: 20px;
            right: 80px;
            width: 50px;
            height: 50px;
            background: var(--hero-blue);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .help-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        /* Expandable Feedback Sections */
        .expandable-section {
            margin: 1rem 0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .expandable-header {
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
            padding: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .expandable-header:hover {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }

        .expandable-title {
            font-weight: 600;
            color: var(--hero-blue);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .expand-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }

        .expandable-header.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
            border-radius: 0 0 12px 12px;
        }

        .expandable-content.expanded {
            max-height: 500px;
        }

        .expandable-body {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .fact-box {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-left: 4px solid var(--victory-green);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .fact-box h4 {
            color: var(--victory-green);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .stat-highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--warning-amber);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .stat-highlight h4 {
            color: var(--warning-amber);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .real-world-example {
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
            border-left: 4px solid var(--hero-blue);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .real-world-example h4 {
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        /* Glossary System */
        .glossary-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .glossary-overlay.active {
            display: flex;
            opacity: 1;
        }

        .glossary-panel {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .glossary-overlay.active .glossary-panel {
            transform: scale(1);
        }

        .glossary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .glossary-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .glossary-search {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
        }

        .glossary-search:focus {
            outline: none;
            border-color: var(--hero-blue);
        }

        .glossary-term {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid var(--hero-blue);
        }

        .term-title {
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .term-simple {
            color: #374151;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .term-medical {
            color: #6b7280;
            font-size: 0.9rem;
            font-style: italic;
        }

        .glossary-icon {
            position: fixed;
            top: 80px;
            right: 80px;
            width: 50px;
            height: 50px;
            background: var(--victory-green);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .glossary-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        /* Mini-Games System */
        .minigame-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .minigame-overlay.active {
            display: flex;
            opacity: 1;
        }

        .minigame-panel {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .minigame-overlay.active .minigame-panel {
            transform: scale(1);
        }

        .minigame-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .minigame-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
            font-family: 'Fredoka', sans-serif;
        }

        .minigame-description {
            color: #6b7280;
            font-size: 1rem;
        }

        .minigame-content {
            margin-bottom: 2rem;
        }

        /* Mosquito Life Cycle Game */
        .lifecycle-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }

        .lifecycle-stage {
            background: #f8fafc;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .lifecycle-stage.drag-over {
            border-color: var(--hero-blue);
            background: #eff6ff;
        }

        .lifecycle-stage.correct {
            border-color: var(--victory-green);
            background: #f0fdf4;
        }

        .lifecycle-stage.incorrect {
            border-color: var(--clinic-red);
            background: #fef2f2;
        }

        .lifecycle-item {
            background: white;
            border: 2px solid var(--hero-blue);
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .lifecycle-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .lifecycle-item:active {
            cursor: grabbing;
        }

        .lifecycle-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        /* Bed Net Placement Game */
        .bednet-house {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem 0;
            position: relative;
            min-height: 300px;
        }

        .bednet-room {
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem;
            position: relative;
            min-height: 80px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bednet-room:hover {
            border-color: var(--hero-blue);
            background: #f8fafc;
        }

        .bednet-room.has-net {
            border-color: var(--victory-green);
            background: #f0fdf4;
        }

        .bednet-net {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--victory-green);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .bednet-inventory {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            justify-content: center;
        }

        .bednet-item {
            background: var(--victory-green);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .bednet-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .bednet-item:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Timer */
        .minigame-timer {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: 700;
            color: var(--warning-amber);
        }

        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--victory-green), var(--warning-amber), var(--clinic-red));
            transition: width 0.1s ease;
        }

        /* Score Display */
        .minigame-score {
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--hero-blue);
        }

        /* Mini-game buttons */
        .minigame-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .minigame-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .minigame-btn.primary {
            background: var(--hero-blue);
            color: white;
        }

        .minigame-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .minigame-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f3f4f6;
            color: var(--clinic-red);
        }

        /* Completion Modal */
        .completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .completion-modal.active {
            display: flex !important;
            opacity: 1 !important;
        }

        .completion-content {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 24px;
            padding: 3rem;
            max-width: 600px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            transform: scale(0.7) rotateY(15deg);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid var(--victory-green);
            position: relative;
            z-index: 10000;
        }

        .completion-modal.active .completion-content {
            transform: scale(1) rotateY(0deg);
        }

        .completion-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--victory-green);
            margin-bottom: 1rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 0 4px 8px rgba(34, 197, 94, 0.3);
        }

        .completion-text {
            font-size: 1.2rem;
            color: var(--neutral-slate);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .completion-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .completion-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .completion-btn.primary {
            background: var(--hero-blue);
            color: white;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
        }

        .completion-btn.secondary {
            background: var(--victory-green);
            color: white;
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.3);
        }

        .completion-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Certificate Modal */
        .certificate-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .certificate-modal.active {
            display: flex;
            opacity: 1;
        }

        .certificate-container {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 24px;
            padding: 3rem;
            max-width: 800px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            transform: scale(0.7);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid var(--victory-green);
        }

        .certificate-modal.active .certificate-container {
            transform: scale(1);
        }
        @media (max-width: 768px) {
            .village-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .village-map {
                min-height: 400px;
            }

            .location {
                width: 80px;
                height: 80px;
            }

            /* Mobile location positioning */
            .clinic { top: 10%; left: 10%; }
            .school { top: 10%; right: 10%; }
            .market { bottom: 10%; left: 10%; }
            .homes { bottom: 10%; right: 10%; }

            .location-icon {
                font-size: 2rem;
            }

            .breeding-site {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
            }

            .compound-container {
                height: 400px;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .student-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .cert-buttons {
                flex-direction: column;
                align-items: center;
            }

            .certificate-name {
                font-size: 1.5rem;
                min-width: 250px;
            }

            .certificate-stats {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Language Toggle -->
    <div class="language-toggle">
        <button class="lang-btn active" onclick="switchLanguage('en')" data-lang="en">🇬🇧 English</button>
        <button class="lang-btn" onclick="switchLanguage('hi')" data-lang="hi">🇮🇳 हिन्दी</button>
        <button class="lang-btn reset-btn" onclick="resetGame()" title="Reset Game">🔄 Reset</button>
    </div>

    <!-- Help Icon -->
    <button class="help-icon" onclick="startTutorial()" title="Help & Tutorial">?</button>

    <!-- Glossary Icon -->
    <button class="glossary-icon" onclick="openGlossary()" title="Medical Terms Glossary">📖</button>

    <!-- Game Header -->
    <header class="game-header">
        <!-- English Header -->
        <div class="lang-content active" data-lang="en">
            <h1 class="game-title">🌍 Malaria Heroes</h1>
            <p class="game-subtitle">Emergency Response Training • Save Nyanja Village</p>
        </div>
        <!-- Hindi Header -->
        <div class="lang-content hindi-text" data-lang="hi">
            <h1 class="game-title">🌍 मलेरिया वीर</h1>
            <p class="game-subtitle">आपातकालीन प्रतिक्रिया प्रशिक्षण • न्यांजा गांव को बचाएं</p>
        </div>
    </header>

    <!-- Stats Container -->
    <div class="stats-container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="livesProtected">0</div>
                <!-- English -->
                <div class="stat-label lang-content active" data-lang="en">Lives Protected</div>
                <!-- Hindi -->
                <div class="stat-label lang-content hindi-text" data-lang="hi">संरक्षित जीवन</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="knowledgePoints">0</div>
                <!-- English -->
                <div class="stat-label lang-content active" data-lang="en">Knowledge Points</div>
                <!-- Hindi -->
                <div class="stat-label lang-content hindi-text" data-lang="hi">ज्ञान अंक</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="missionsCompleted">0</div>
                <!-- English -->
                <div class="stat-label lang-content active" data-lang="en">Missions Completed</div>
                <!-- Hindi -->
                <div class="stat-label lang-content hindi-text" data-lang="hi">पूर्ण मिशन</div>
            </div>
        </div>
    </div>

    <!-- Village Container -->
    <div class="village-container">
        <!-- Village Map -->
        <div class="village-map">
            <!-- English Title -->
            <h2 class="map-title lang-content active" data-lang="en">🏘️ Nyanja Village Emergency Response</h2>
            <!-- Hindi Title -->
            <h2 class="map-title lang-content hindi-text" data-lang="hi">🏘️ न्यांजा गांव आपातकालीन प्रतिक्रिया</h2>
            
            <!-- Emergency Clinic -->
            <div class="location clinic" id="clinic-location" onclick="openMission('clinic')">
                <div class="location-icon">🏥</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Emergency<br>Clinic</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">आपातकालीन<br>क्लिनिक</div>
                <div class="priority-badge">1</div>
            </div>
            
            <!-- Village School -->
            <div class="location school disabled" id="school-location" onclick="openMission('school')">
                <div class="location-icon">🏫</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Village<br>School</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">गांव का<br>विद्यालय</div>
                <div class="priority-badge" style="display: none;">2</div>
            </div>
            
            <!-- Community Market -->
            <div class="location market disabled" id="market-location" onclick="openMission('market')">
                <div class="location-icon">🏪</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Community<br>Market</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">सामुदायिक<br>बाजार</div>
                <div class="priority-badge" style="display: none;">3</div>
            </div>
            
            <!-- Family Homes -->
            <div class="location homes disabled" id="homes-location" onclick="openMission('homes')">
                <div class="location-icon">🏠</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Family<br>Compounds</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">पारिवारिक<br>परिसर</div>
                <div class="priority-badge" style="display: none;">4</div>
            </div>
        </div>

        <!-- Mission Panel -->
        <div class="mission-panel">
            <!-- English Panel -->
            <div class="lang-content active" data-lang="en">
                <h2 class="panel-title">📋 Mission Control</h2>
                
                <div class="emergency-alert">
                    <div class="alert-header">
                        <span class="alert-icon">🚨</span>
                        <h3 class="alert-title">Critical Health Emergency</h3>
                    </div>
                    <p>A severe malaria outbreak is spreading rapidly through Nyanja Village. Latest WHO 2024 data shows 597,000 malaria deaths globally with 263 million cases. As a medical expert, you must use scientific knowledge and evidence-based strategies to save lives and prevent further transmission.</p>
                </div>
                
                <div class="current-mission">
                    <div class="mission-header">
                        <span class="alert-icon">🎯</span>
                        <h3 class="mission-title">Current Mission</h3>
                    </div>
                    <p id="current-mission-text">Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!</p>
                </div>
            </div>

            <!-- Hindi Panel -->
            <div class="lang-content hindi-text" data-lang="hi">
                <h2 class="panel-title">📋 मिशन नियंत्रण</h2>
                
                <div class="emergency-alert">
                    <div class="alert-header">
                        <span class="alert-icon">🚨</span>
                        <h3 class="alert-title">गंभीर स्वास्थ्य आपातकाल</h3>
                    </div>
                    <p>न्यांजा गांव में मलेरिया का गंभीर प्रकोप तेजी से फैल रहा है। नवीनतम WHO 2024 आंकड़े 263 मिलियन मामलों के साथ विश्वव्यापी स्तर पर 597,000 मलेरिया मृत्यु दर्शाते हैं। एक चिकित्सा विशेषज्ञ के रूप में, आपको वैज्ञानिक ज्ञान और साक्ष्य-आधारित रणनीतियों का उपयोग करके जीवन बचाना और आगे के संचरण को रोकना होगा।</p>
                </div>
                
                <div class="current-mission">
                    <div class="mission-header">
                        <span class="alert-icon">🎯</span>
                        <h3 class="mission-title">वर्तमान मिशन</h3>
                    </div>
                    <p id="current-mission-text-hi">आपातकालीन क्लिनिक में जाएं जहां एक गंभीर रूप से बीमार 8 वर्षीय रोगी को तत्काल चिकित्सा निदान की आवश्यकता है। जीवन आपकी विशेषज्ञता पर निर्भर है!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mission Modal -->
    <div class="modal" id="mission-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Mission Details</h2>
                <button class="close-btn" onclick="closeMissionModal()">×</button>
            </div>
            <div id="modal-content">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="completion-modal" id="completion-modal">
        <div class="completion-content">
            <!-- English Completion -->
            <div class="lang-content active" data-lang="en">
                <h2 class="completion-title">🏆 Mission Accomplished!</h2>
                <p>Congratulations! You've successfully helped protect Nyanja Village from malaria using scientific evidence and proven medical strategies.</p>
                
                <div class="completion-stats">
                    <div class="completion-stat">
                        <div class="completion-number" id="final-lives">0</div>
                        <div class="completion-label">Lives Protected</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number" id="final-points">0</div>
                        <div class="completion-label">Knowledge Points</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number">100%</div>
                        <div class="completion-label">Village Protected</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="action-btn" onclick="showCertificateModal()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        🎓 Get Certificate
                    </button>
                    <button class="action-btn" onclick="restartGame()">🎮 Play Again</button>
                </div>
            </div>

            <!-- Hindi Completion -->
            <div class="lang-content hindi-text" data-lang="hi">
                <h2 class="completion-title">🏆 मिशन पूर्ण!</h2>
                <p>बधाई हो! आपने वैज्ञानिक साक्ष्य और सिद्ध चिकित्सा रणनीतियों का उपयोग करके न्यांजा गांव को मलेरिया से बचाने में सफलतापूर्वक सहायता की है।</p>
                
                <div class="completion-stats">
                    <div class="completion-stat">
                        <div class="completion-number" id="final-lives-hi">0</div>
                        <div class="completion-label">संरक्षित जीवन</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number" id="final-points-hi">0</div>
                        <div class="completion-label">ज्ञान अंक</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number">100%</div>
                        <div class="completion-label">सुरक्षित गांव</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="action-btn" onclick="showCertificateModal()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        🎓 प्रमाणपत्र प्राप्त करें
                    </button>
                    <button class="action-btn" onclick="restartGame()">🎮 फिर से खेलें</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mini-Games Modal -->
    <div class="minigame-overlay" id="minigame-overlay">
        <div class="minigame-panel">
            <div class="minigame-header">
                <h2 class="minigame-title" id="minigame-title">🦟 Mosquito Life Cycle Match</h2>
                <p class="minigame-description" id="minigame-description">Drag the stages to complete the mosquito life cycle!</p>
            </div>
            
            <div class="minigame-timer">
                <div class="timer-display" id="timer-display">60</div>
                <div class="timer-bar">
                    <div class="timer-progress" id="timer-progress"></div>
                </div>
            </div>
            
            <div class="minigame-score">
                <div class="score-display">Score: <span id="minigame-score">0</span> points</div>
            </div>
            
            <div class="minigame-content" id="minigame-content">
                <!-- Content will be populated by JavaScript -->
            </div>
            
            <div class="minigame-buttons">
                <button class="minigame-btn secondary" onclick="closeMinigame()">Close</button>
                <button class="minigame-btn primary" onclick="startMinigame()" id="minigame-start">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Glossary Modal -->
    <div class="glossary-overlay" id="glossary-overlay">
        <div class="glossary-panel">
            <div class="glossary-header">
                <h2 class="glossary-title">📖 Medical Terms Glossary</h2>
                <button onclick="closeGlossary()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
            </div>
            <input type="text" class="glossary-search" id="glossary-search" placeholder="Search medical terms...">
            <div id="glossary-content">
                <!-- Terms will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="tutorial-overlay" id="tutorial-overlay">
        <div class="tutorial-card">
            <div class="tutorial-mascot" id="tutorial-mascot">🦟</div>
            <h2 class="tutorial-title" id="tutorial-title">Welcome to Malaria Heroes!</h2>
            <div class="tutorial-content" id="tutorial-content">
                You're about to become a malaria prevention expert! This game will teach you how to save lives using real WHO guidelines and scientific evidence.
            </div>
            <div class="tutorial-progress">
                <div class="progress-dot active" id="progress-1"></div>
                <div class="progress-dot" id="progress-2"></div>
                <div class="progress-dot" id="progress-3"></div>
                <div class="progress-dot" id="progress-4"></div>
                <div class="progress-dot" id="progress-5"></div>
            </div>
            <div class="tutorial-buttons">
                <button class="tutorial-btn secondary" onclick="skipTutorial()">Skip Tutorial</button>
                <button class="tutorial-btn primary" onclick="nextTutorialStep()" id="tutorial-next">Let's Start!</button>
            </div>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal certificate-modal" id="certificate-modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; text-align: center;">
            <div class="certificate-container" id="certificate-container">
                <div class="certificate-decorations cert-trophy">🏆</div>
                <div class="certificate-decorations cert-globe">🌍</div>
                <div class="certificate-decorations cert-mosquito">🦟</div>
                <div class="certificate-decorations cert-medical">🩺</div>
                
                <!-- English Certificate -->
                <div class="lang-content active" data-lang="en">
                    <h1 class="certificate-title">Certificate of Achievement</h1>
                    <h2 class="certificate-subtitle">Malaria Heroes Training Program</h2>
                    
                    <div style="margin: 2rem 0; font-size: 1.2rem;">
                        <p style="margin: 0.5rem 0;">This certifies that</p>
                        <div class="certificate-name" id="certificate-name">Player Name</div>
                        <p style="margin: 0.5rem 0;">has successfully completed the Malaria Heroes emergency response training</p>
                    </div>
                </div>

                <!-- Hindi Certificate -->
                <div class="lang-content hindi-text" data-lang="hi">
                    <h1 class="certificate-title">उपलब्धि प्रमाणपत्र</h1>
                    <h2 class="certificate-subtitle">मलेरिया वीर प्रशिक्षण कार्यक्रम</h2>
                    
                    <div style="margin: 2rem 0; font-size: 1.2rem;">
                        <p style="margin: 0.5rem 0;">यह प्रमाणित करता है कि</p>
                        <div class="certificate-name" id="certificate-name-hi">खिलाड़ी का नाम</div>
                        <p style="margin: 0.5rem 0;">ने सफलतापूर्वक मलेरिया वीर आपातकालीन प्रतिक्रिया प्रशिक्षण पूरा किया है</p>
                    </div>
                </div>
                
                <div class="certificate-stats">
                    <div class="cert-stat">
                        <span class="cert-stat-number lives" id="certificate-lives">0</span>
                        <!-- English -->
                        <div class="cert-stat-label lang-content active" data-lang="en">Lives Protected</div>
                        <!-- Hindi -->
                        <div class="cert-stat-label lang-content hindi-text" data-lang="hi">संरक्षित जीवन</div>
                    </div>
                    <div class="cert-stat">
                        <span class="cert-stat-number points" id="certificate-points">0</span>
                        <!-- English -->
                        <div class="cert-stat-label lang-content active" data-lang="en">Knowledge Points</div>
                        <!-- Hindi -->
                        <div class="cert-stat-label lang-content hindi-text" data-lang="hi">ज्ञान अंक</div>
                    </div>
                    <div class="cert-stat">
                        <span class="cert-stat-number success">100%</span>
                        <!-- English -->
                        <div class="cert-stat-label lang-content active" data-lang="en">Mission Success</div>
                        <!-- Hindi -->
                        <div class="cert-stat-label lang-content hindi-text" data-lang="hi">मिशन सफलता</div>
                    </div>
                </div>
                
                <div class="certificate-footer">
                    <!-- English -->
                    <div class="lang-content active" data-lang="en">
                        <p>Issued on <span id="certificate-date"></span></p>
                        <p style="margin-top: 0.5rem;">WHO Malaria Prevention Guidelines • Evidence-Based Training</p>
                    </div>
                    <!-- Hindi -->
                    <div class="lang-content hindi-text" data-lang="hi">
                        <p>जारी करने की तिथि <span id="certificate-date-hi"></span></p>
                        <p style="margin-top: 0.5rem;">WHO मलेरिया रोकथाम दिशानिर्देश • साक्ष्य-आधारित प्रशिक्षण</p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <!-- English -->
                <input type="text" id="player-name-input" class="name-input lang-content active" data-lang="en" placeholder="Enter your name">
                <!-- Hindi -->
                <input type="text" id="player-name-input-hi" class="name-input lang-content hindi-text" data-lang="hi" placeholder="अपना नाम लिखें">
            </div>
            
            <div class="cert-buttons">
                <!-- English -->
                <div class="lang-content active" data-lang="en">
                    <button onclick="generateCertificate()" class="cert-btn generate">Generate Certificate</button>
                    <button onclick="downloadCertificate()" class="cert-btn download">Download PNG</button>
                    <button onclick="closeCertificateModal()" class="cert-btn close">Close</button>
                </div>
                <!-- Hindi -->
                <div class="lang-content hindi-text" data-lang="hi">
                    <button onclick="generateCertificate()" class="cert-btn generate">प्रमाणपत्र बनाएं</button>
                    <button onclick="downloadCertificate()" class="cert-btn download">PNG डाउनलोड करें</button>
                    <button onclick="closeCertificateModal()" class="cert-btn close">बंद करें</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentLanguage: 'en',
            livesProtected: 0,
            knowledgePoints: 0,
            missionsCompleted: 0,
            currentMission: 'clinic',
            completedMissions: []
        };

        // Mission tracking
        let selectedSymptoms = [];
        let protectedStudents = [];
        let selectedEducationMethods = [];
        let foundBreedingSites = [];
        let breedingHelpShown = false;
        let breedingAttempts = 0;

        // Language switching
        function switchLanguage(lang) {
            gameState.currentLanguage = lang;
            
            // Update active language button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide language content
            document.querySelectorAll('.lang-content').forEach(content => {
                content.classList.remove('active');
                if (content.dataset.lang === lang) {
                    content.classList.add('active');
                }
            });
        }

        // Save progress functionality
        function saveProgress() {
            const progressData = {
                gameState: gameState,
                selectedSymptoms: selectedSymptoms,
                protectedStudents: protectedStudents,
                selectedEducationMethods: selectedEducationMethods,
                foundBreedingSites: foundBreedingSites,
                breedingHelpShown: breedingHelpShown,
                breedingAttempts: breedingAttempts,
                timestamp: Date.now()
            };
            
            try {
                localStorage.setItem('malariaHeroesProgress', JSON.stringify(progressData));
                console.log('Progress saved successfully');
                return true;
            } catch (error) {
                console.error('Failed to save progress:', error);
                return false;
            }
        }

        function loadProgress() {
            try {
                const savedData = localStorage.getItem('malariaHeroesProgress');
                if (savedData) {
                    const progressData = JSON.parse(savedData);
                    
                    // Check if save is not too old (7 days)
                    const daysSinceSave = (Date.now() - progressData.timestamp) / (1000 * 60 * 60 * 24);
                    if (daysSinceSave > 7) {
                        localStorage.removeItem('malariaHeroesProgress');
                        return false;
                    }
                    
                    // Restore game state
                    gameState = { ...gameState, ...progressData.gameState };
                    selectedSymptoms = progressData.selectedSymptoms || [];
                    protectedStudents = progressData.protectedStudents || [];
                    selectedEducationMethods = progressData.selectedEducationMethods || [];
                    foundBreedingSites = progressData.foundBreedingSites || [];
                    breedingHelpShown = progressData.breedingHelpShown || false;
                    breedingAttempts = progressData.breedingAttempts || 0;
                    
                    updateStats();
                    updateUI();
                    return true;
                }
            } catch (error) {
                console.error('Failed to load progress:', error);
                localStorage.removeItem('malariaHeroesProgress');
            }
            return false;
        }

        function updateUI() {
            // Update location states based on completed missions
            const locations = ['clinic', 'school', 'market', 'homes'];
            locations.forEach((locationId, index) => {
                const location = document.getElementById(locationId + '-location') || document.querySelector('.' + locationId);
                if (location) {
                    if (gameState.completedMissions.includes(locationId)) {
                        location.classList.add('completed');
                        location.classList.remove('disabled');
                    } else if (index > 0 && !gameState.completedMissions.includes(locations[index - 1])) {
                        location.classList.add('disabled');
                        location.classList.remove('completed');
                    } else if (index === 0) {
                        location.classList.remove('disabled', 'completed');
                    }
                }
            });
            
            // Update current mission text
            const currentMissionText = document.getElementById('current-mission-text');
            const currentMissionTextHi = document.getElementById('current-mission-text-hi');
            
            if (gameState.completedMissions.length === 0) {
                if (currentMissionText) currentMissionText.textContent = 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!';
                if (currentMissionTextHi) currentMissionTextHi.textContent = 'आपातकालीन क्लिनिक में जाएं जहां एक गंभीर रूप से बीमार 8 वर्षीय रोगी को तत्काल चिकित्सा निदान की आवश्यकता है। जीवन आपकी विशेषज्ञता पर निर्भर है!';
            } else if (gameState.completedMissions.length < 4) {
                const nextMission = ['school', 'market', 'homes'][gameState.completedMissions.length - 1];
                const missionTexts = {
                    school: {
                        en: 'Visit the Village School to help protect students from malaria using evidence-based strategies.',
                        hi: 'गांव के विद्यालय में जाएं और साक्ष्य-आधारित रणनीतियों का उपयोग करके छात्रों को मलेरिया से बचाने में मदद करें।'
                    },
                    market: {
                        en: 'Visit the Community Market to educate villagers about malaria prevention methods.',
                        hi: 'सामुदायिक बाजार में जाएं और ग्रामीणों को मलेरिया रोकथाम के तरीकों के बारे में शिक्षित करें।'
                    },
                    homes: {
                        en: 'Visit Family Compounds to identify and eliminate mosquito breeding sites.',
                        hi: 'पारिवारिक परिसरों में जाएं और मच्छर प्रजनन स्थलों की पहचान करें और उन्हें समाप्त करें।'
                    }
                };
                if (currentMissionText) currentMissionText.textContent = missionTexts[nextMission].en;
                if (currentMissionTextHi) currentMissionTextHi.textContent = missionTexts[nextMission].hi;
            }
        }

        // Auto-save progress every 30 seconds
        setInterval(saveProgress, 30000);

        // Save progress on page unload
        window.addEventListener('beforeunload', saveProgress);

        // Translate performance ratings
        function translatePerformance(performance, lang) {
            const translations = {
                en: {
                    'excellent': 'EXCELLENT',
                    'good': 'GOOD',
                    'satisfactory': 'SATISFACTORY',
                    'needs-improvement': 'NEEDS IMPROVEMENT'
                },
                hi: {
                    'excellent': 'उत्कृष्ट',
                    'good': 'अच्छा',
                    'satisfactory': 'संतोषजनक',
                    'needs-improvement': 'सुधार की आवश्यकता'
                }
            };
            return translations[lang][performance] || performance.toUpperCase();
        }

        // Update stats display
        function updateStats() {
            document.getElementById('livesProtected').textContent = gameState.livesProtected;
            document.getElementById('knowledgePoints').textContent = gameState.knowledgePoints;
            document.getElementById('missionsCompleted').textContent = gameState.missionsCompleted;
        }

        // Glossary System
        const glossaryTerms = [
            {
                term: "Vector Control",
                icon: "🦟",
                simple: "Stopping mosquitoes from breeding and spreading disease",
                medical: "Methods to eliminate or reduce disease-carrying organisms"
            },
            {
                term: "WHO (World Health Organization)",
                icon: "🌍",
                simple: "The world's main health authority that creates guidelines for treating diseases",
                medical: "United Nations specialized agency responsible for international public health"
            },
            {
                term: "Mortality Rate",
                icon: "📉",
                simple: "How many people die from a disease",
                medical: "The number of deaths in a population from a specific cause"
            },
            {
                term: "Anopheles Mosquito",
                icon: "🦟",
                simple: "The specific type of mosquito that carries malaria",
                medical: "Genus of mosquitoes that transmit malaria parasites"
            },
            {
                term: "Malaria Parasite",
                icon: "🔬",
                simple: "Tiny organisms that live in mosquitoes and cause malaria",
                medical: "Plasmodium species that infect human red blood cells"
            },
            {
                term: "Bed Net",
                icon: "🛏️",
                simple: "Special netting that protects people from mosquito bites while sleeping",
                medical: "Insecticide-treated netting used for malaria prevention"
            },
            {
                term: "Breeding Site",
                icon: "💧",
                simple: "Places where mosquitoes lay eggs and grow",
                medical: "Standing water locations where mosquito larvae develop"
            },
            {
                term: "Fever",
                icon: "🌡️",
                simple: "When your body temperature is higher than normal",
                medical: "Elevated body temperature above 38°C (100.4°F)"
            },
            {
                term: "Diagnosis",
                icon: "🔍",
                simple: "Finding out what disease someone has",
                medical: "Identification of a disease through examination and testing"
            },
            {
                term: "Prevention",
                icon: "🛡️",
                simple: "Stopping something bad from happening",
                medical: "Actions taken to avoid disease occurrence"
            },
            {
                term: "Epidemic",
                icon: "📈",
                simple: "When many people in an area get the same disease",
                medical: "Rapid spread of disease to many people in a short time"
            },
            {
                term: "Endemic",
                icon: "📍",
                simple: "A disease that is always present in a certain area",
                medical: "Constant presence of a disease in a geographic area"
            },
            {
                term: "Immunity",
                icon: "💪",
                simple: "Your body's ability to fight off diseases",
                medical: "Biological resistance to infectious diseases"
            },
            {
                term: "Transmission",
                icon: "🔄",
                simple: "How a disease spreads from one person to another",
                medical: "Process by which infectious agents are spread"
            },
            {
                term: "Treatment",
                icon: "💊",
                simple: "Medicine or care given to make someone better",
                medical: "Medical intervention to cure or manage disease"
            }
        ];

        function openGlossary() {
            document.getElementById('glossary-overlay').classList.add('active');
            populateGlossary();
        }

        function closeGlossary() {
            document.getElementById('glossary-overlay').classList.remove('active');
        }

        function populateGlossary() {
            const content = document.getElementById('glossary-content');
            content.innerHTML = '';
            
            glossaryTerms.forEach(term => {
                const termDiv = document.createElement('div');
                termDiv.className = 'glossary-term';
                termDiv.innerHTML = `
                    <div class="term-title">
                        <span>${term.icon}</span>
                        ${term.term}
                    </div>
                    <div class="term-simple">${term.simple}</div>
                    <div class="term-medical">Medical: ${term.medical}</div>
                `;
                content.appendChild(termDiv);
            });

            // Add search functionality
            const searchInput = document.getElementById('glossary-search');
            searchInput.addEventListener('input', filterGlossary);
        }

        function filterGlossary() {
            const searchTerm = document.getElementById('glossary-search').value.toLowerCase();
            const terms = document.querySelectorAll('.glossary-term');
            
            terms.forEach(term => {
                const text = term.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    term.style.display = 'block';
                } else {
                    term.style.display = 'none';
                }
            });
        }

        // Expandable Feedback Functions
        function createExpandableSection(title, content, icon = "🔬") {
            const section = document.createElement('div');
            section.className = 'expandable-section';
            section.innerHTML = `
                <div class="expandable-header" onclick="toggleExpandable(this)">
                    <div class="expandable-title">
                        <span>${icon}</span>
                        ${title}
                    </div>
                    <span class="expand-icon">▼</span>
                </div>
                <div class="expandable-content">
                    <div class="expandable-body">
                        ${content}
                    </div>
                </div>
            `;
            return section;
        }

        function toggleExpandable(header) {
            const content = header.nextElementSibling;
            const isExpanded = header.classList.contains('expanded');
            
            if (isExpanded) {
                header.classList.remove('expanded');
                content.classList.remove('expanded');
            } else {
                header.classList.add('expanded');
                content.classList.add('expanded');
            }
        }

        // Mini-Games System
        let currentMinigame = null;
        let minigameTimer = null;
        let minigameScore = 0;
        let minigameTimeLeft = 60;

        const minigames = {
            lifecycle: {
                title: '🦟 Mosquito Life Cycle Match',
                description: 'Drag the stages to complete the mosquito life cycle! Learn how to interrupt breeding.',
                stages: [
                    { id: 'egg', name: 'Egg Stage', icon: '🥚', description: 'Mosquito eggs laid in standing water' },
                    { id: 'larva', name: 'Larva Stage', icon: '🐛', description: 'Baby mosquito swimming in water' },
                    { id: 'pupa', name: 'Pupa Stage', icon: '🦟', description: 'Mosquito transforming (no butterfly emoji available)' },
                    { id: 'adult', name: 'Adult Stage', icon: '🦟', description: 'Flying mosquito ready to bite' }
                ],
                correctOrder: ['egg', 'larva', 'pupa', 'adult'],
                educationalContent: {
                    en: {
                        egg: 'Eggs are laid in standing water and hatch in 2-3 days. Remove standing water to prevent this stage.',
                        larva: 'Larvae live in water for 7-10 days, feeding on microorganisms. They breathe through a tube.',
                        pupa: 'Pupae don\'t eat but transform for 2-3 days. This is when mosquitoes are most vulnerable.',
                        adult: 'Adult mosquitoes emerge and can fly. Females need blood meals to lay eggs.'
                    },
                    hi: {
                        egg: 'अंडे स्थिर पानी में रखे जाते हैं और 2-3 दिनों में फूटते हैं। इस चरण को रोकने के लिए स्थिर पानी हटाएं।',
                        larva: 'लार्वा 7-10 दिनों तक पानी में रहते हैं, सूक्ष्मजीवों पर भोजन करते हैं। वे एक नली के माध्यम से सांस लेते हैं।',
                        pupa: 'प्यूपा भोजन नहीं करते लेकिन 2-3 दिनों तक रूपांतरित होते हैं। यह वह समय है जब मच्छर सबसे कमजोर होते हैं।',
                        adult: 'वयस्क मच्छर निकलते हैं और उड़ सकते हैं। मादाओं को अंडे देने के लिए रक्त भोजन की आवश्यकता होती है।'
                    }
                }
            },
            bednet: {
                title: '🛏️ Bed Net Placement Puzzle',
                description: 'Place bed nets correctly to protect sleeping areas!',
                rooms: [
                    { id: 'bedroom1', name: 'Master Bedroom', hasNet: false, correct: true },
                    { id: 'bedroom2', name: 'Children\'s Room', hasNet: false, correct: true },
                    { id: 'livingroom', name: 'Living Room', hasNet: false, correct: false },
                    { id: 'kitchen', name: 'Kitchen', hasNet: false, correct: false }
                ]
            }
        };

        function openMinigame(gameType) {
            currentMinigame = gameType;
            const game = minigames[gameType];
            
            document.getElementById('minigame-title').textContent = game.title;
            document.getElementById('minigame-description').textContent = game.description;
            document.getElementById('minigame-overlay').classList.add('active');
            
            setupMinigame(gameType);
        }

        function closeMinigame() {
            document.getElementById('minigame-overlay').classList.remove('active');
            if (minigameTimer) {
                clearInterval(minigameTimer);
                minigameTimer = null;
            }
            minigameScore = 0;
            minigameTimeLeft = 60;
        }

        function setupMinigame(gameType) {
            const content = document.getElementById('minigame-content');
            content.innerHTML = '';
            
            if (gameType === 'lifecycle') {
                setupLifecycleGame(content);
            } else if (gameType === 'bednet') {
                setupBednetGame(content);
            }
        }

        function setupLifecycleGame(content) {
            const game = minigames.lifecycle;
            const lang = gameState.currentLanguage;
            
            // Add educational introduction
            const intro = document.createElement('div');
            intro.style.background = '#f0f9ff';
            intro.style.padding = '1rem';
            intro.style.borderRadius = '12px';
            intro.style.marginBottom = '1rem';
            intro.innerHTML = `
                <h4 style="color: var(--hero-blue); margin-bottom: 0.5rem;">🔬 Public Health Education</h4>
                <p style="margin-bottom: 0.5rem;">${lang === 'en' ? 
                    'Understanding the mosquito life cycle helps us know when to interrupt breeding. Each stage has different vulnerabilities we can target.' :
                    'मच्छर के जीवन चक्र को समझने से हमें पता चलता है कि प्रजनन को कब बाधित करना है। प्रत्येक चरण में अलग-अलग कमजोरियां हैं जिन्हें हम लक्षित कर सकते हैं।'}</p>
                <p style="font-size: 0.9rem; color: #6b7280;">${lang === 'en' ? 
                    'Drag each stage to its correct position in the life cycle.' :
                    'जीवन चक्र में प्रत्येक चरण को उसकी सही स्थिति में खींचें।'}</p>
            `;
            content.appendChild(intro);
            
            // Create drop zones
            const dropZones = document.createElement('div');
            dropZones.className = 'lifecycle-container';
            
            game.stages.forEach((stage, index) => {
                const zone = document.createElement('div');
                zone.className = 'lifecycle-stage';
                zone.id = `zone-${stage.id}`;
                zone.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">${index + 1}. ${stage.name}</div>
                    <div style="font-size: 0.9rem; color: #6b7280;">${lang === 'en' ? 'Drop here' : 'यहाँ छोड़ें'}</div>
                `;
                dropZones.appendChild(zone);
            });
            
            // Create draggable items
            const items = document.createElement('div');
            items.style.display = 'flex';
            items.style.flexWrap = 'wrap';
            items.style.gap = '1rem';
            items.style.justifyContent = 'center';
            items.style.marginTop = '1rem';
            
            // Shuffle stages for challenge
            const shuffledStages = [...game.stages].sort(() => Math.random() - 0.5);
            
            shuffledStages.forEach(stage => {
                const item = document.createElement('div');
                item.className = 'lifecycle-item';
                item.draggable = true;
                item.id = `item-${stage.id}`;
                item.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">${stage.icon}</div>
                    <div style="font-weight: 600;">${stage.name}</div>
                `;
                
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', stage.id);
                    item.classList.add('dragging');
                });
                
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                });
                
                items.appendChild(item);
            });
            
            content.appendChild(dropZones);
            content.appendChild(items);
            
            // Add drop event listeners
            document.querySelectorAll('.lifecycle-stage').forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('drag-over');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    
                    const stageId = e.dataTransfer.getData('text/plain');
                    const item = document.getElementById(`item-${stageId}`);
                    const stage = game.stages.find(s => s.id === stageId);
                    
                    // Check if correct
                    const correctStage = game.stages.find(s => s.id === zone.id.replace('zone-', ''));
                    const isCorrect = stageId === correctStage.id;
                    
                    if (isCorrect) {
                        zone.classList.add('correct');
                        zone.innerHTML = `
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">${correctStage.name}</div>
                            <div style="font-size: 2rem;">${stage.icon}</div>
                        `;
                        item.style.display = 'none';
                        minigameScore += 25;
                        updateMinigameScore();
                        playSound('correct');
                        
                        // Show educational content
                        showEducationalContent(stageId, lang);
                        
                        // Check if game complete
                        if (document.querySelectorAll('.lifecycle-stage.correct').length === 4) {
                            completeMinigame();
                        }
                    } else {
                        zone.classList.add('incorrect');
                        setTimeout(() => {
                            zone.classList.remove('incorrect');
                        }, 1000);
                        playSound('incorrect');
                    }
                });
            });
        }

        function showEducationalContent(stageId, lang) {
            const game = minigames.lifecycle;
            const content = game.educationalContent[lang][stageId];
            
            // Create educational popup
            const popup = document.createElement('div');
            popup.style.position = 'fixed';
            popup.style.top = '50%';
            popup.style.left = '50%';
            popup.style.transform = 'translate(-50%, -50%)';
            popup.style.background = 'white';
            popup.style.padding = '1.5rem';
            popup.style.borderRadius = '12px';
            popup.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.3)';
            popup.style.zIndex = '3000';
            popup.style.maxWidth = '400px';
            popup.style.textAlign = 'center';
            popup.innerHTML = `
                <h4 style="color: var(--hero-blue); margin-bottom: 1rem;">${lang === 'en' ? 'Educational Fact' : 'शैक्षिक तथ्य'}</h4>
                <p style="margin-bottom: 1rem;">${content}</p>
                <button onclick="this.parentElement.remove()" style="background: var(--hero-blue); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                    ${lang === 'en' ? 'Continue' : 'जारी रखें'}
                </button>
            `;
            document.body.appendChild(popup);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (popup.parentElement) {
                    popup.remove();
                }
            }, 3000);
        }

        function setupBednetGame(content) {
            const game = minigames.bednet;
            
            // Create house layout
            const house = document.createElement('div');
            house.className = 'bednet-house';
            house.innerHTML = '<h3 style="text-align: center; margin-bottom: 1rem;">🏠 House Layout</h3>';
            
            const roomsContainer = document.createElement('div');
            roomsContainer.style.display = 'grid';
            roomsContainer.style.gridTemplateColumns = 'repeat(2, 1fr)';
            roomsContainer.style.gap = '1rem';
            
            game.rooms.forEach(room => {
                const roomDiv = document.createElement('div');
                roomDiv.className = 'bednet-room';
                roomDiv.id = `room-${room.id}`;
                roomDiv.innerHTML = `
                    <div style="font-weight: 600;">${room.name}</div>
                    <div style="font-size: 0.9rem; color: #6b7280;">Click to place net</div>
                `;
                
                roomDiv.addEventListener('click', () => {
                    if (!room.hasNet) {
                        room.hasNet = true;
                        roomDiv.classList.add('has-net');
                        roomDiv.innerHTML = `
                            <div class="bednet-net">
                                <span>🛏️</span>
                            </div>
                        `;
                        
                        if (room.correct) {
                            minigameScore += 30;
                            playSound('correct');
                        } else {
                            minigameScore -= 10;
                            playSound('incorrect');
                        }
                        updateMinigameScore();
                    }
                });
                
                roomsContainer.appendChild(roomDiv);
            });
            
            house.appendChild(roomsContainer);
            content.appendChild(house);
            
            // Add instructions
            const instructions = document.createElement('div');
            instructions.style.background = '#f0f9ff';
            instructions.style.padding = '1rem';
            instructions.style.borderRadius = '12px';
            instructions.style.marginTop = '1rem';
            instructions.innerHTML = `
                <h4 style="color: var(--hero-blue); margin-bottom: 0.5rem;">💡 Instructions</h4>
                <p>Click on bedrooms to place bed nets. Don't place nets in living areas!</p>
            `;
            content.appendChild(instructions);
        }

        function startMinigame() {
            minigameTimeLeft = 60;
            minigameScore = 0;
            updateMinigameScore();
            updateTimer();
            
            minigameTimer = setInterval(() => {
                minigameTimeLeft--;
                updateTimer();
                
                if (minigameTimeLeft <= 0) {
                    completeMinigame();
                }
            }, 1000);
            
            document.getElementById('minigame-start').style.display = 'none';
        }

        function updateTimer() {
            document.getElementById('timer-display').textContent = minigameTimeLeft;
            const progress = (minigameTimeLeft / 60) * 100;
            document.getElementById('timer-progress').style.width = progress + '%';
        }

        function updateMinigameScore() {
            document.getElementById('minigame-score').textContent = minigameScore;
        }

        function completeMinigame() {
            if (minigameTimer) {
                clearInterval(minigameTimer);
                minigameTimer = null;
            }
            
            // Award bonus points
            const bonusPoints = Math.floor(minigameScore / 10);
            gameState.knowledgePoints += bonusPoints;
            updateStats();
            
            // Show completion message
            const content = document.getElementById('minigame-content');
            content.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">🎉</div>
                    <h3 style="color: var(--victory-green); margin-bottom: 1rem;">Mini-Game Complete!</h3>
                    <p style="font-size: 1.2rem; margin-bottom: 1rem;">You earned <strong>${minigameScore}</strong> points!</p>
                    <p style="color: #6b7280;">Bonus: +${bonusPoints} knowledge points added to your total!</p>
                </div>
            `;
            
            playSound('complete');
            createCelebration();
        }

        // Add mini-game buttons to mission panels
        function addMinigameButtons() {
            const missionPanels = document.querySelectorAll('.mission-panel');
            missionPanels.forEach(panel => {
                const button = document.createElement('button');
                button.className = 'action-btn';
                button.style.marginTop = '1rem';
                button.innerHTML = '🎮 Bonus Challenge';
                button.onclick = () => openMinigame('lifecycle');
                panel.appendChild(button);
            });
        }
        const tutorialSteps = [
            {
                mascot: '🦟',
                title: 'Welcome to Malaria Heroes!',
                content: 'You\'re about to become a malaria prevention expert! This game will teach you how to save lives using real WHO guidelines and scientific evidence.',
                nextText: 'Let\'s Start!'
            },
            {
                mascot: '🗺️',
                title: 'Navigate the Village Map',
                content: 'Click on the location cards to start missions. Each location has different challenges that teach you about malaria prevention.',
                nextText: 'Got It!'
            },
            {
                mascot: '📊',
                title: 'Understanding Your Progress',
                content: 'Watch your stats grow as you complete missions! Knowledge Points show how much you\'ve learned, and Lives Protected shows your real impact.',
                nextText: 'Continue'
            },
            {
                mascot: '🔬',
                title: 'Learn from WHO Guidelines',
                content: 'Every decision you make is based on real scientific evidence. Read the detailed explanations to understand why certain choices save more lives.',
                nextText: 'Almost Done!'
            },
            {
                mascot: '🏆',
                title: 'Ready to Save Nyanja Village!',
                content: 'You\'re all set! Remember: there are no wrong answers here - every choice teaches you something valuable. Let\'s start saving lives!',
                nextText: 'Start Mission!'
            }
        ];

        function startTutorial() {
            tutorialStep = 0;
            showTutorialStep();
            document.getElementById('tutorial-overlay').classList.add('active');
        }

        function showTutorialStep() {
            const step = tutorialSteps[tutorialStep];
            document.getElementById('tutorial-mascot').textContent = step.mascot;
            document.getElementById('tutorial-title').textContent = step.title;
            document.getElementById('tutorial-content').textContent = step.content;
            document.getElementById('tutorial-next').textContent = step.nextText;

            // Update progress dots
            for (let i = 1; i <= 5; i++) {
                const dot = document.getElementById(`progress-${i}`);
                if (i <= tutorialStep + 1) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            }
        }

        function nextTutorialStep() {
            tutorialStep++;
            if (tutorialStep >= tutorialSteps.length) {
                closeTutorial();
            } else {
                showTutorialStep();
            }
        }

        function skipTutorial() {
            closeTutorial();
        }

        function closeTutorial() {
            document.getElementById('tutorial-overlay').classList.remove('active');
            // Mark tutorial as completed
            localStorage.setItem('malariaHeroesTutorialComplete', 'true');
        }

        // Initialize game
        function initializeGame() {
            // Check if we're on GitHub Pages or similar hosting
            const isGitHubHosted = window.location.hostname.includes('github.io') || 
                                  window.location.hostname.includes('github.com') ||
                                  window.location.hostname.includes('pages.dev') ||
                                  window.location.hostname.includes('netlify.app');
            
            // For GitHub hosting, always start fresh and clear any saved progress
            if (isGitHubHosted) {
                localStorage.removeItem('malariaHeroesProgress');
                localStorage.removeItem('malariaHeroesTutorialComplete');
                console.log('GitHub hosting detected - starting fresh game');
                updateStats();
                updateUI();
                
                // Always show tutorial for GitHub hosted games
                setTimeout(() => {
                    startTutorial();
                }, 1000);
                return;
            }
            
            // For local hosting, try to load saved progress
            if (loadProgress()) {
                console.log('Previous progress loaded');
            } else {
                console.log('Starting new game');
                updateStats();
                updateUI();
                
                // Always show tutorial for new games
                setTimeout(() => {
                    startTutorial();
                }, 1000);
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeGame);

        // Open mission modal
        function openMission(missionId) {
            const location = document.getElementById(missionId + '-location') || document.querySelector('.' + missionId);
            
            if (location && location.classList.contains('disabled')) {
                const messages = {
                    en: 'Complete previous missions first!',
                    hi: 'पहले पिछले मिशन पूरे करें!'
                };
                alert(messages[gameState.currentLanguage]);
                return;
            }
            
            if (gameState.completedMissions.includes(missionId)) {
                const messages = {
                    en: 'Mission already completed!',
                    hi: 'मिशन पहले से पूरा है!'
                };
                alert(messages[gameState.currentLanguage]);
                return;
            }

            document.getElementById('mission-modal').classList.add('active');
            loadMissionContent(missionId);
        }

        // Close mission modal
        function closeMissionModal() {
            document.getElementById('mission-modal').classList.remove('active');
        }

        // Load mission content
        function loadMissionContent(missionId) {
            const titles = {
                en: {
                    clinic: '🏥 Emergency Clinic - Patient Diagnosis',
                    school: '🏫 Village School - Student Protection',
                    market: '🏪 Community Market - Health Education',
                    homes: '🏠 Family Compounds - Vector Control'
                },
                hi: {
                    clinic: '🏥 आपातकालीन क्लिनिक - रोगी निदान',
                    school: '🏫 गांव का विद्यालय - छात्र संरक्षण',
                    market: '🏪 सामुदायिक बाजार - स्वास्थ्य शिक्षा',
                    homes: '🏠 पारिवारिक परिसर - वेक्टर नियंत्रण'
                }
            };

            document.getElementById('modal-title').textContent = titles[gameState.currentLanguage][missionId];

            if (missionId === 'clinic') {
                loadClinicMission();
            } else if (missionId === 'school') {
                loadSchoolMission();
            } else if (missionId === 'market') {
                loadMarketMission();
            } else if (missionId === 'homes') {
                loadHomesMission();
            }
        }

        // CLINIC MISSION
        function loadClinicMission() {
            selectedSymptoms = [];
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👨‍⚕️</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">Dr. Kwame Asante - Head of Emergency Medicine</div>
                                <p>"We have a critically ill 8-year-old child with high fever. The symptoms started 3 days ago and are worsening rapidly. I need your expertise to identify which symptoms are consistent with malaria based on WHO clinical guidelines. Every second counts!"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">🩺 Clinical Symptom Assessment</h3>
                        <p class="challenge-description">Select ALL symptoms that are consistent with malaria diagnosis according to WHO 2024 guidelines. Accurate identification is crucial for immediate treatment.</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-symptom="fever" onclick="toggleSymptom('fever')">
                                <div class="option-icon">🌡️</div>
                                <div class="option-name">High fever (39.5°C)</div>
                            </div>
                            <div class="option-card" data-symptom="headache" onclick="toggleSymptom('headache')">
                                <div class="option-icon">🤕</div>
                                <div class="option-name">Severe headache</div>
                            </div>
                            <div class="option-card" data-symptom="chills" onclick="toggleSymptom('chills')">
                                <div class="option-icon">🥶</div>
                                <div class="option-name">Chills and sweats</div>
                            </div>
                            <div class="option-card" data-symptom="nausea" onclick="toggleSymptom('nausea')">
                                <div class="option-icon">🤢</div>
                                <div class="option-name">Nausea and vomiting</div>
                            </div>
                            <div class="option-card" data-symptom="fatigue" onclick="toggleSymptom('fatigue')">
                                <div class="option-icon">😴</div>
                                <div class="option-name">Extreme fatigue</div>
                            </div>
                            <div class="option-card" data-symptom="rash" onclick="toggleSymptom('rash')">
                                <div class="option-icon">🔴</div>
                                <div class="option-name">Skin rash</div>
                            </div>
                            <div class="option-card" data-symptom="cough" onclick="toggleSymptom('cough')">
                                <div class="option-icon">😷</div>
                                <div class="option-name">Persistent cough</div>
                            </div>
                            <div class="option-card" data-symptom="throat" onclick="toggleSymptom('throat')">
                                <div class="option-icon">😣</div>
                                <div class="option-name">Sore throat</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="clinic-feedback"></div>
                        <button class="action-btn" id="clinic-submit" onclick="evaluateClinicDiagnosis()" disabled>🩺 Submit Diagnosis</button>
                        <button class="action-btn" id="clinic-bonus" onclick="openMinigame('lifecycle')" style="margin-top: 1rem; background: var(--victory-green); display: none;">🔬 Educational Challenge: Mosquito Life Cycle</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👨‍⚕️</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">डॉ. क्वामे असांते - आपातकालीन चिकित्सा प्रमुख</div>
                                <p>"हमारे पास तेज बुखार के साथ गंभीर रूप से बीमार 8 साल का बच्चा है। लक्षण 3 दिन पहले शुरू हुए और तेजी से बिगड़ रहे हैं। मुझे आपकी विशेषज्ञता की आवश्यकता है कि WHO नैदानिक दिशानिर्देशों के आधार पर कौन से लक्षण मलेरिया के अनुकूल हैं। हर सेकंड मायने रखता है!"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">🩺 नैदानिक लक्षण मूल्यांकन</h3>
                        <p class="challenge-description">WHO 2024 दिशानिर्देशों के अनुसार मलेरिया निदान के अनुकूल सभी लक्षणों का चयन करें। तत्काल उपचार के लिए सटीक पहचान महत्वपूर्ण है।</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-symptom="fever" onclick="toggleSymptom('fever')">
                                <div class="option-icon">🌡️</div>
                                <div class="option-name">तेज बुखार (39.5°C)</div>
                            </div>
                            <div class="option-card" data-symptom="headache" onclick="toggleSymptom('headache')">
                                <div class="option-icon">🤕</div>
                                <div class="option-name">तीव्र सिरदर्द</div>
                            </div>
                            <div class="option-card" data-symptom="chills" onclick="toggleSymptom('chills')">
                                <div class="option-icon">🥶</div>
                                <div class="option-name">कंपकंपी और पसीना</div>
                            </div>
                            <div class="option-card" data-symptom="nausea" onclick="toggleSymptom('nausea')">
                                <div class="option-icon">🤢</div>
                                <div class="option-name">मतली और उल्टी</div>
                            </div>
                            <div class="option-card" data-symptom="fatigue" onclick="toggleSymptom('fatigue')">
                                <div class="option-icon">😴</div>
                                <div class="option-name">अत्यधिक थकान</div>
                            </div>
                            <div class="option-card" data-symptom="rash" onclick="toggleSymptom('rash')">
                                <div class="option-icon">🔴</div>
                                <div class="option-name">त्वचा पर दाने</div>
                            </div>
                            <div class="option-card" data-symptom="cough" onclick="toggleSymptom('cough')">
                                <div class="option-icon">😷</div>
                                <div class="option-name">लगातार खांसी</div>
                            </div>
                            <div class="option-card" data-symptom="throat" onclick="toggleSymptom('throat')">
                                <div class="option-icon">😣</div>
                                <div class="option-name">गले में खराश</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="clinic-feedback"></div>
                        <button class="action-btn" id="clinic-submit" onclick="evaluateClinicDiagnosis()" disabled>🩺 निदान प्रस्तुत करें</button>
                        <button class="action-btn" id="clinic-bonus" onclick="openMinigame('lifecycle')" style="margin-top: 1rem; background: var(--victory-green); display: none;">🔬 शैक्षिक चुनौती: मच्छर जीवन चक्र</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Toggle symptom selection
        function toggleSymptom(symptomId) {
            const symptomCard = document.querySelector(`[data-symptom="${symptomId}"]`);
            
            if (selectedSymptoms.includes(symptomId)) {
                selectedSymptoms = selectedSymptoms.filter(s => s !== symptomId);
                symptomCard.classList.remove('selected');
                playSound('incorrect');
            } else {
                selectedSymptoms.push(symptomId);
                symptomCard.classList.add('selected');
                playSound('correct');
            }
            
            document.getElementById('clinic-submit').disabled = selectedSymptoms.length === 0;
        }

        // Evaluate clinic diagnosis
        function evaluateClinicDiagnosis() {
            const correctSymptoms = ['fever', 'headache', 'chills', 'nausea', 'fatigue'];
            const incorrectSymptoms = ['rash', 'cough', 'throat'];
            
            let correctCount = 0;
            let incorrectCount = 0;
            
            // Evaluate each selected symptom
            selectedSymptoms.forEach(symptomId => {
                const symptomCard = document.querySelector(`[data-symptom="${symptomId}"]`);
                if (correctSymptoms.includes(symptomId)) {
                    symptomCard.classList.add('correct');
                    correctCount++;
                } else {
                    symptomCard.classList.add('incorrect');
                    incorrectCount++;
                }
            });
            
                // Add detailed explanation for each symptom with WHO information
            const feedbackPanel = document.getElementById('clinic-feedback');
            feedbackPanel.innerHTML = ''; // Clear any existing content first
            
                const lang = gameState.currentLanguage;
                let explanationHTML = '<div style="margin-top: 1rem;"><h4>' +
                    (lang === 'en' ? 'WHO Clinical Guidelines Analysis:' : 'WHO नैदानिक दिशानिर्देश विश्लेषण:') + '</h4><ul>';

                // Define detailed explanations for each symptom
                const symptomExplanations = {
                    en: {
                        fever: '✅ <strong>High Fever (39.5°C)</strong> - WHO lists fever as the primary symptom of malaria. Temperature above 38°C with no other obvious cause is considered malaria until proven otherwise in endemic areas.',
                        headache: '✅ <strong>Severe Headache</strong> - WHO identifies headache as one of the classic triad of malaria symptoms (fever, headache, chills). Present in 80-90% of malaria cases.',
                        chills: '✅ <strong>Chills and Sweats</strong> - WHO recognizes chills and sweating as hallmark symptoms of malaria, especially during the febrile paroxysms that occur every 48-72 hours.',
                        nausea: '✅ <strong>Nausea and Vomiting</strong> - WHO guidelines include gastrointestinal symptoms like nausea and vomiting as common in malaria, especially in children.',
                        fatigue: '✅ <strong>Extreme Fatigue</strong> - WHO identifies fatigue and malaise as typical symptoms of malaria due to the body\'s inflammatory response to the parasite.',
                        rash: '❌ <strong>Skin Rash</strong> - WHO guidelines state that rash is NOT a typical malaria symptom. This suggests other conditions like viral infections or allergic reactions.',
                        cough: '❌ <strong>Persistent Cough</strong> - WHO notes that respiratory symptoms like cough are uncommon in uncomplicated malaria and may indicate other diseases or complications.',
                        throat: '❌ <strong>Sore Throat</strong> - WHO guidelines indicate that sore throat is NOT associated with malaria and suggests upper respiratory infections instead.'
                    },
                    hi: {
                        fever: '✅ <strong>तेज बुखार (39.5°C)</strong> - WHO मलेरिया के प्राथमिक लक्षण के रूप में बुखार को सूचीबद्ध करता है। स्थानिक क्षेत्रों में 38°C से अधिक तापमान को अन्य स्पष्ट कारण के बिना मलेरिया माना जाता है।',
                        headache: '✅ <strong>तीव्र सिरदर्द</strong> - WHO सिरदर्द को मलेरिया के क्लासिक त्रय (बुखार, सिरदर्द, कंपकंपी) में से एक के रूप में पहचानता है। 80-90% मलेरिया मामलों में मौजूद।',
                        chills: '✅ <strong>कंपकंपी और पसीना</strong> - WHO कंपकंपी और पसीने को मलेरिया के प्रमुख लक्षणों के रूप में पहचानता है, विशेष रूप से हर 48-72 घंटे में होने वाले ज्वर के दौरान।',
                        nausea: '✅ <strong>मतली और उल्टी</strong> - WHO दिशानिर्देश मलेरिया में मतली और उल्टी जैसे गैस्ट्रोइंटेस्टाइनल लक्षणों को शामिल करते हैं, विशेष रूप से बच्चों में।',
                        fatigue: '✅ <strong>अत्यधिक थकान</strong> - WHO परजीवी के प्रति शरीर की सूजन प्रतिक्रिया के कारण थकान और बेचैनी को मलेरिया के विशिष्ट लक्षणों के रूप में पहचानता है।',
                        rash: '❌ <strong>त्वचा पर दाने</strong> - WHO दिशानिर्देश बताते हैं कि दाने मलेरिया का विशिष्ट लक्षण नहीं है। यह वायरल संक्रमण या एलर्जी प्रतिक्रियाओं जैसी अन्य स्थितियों का सुझाव देता है।',
                        cough: '❌ <strong>लगातार खांसी</strong> - WHO नोट करता है कि खांसी जैसे श्वसन लक्षण असामान्य मलेरिया में असामान्य हैं और अन्य बीमारियों या जटिलताओं का संकेत दे सकते हैं।',
                        throat: '❌ <strong>गले में खराश</strong> - WHO दिशानिर्देश बताते हैं कि गले में खराश मलेरिया से जुड़ी नहीं है और इसके बजाय ऊपरी श्वसन संक्रमण का सुझाव देती है।'
                    }
                };
            
            selectedSymptoms.forEach(symptom => {
                const isCorrect = correctSymptoms.includes(symptom);
                const color = isCorrect ? 'green' : 'red';
                    explanationHTML += `<li style="color: ${color}; margin-bottom: 0.5rem;">${symptomExplanations[lang][symptom]}</li>`;
                });

                // Add expandable sections for enhanced learning
                const expandableContent = `
                    <div class="fact-box">
                        <h4>🔬 Why This Works</h4>
                        <p>${lang === 'en' ? 
                            'WHO research shows that fever is the most reliable indicator of malaria infection. The parasite causes your body temperature to rise as it fights the infection. This is why checking temperature is the first step in malaria diagnosis.' :
                            'WHO अनुसंधान दिखाता है कि बुखार मलेरिया संक्रमण का सबसे विश्वसनीय संकेतक है। परजीवी आपके शरीर के तापमान को संक्रमण से लड़ते समय बढ़ाता है। यही कारण है कि तापमान जांचना मलेरिया निदान में पहला कदम है।'}</p>
                    </div>
                    <div class="stat-highlight">
                        <h4>📊 Real-World Impact</h4>
                        <p>${lang === 'en' ? 
                            'In Ghana, health workers trained to recognize malaria symptoms correctly identified 95% of cases, compared to only 60% before training. This shows how important symptom knowledge is!' :
                            'घाना में, मलेरिया लक्षणों को पहचानने के लिए प्रशिक्षित स्वास्थ्य कर्मियों ने प्रशिक्षण से पहले केवल 60% की तुलना में 95% मामलों को सही ढंग से पहचाना। यह दिखाता है कि लक्षण ज्ञान कितना महत्वपूर्ण है!'}</p>
                    </div>
                    <div class="real-world-example">
                        <h4>🌍 Did You Know?</h4>
                        <p>${lang === 'en' ? 
                            'Malaria symptoms appear 10-15 days after infection, but can take up to a year in some cases. This is why travelers returning from malaria areas should watch for symptoms for months!' :
                            'मलेरिया लक्षण संक्रमण के 10-15 दिन बाद दिखाई देते हैं, लेकिन कुछ मामलों में एक साल तक लग सकते हैं। यही कारण है कि मलेरिया क्षेत्रों से लौटने वाले यात्रियों को महीनों तक लक्षणों पर नजर रखनी चाहिए!'}</p>
                    </div>
                `;

                explanationHTML += '</ul>';
                
                explanationHTML += '</div>';
            feedbackPanel.innerHTML = explanationHTML;
            feedbackPanel.classList.add('show');
            
            // Calculate performance
            const accuracy = correctCount / correctSymptoms.length;
            let performance, points, lives;
            
            if (accuracy >= 0.8 && incorrectCount === 0) {
                performance = 'excellent';
                points = 150;
                lives = 12;
            } else if (accuracy >= 0.6) {
                performance = 'good';
                points = 100;
                lives = 8;
            } else if (accuracy >= 0.4) {
                performance = 'satisfactory';
                points = 75;
                lives = 5;
            } else {
                performance = 'needs-improvement';
                points = 50;
                lives = 3;
            }
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            // Add final scoring display
            explanationHTML += '<div style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            explanationHTML += '<h5>' + (lang === 'en' ? 'Mission Results:' : 'मिशन परिणाम:') + '</h5>';
            explanationHTML += '<p>📈 <strong>' + (lang === 'en' ? 'Knowledge Points Earned:' : 'अर्जित ज्ञान अंक:') + '</strong> ' + points + '</p>';
            explanationHTML += '<p>💚 <strong>' + (lang === 'en' ? 'Lives Protected:' : 'संरक्षित जीवन:') + '</strong> ' + lives + '</p>';
            explanationHTML += '<p>🏆 <strong>' + (lang === 'en' ? 'Performance:' : 'प्रदर्शन:') + '</strong> ' + translatePerformance(performance, lang) + '</p>';
            explanationHTML += '</div>';
            
            feedbackPanel.innerHTML = explanationHTML;
            
            // Update submit button
            const continueText = gameState.currentLanguage === 'en' ? '🚀 Continue to Next Mission' : '🚀 अगले मिशन पर जारी रखें';
            document.getElementById('clinic-submit').textContent = continueText;
            document.getElementById('clinic-submit').onclick = () => completeMission('clinic');
            
            // Show educational challenge button after completion
            const bonusButton = document.getElementById('clinic-bonus');
            if (bonusButton) {
                bonusButton.style.display = 'block';
            }
        }

        // SCHOOL MISSION
        function loadSchoolMission() {
            protectedStudents = [];
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👨‍🏫</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">Mr. Joseph Kwame - School Principal</div>
                                <p>"We have 12 students who need protection, but only 7 bed nets available! WHO data shows children under 10 have much higher malaria mortality rates. Please help us prioritize which students to protect based on their age and vulnerability."</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">🛡️ Evidence-Based Student Protection</h3>
                        <p class="challenge-description">Select 7 students to receive bed net protection. Prioritize based on WHO vulnerability data: younger children (under 10) are at highest risk.</p>
                        
                        <div class="student-grid">
                            <div class="student-card high-risk" data-student="0" onclick="toggleStudentProtection(0)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Ama</div>
                                <div class="student-age">Age 8</div>
                            </div>
                            <div class="student-card high-risk" data-student="1" onclick="toggleStudentProtection(1)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Kofi</div>
                                <div class="student-age">Age 9</div>
                            </div>
                            <div class="student-card medium-risk" data-student="2" onclick="toggleStudentProtection(2)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Esi</div>
                                <div class="student-age">Age 10</div>
                            </div>
                            <div class="student-card medium-risk" data-student="3" onclick="toggleStudentProtection(3)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Yaw</div>
                                <div class="student-age">Age 11</div>
                            </div>
                            <div class="student-card low-risk" data-student="4" onclick="toggleStudentProtection(4)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Akua</div>
                                <div class="student-age">Age 12</div>
                            </div>
                            <div class="student-card low-risk" data-student="5" onclick="toggleStudentProtection(5)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Kwame</div>
                                <div class="student-age">Age 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="6" onclick="toggleStudentProtection(6)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Afia</div>
                                <div class="student-age">Age 14</div>
                            </div>
                            <div class="student-card high-risk" data-student="7" onclick="toggleStudentProtection(7)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Kojo</div>
                                <div class="student-age">Age 8</div>
                            </div>
                            <div class="student-card medium-risk" data-student="8" onclick="toggleStudentProtection(8)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Adwoa</div>
                                <div class="student-age">Age 10</div>
                            </div>
                            <div class="student-card high-risk" data-student="9" onclick="toggleStudentProtection(9)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Yaa</div>
                                <div class="student-age">Age 9</div>
                            </div>
                            <div class="student-card low-risk" data-student="10" onclick="toggleStudentProtection(10)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Kweku</div>
                                <div class="student-age">Age 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="11" onclick="toggleStudentProtection(11)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">Akosua</div>
                                <div class="student-age">Age 12</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="school-feedback"></div>
                        <button class="action-btn" id="school-submit" onclick="evaluateSchoolProtection()" disabled>🛡️ Implement Protection Plan</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👨‍🏫</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">श्री जोसेफ क्वामे - विद्यालय प्राचार्य</div>
                                <p>"हमारे पास 12 छात्र हैं जिन्हें सुरक्षा की आवश्यकता है, लेकिन केवल 7 मच्छरदानी उपलब्ध हैं! WHO डेटा दर्शाता है कि 10 वर्ष से कम उम्र के बच्चों में मलेरिया मृत्यु दर बहुत अधिक है। कृपया हमारी सहायता करें यह प्राथमिकता तय करने में कि उनकी उम्र और संवेदनशीलता के आधार पर किन छात्रों को सुरक्षा दी जाए।"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">🛡️ साक्ष्य-आधारित छात्र संरक्षण</h3>
                        <p class="challenge-description">मच्छरदानी सुरक्षा प्राप्त करने के लिए 7 छात्रों का चयन करें। WHO संवेदनशीलता डेटा के आधार पर प्राथमिकता दें: छोटे बच्चे (10 वर्ष से कम) उच्चतम जोखिम में हैं।</p>
                        
                        <div class="student-grid">
                            <div class="student-card high-risk" data-student="0" onclick="toggleStudentProtection(0)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">अमा</div>
                                <div class="student-age">आयु 8</div>
                            </div>
                            <div class="student-card high-risk" data-student="1" onclick="toggleStudentProtection(1)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">कोफी</div>
                                <div class="student-age">आयु 9</div>
                            </div>
                            <div class="student-card medium-risk" data-student="2" onclick="toggleStudentProtection(2)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">एसी</div>
                                <div class="student-age">आयु 10</div>
                            </div>
                            <div class="student-card medium-risk" data-student="3" onclick="toggleStudentProtection(3)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">याव</div>
                                <div class="student-age">आयु 11</div>
                            </div>
                            <div class="student-card low-risk" data-student="4" onclick="toggleStudentProtection(4)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">अकुआ</div>
                                <div class="student-age">आयु 12</div>
                            </div>
                            <div class="student-card low-risk" data-student="5" onclick="toggleStudentProtection(5)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">क्वामे</div>
                                <div class="student-age">आयु 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="6" onclick="toggleStudentProtection(6)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">अफिया</div>
                                <div class="student-age">आयु 14</div>
                            </div>
                            <div class="student-card high-risk" data-student="7" onclick="toggleStudentProtection(7)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">कोजो</div>
                                <div class="student-age">आयु 8</div>
                            </div>
                            <div class="student-card medium-risk" data-student="8" onclick="toggleStudentProtection(8)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">अदवोआ</div>
                                <div class="student-age">आयु 10</div>
                            </div>
                            <div class="student-card high-risk" data-student="9" onclick="toggleStudentProtection(9)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">याआ</div>
                                <div class="student-age">आयु 9</div>
                            </div>
                            <div class="student-card low-risk" data-student="10" onclick="toggleStudentProtection(10)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">क्वेकू</div>
                                <div class="student-age">आयु 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="11" onclick="toggleStudentProtection(11)">
                                <div class="bed-icon">🛏️</div>
                                <div class="student-name">अकोसुआ</div>
                                <div class="student-age">आयु 12</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="school-feedback"></div>
                        <button class="action-btn" id="school-submit" onclick="evaluateSchoolProtection()" disabled>🛡️ सुरक्षा योजना लागू करें</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Toggle student protection
        function toggleStudentProtection(studentIndex) {
            const studentCard = document.querySelector(`[data-student="${studentIndex}"]`);
            
            if (protectedStudents.includes(studentIndex)) {
                protectedStudents = protectedStudents.filter(s => s !== studentIndex);
                studentCard.classList.remove('protected');
            } else if (protectedStudents.length < 7) {
                protectedStudents.push(studentIndex);
                studentCard.classList.add('protected');
            } else {
                const messages = {
                    en: 'Only 7 bed nets available! Remove protection from another student first.',
                    hi: 'केवल 7 मच्छरदानी उपलब्ध हैं! पहले किसी अन्य छात्र से सुरक्षा हटाएं।'
                };
                alert(messages[gameState.currentLanguage]);
                return;
            }
            
            document.getElementById('school-submit').disabled = protectedStudents.length !== 7;
        }

        // Evaluate school protection
        function evaluateSchoolProtection() {
            const students = [
                { name: 'Ama', age: 8, risk: 'HIGH' },
                { name: 'Kofi', age: 9, risk: 'HIGH' },
                { name: 'Esi', age: 10, risk: 'MEDIUM' },
                { name: 'Yaw', age: 11, risk: 'MEDIUM' },
                { name: 'Akua', age: 12, risk: 'LOW' },
                { name: 'Kwame', age: 13, risk: 'LOW' },
                { name: 'Afia', age: 14, risk: 'LOW' },
                { name: 'Kojo', age: 8, risk: 'HIGH' },
                { name: 'Adwoa', age: 10, risk: 'MEDIUM' },
                { name: 'Yaa', age: 9, risk: 'HIGH' },
                { name: 'Kweku', age: 13, risk: 'LOW' },
                { name: 'Akosua', age: 12, risk: 'LOW' }
            ];
            
            let highRiskProtected = 0;
            let mediumRiskProtected = 0;
            let lowRiskProtected = 0;
            
            protectedStudents.forEach(index => {
                const student = students[index];
                if (student.age <= 9) highRiskProtected++;
                else if (student.age <= 11) mediumRiskProtected++;
                else lowRiskProtected++;
            });
            
            // Add detailed explanation with WHO evidence
            const schoolFeedback = document.getElementById('school-feedback');
            schoolFeedback.innerHTML = ''; // Clear any existing content first
            
            const lang = gameState.currentLanguage;
            let schoolExplanationHTML = '<div style="margin-top: 1rem;"><h4>' + 
                (lang === 'en' ? 'WHO Evidence-Based Risk Assessment:' : 'WHO साक्ष्य-आधारित जोखिम मूल्यांकन:') + '</h4>';
            
            schoolExplanationHTML += '<div style="margin: 1rem 0; padding: 1rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid var(--hero-blue);">';
            schoolExplanationHTML += '<h5>' + (lang === 'en' ? 'Protection Priority Analysis:' : 'सुरक्षा प्राथमिकता विश्लेषण:') + '</h5>';
            schoolExplanationHTML += '<p>✅ <strong>' + (lang === 'en' ? 'High-risk students protected (age ≤9):' : 'उच्च जोखिम वाले छात्रों की सुरक्षा (आयु ≤9):') + '</strong> ' + highRiskProtected + '/4</p>';
            schoolExplanationHTML += '<p>🟡 <strong>' + (lang === 'en' ? 'Medium-risk students protected (age 10-11):' : 'मध्यम जोखिम वाले छात्रों की सुरक्षा (आयु 10-11):') + '</strong> ' + mediumRiskProtected + '/2</p>';
            schoolExplanationHTML += '<p>🔴 <strong>' + (lang === 'en' ? 'Low-risk students protected (age ≥12):' : 'कम जोखिम वाले छात्रों की सुरक्षा (आयु ≥12):') + '</strong> ' + lowRiskProtected + '/6</p>';
            schoolExplanationHTML += '</div>';
            
            // Add WHO evidence and recommendations
            schoolExplanationHTML += '<div style="margin: 1rem 0; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            schoolExplanationHTML += '<h5>' + (lang === 'en' ? 'WHO Malaria Risk Data:' : 'WHO मलेरिया जोखिम डेटा:') + '</h5>';
            schoolExplanationHTML += '<ul>';
            schoolExplanationHTML += '<li>' + (lang === 'en' ? 
                'Children under 5 years: 75% higher mortality risk, 60% of all malaria deaths' :
                '5 वर्ष से कम उम्र के बच्चे: 75% अधिक मृत्यु जोखिम, सभी मलेरिया मौतों का 60%') + '</li>';
            schoolExplanationHTML += '<li>' + (lang === 'en' ? 
                'Children 5-9 years: 50% higher mortality risk, 25% of malaria deaths' :
                '5-9 वर्ष के बच्चे: 50% अधिक मृत्यु जोखिम, मलेरिया मौतों का 25%') + '</li>';
            schoolExplanationHTML += '<li>' + (lang === 'en' ? 
                'Children 10+ years: Lower risk, better immune response, 15% of malaria deaths' :
                '10+ वर्ष के बच्चे: कम जोखिम, बेहतर प्रतिरक्षा प्रतिक्रिया, मलेरिया मौतों का 15%') + '</li>';
            schoolExplanationHTML += '</ul>';
            schoolExplanationHTML += '<p><strong>' + (lang === 'en' ? 
                'WHO Recommendation: Prioritize bed net distribution to children under 10 years, especially those under 5, as they have the highest malaria mortality risk.' :
                'WHO सिफारिश: 10 वर्ष से कम उम्र के बच्चों, विशेष रूप से 5 वर्ष से कम उम्र के बच्चों को मच्छरदानी वितरण में प्राथमिकता दें, क्योंकि उनमें मलेरिया मृत्यु का सबसे अधिक जोखिम है।') + '</strong></p>';
            schoolExplanationHTML += '</div>';
            
            // Calculate performance and scoring
            let performance, points, lives;
            
            if (highRiskProtected >= 3) {
                performance = 'excellent';
                points = 130;
                lives = 12;
            } else if (highRiskProtected >= 2) {
                performance = 'good';  
                points = 100;
                lives = 9;
            } else if (highRiskProtected >= 1) {
                performance = 'satisfactory';
                points = 70;
                lives = 6;
            } else {
                performance = 'needs-improvement';
                points = 40;
                lives = 3;
            }
            
            // Add final scoring display
            schoolExplanationHTML += '<div style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            schoolExplanationHTML += '<h5>' + (lang === 'en' ? 'Mission Results:' : 'मिशन परिणाम:') + '</h5>';
            schoolExplanationHTML += '<p>📈 <strong>' + (lang === 'en' ? 'Knowledge Points Earned:' : 'अर्जित ज्ञान अंक:') + '</strong> ' + points + '</p>';
            schoolExplanationHTML += '<p>💚 <strong>' + (lang === 'en' ? 'Lives Protected:' : 'संरक्षित जीवन:') + '</strong> ' + lives + '</p>';
            schoolExplanationHTML += '<p>🏆 <strong>' + (lang === 'en' ? 'Performance:' : 'प्रदर्शन:') + '</strong> ' + translatePerformance(performance, lang) + '</p>';
            schoolExplanationHTML += '</div></div>';
            
            schoolFeedback.innerHTML = schoolExplanationHTML;
            schoolFeedback.classList.add('show');
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            // Update submit button
            const continueText = gameState.currentLanguage === 'en' ? '🚀 Continue to Next Mission' : '🚀 अगले मिशन पर जारी रखें';
            document.getElementById('school-submit').textContent = continueText;
            document.getElementById('school-submit').onclick = () => completeMission('school');
        }

        // MARKET MISSION
        function loadMarketMission() {
            selectedEducationMethods = [];
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👵</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">Elder Akosua - Community Leader</div>
                                <p>"Many vendors are falling ill with malaria, and people are scared. We need effective health education methods to teach prevention without causing panic or blame. What approaches actually change behavior and save lives?"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">📢 Evidence-Based Health Communication</h3>
                        <p class="challenge-description">Select effective health education methods that build trust and change behavior. Avoid approaches that blame or frighten people.</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-method="demonstrations" onclick="toggleEducationMethod('demonstrations')">
                                <div class="option-name">🎭 Live demonstrations of prevention methods</div>
                            </div>
                            <div class="option-card" data-method="visual-aids" onclick="toggleEducationMethod('visual-aids')">
                                <div class="option-name">📋 Clear visual aids and posters</div>
                            </div>
                            <div class="option-card" data-method="community-sessions" onclick="toggleEducationMethod('community-sessions')">
                                <div class="option-name">👥 Community health education sessions</div>
                            </div>
                            <div class="option-card" data-method="peer-education" onclick="toggleEducationMethod('peer-education')">
                                <div class="option-name">🤝 Train community members as educators</div>
                            </div>
                            <div class="option-card" data-method="fear-tactics" onclick="toggleEducationMethod('fear-tactics')">
                                <div class="option-name">😱 Use scary statistics to motivate</div>
                            </div>
                            <div class="option-card" data-method="blame-approach" onclick="toggleEducationMethod('blame-approach')">
                                <div class="option-name">😠 Blame people for getting sick</div>
                            </div>
                            <div class="option-card" data-method="expensive-solutions" onclick="toggleEducationMethod('expensive-solutions')">
                                <div class="option-name">💰 Only promote costly prevention methods</div>
                            </div>
                            <div class="option-card" data-method="ignore-culture" onclick="toggleEducationMethod('ignore-culture')">
                                <div class="option-name">🚫 Ignore local beliefs and practices</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="market-feedback"></div>
                        <button class="action-btn" id="market-submit" onclick="evaluateHealthEducation()" disabled>📢 Launch Education Campaign</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👵</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">बुजुर्ग अकोसुआ - सामुदायिक नेता</div>
                                <p>"कई विक्रेता मलेरिया से बीमार पड़ रहे हैं, और लोग डरे हुए हैं। हमें रोकथाम सिखाने के लिए प्रभावी स्वास्थ्य शिक्षा विधियों की आवश्यकता है बिना घबराहट या दोषारोपण के। कौन से दृष्टिकोण वास्तव में व्यवहार बदलते हैं और जीवन बचाते हैं?"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">📢 साक्ष्य-आधारित स्वास्थ्य संचार</h3>
                        <p class="challenge-description">प्रभावी स्वास्थ्य शिक्षा विधियों का चयन करें जो विश्वास बनाती हैं और व्यवहार बदलती हैं। ऐसे दृष्टिकोणों से बचें जो लोगों को दोषी ठहराते या डराते हैं।</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-method="demonstrations" onclick="toggleEducationMethod('demonstrations')">
                                <div class="option-name">🎭 रोकथाम विधियों का प्रत्यक्ष प्रदर्शन</div>
                            </div>
                            <div class="option-card" data-method="visual-aids" onclick="toggleEducationMethod('visual-aids')">
                                <div class="option-name">📋 स्पष्ट दृश्य सहायक सामग्री और पोस्टर</div>
                            </div>
                            <div class="option-card" data-method="community-sessions" onclick="toggleEducationMethod('community-sessions')">
                                <div class="option-name">👥 सामुदायिक स्वास्थ्य शिक्षा सत्र</div>
                            </div>
                            <div class="option-card" data-method="peer-education" onclick="toggleEducationMethod('peer-education')">
                                <div class="option-name">🤝 समुदायिक सदस्यों को शिक्षकों के रूप में प्रशिक्षित करना</div>
                            </div>
                            <div class="option-card" data-method="fear-tactics" onclick="toggleEducationMethod('fear-tactics')">
                                <div class="option-name">😱 प्रेरित करने के लिए डरावने आंकड़ों का उपयोग</div>
                            </div>
                            <div class="option-card" data-method="blame-approach" onclick="toggleEducationMethod('blame-approach')">
                                <div class="option-name">😠 बीमार होने के लिए लोगों को दोषी ठहराना</div>
                            </div>
                            <div class="option-card" data-method="expensive-solutions" onclick="toggleEducationMethod('expensive-solutions')">
                                <div class="option-name">💰 केवल महंगी रोकथाम विधियों को बढ़ावा देना</div>
                            </div>
                            <div class="option-card" data-method="ignore-culture" onclick="toggleEducationMethod('ignore-culture')">
                                <div class="option-name">🚫 स्थानीय मान्यताओं और प्रथाओं की अनदेखी</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="market-feedback"></div>
                        <button class="action-btn" id="market-submit" onclick="evaluateHealthEducation()" disabled>📢 शिक्षा अभियान शुरू करें</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Toggle education method selection
        function toggleEducationMethod(methodId) {
            const methodCard = document.querySelector(`[data-method="${methodId}"]`);
            
            if (selectedEducationMethods.includes(methodId)) {
                selectedEducationMethods = selectedEducationMethods.filter(m => m !== methodId);
                methodCard.classList.remove('selected');
            } else {
                selectedEducationMethods.push(methodId);
                methodCard.classList.add('selected');
            }
            
            document.getElementById('market-submit').disabled = selectedEducationMethods.length === 0;
        }

        // Evaluate health education
        function evaluateHealthEducation() {
            const correctMethods = ['demonstrations', 'visual-aids', 'community-sessions', 'peer-education'];
            const incorrectMethods = ['fear-tactics', 'blame-approach', 'expensive-solutions', 'ignore-culture'];
            
            let correctCount = 0;
            let incorrectCount = 0;
            
            selectedEducationMethods.forEach(methodId => {
                const methodCard = document.querySelector(`[data-method="${methodId}"]`);
                if (correctMethods.includes(methodId)) {
                    methodCard.classList.add('correct');
                    correctCount++;
                } else {
                    methodCard.classList.add('incorrect');
                    incorrectCount++;
                }
            });
            
            // Add detailed explanation with WHO evidence
            const marketFeedback = document.getElementById('market-feedback');
            marketFeedback.innerHTML = ''; // Clear any existing content first
            
            const lang = gameState.currentLanguage;
            let marketExplanationHTML = '<div style="margin-top: 1rem;"><h4>' + 
                (lang === 'en' ? 'WHO Evidence-Based Health Communication Analysis:' : 'WHO साक्ष्य-आधारित स्वास्थ्य संचार विश्लेषण:') + '</h4><ul>';
            
            // Define detailed explanations for each method
            const methodExplanations = {
                en: {
                    demonstrations: '✅ <strong>Live Demonstrations</strong> - WHO recommends hands-on demonstrations as they increase knowledge retention by 80% and behavior change by 60%. Studies show people learn better through active participation.',
                    'visual-aids': '✅ <strong>Visual Aids and Posters</strong> - WHO guidelines emphasize visual materials for low-literacy populations. Visual aids improve understanding by 70% and are essential for reaching diverse communities.',
                    'community-sessions': '✅ <strong>Community Health Education Sessions</strong> - WHO promotes community-based approaches as they build local ownership and trust. Community sessions increase program sustainability by 85%.',
                    'peer-education': '✅ <strong>Peer Education Programs</strong> - WHO recognizes peer educators as highly effective, with 90% message credibility. Peer education increases behavior change adoption by 75% compared to external educators.',
                    'fear-tactics': '❌ <strong>Fear-Based Messaging</strong> - WHO warns against fear tactics as they often backfire, reducing compliance by 40%. Fear-based approaches can cause anxiety and avoidance behaviors.',
                    'blame-approach': '❌ <strong>Blaming Individuals</strong> - WHO guidelines emphasize avoiding blame as it creates stigma and reduces help-seeking by 60%. Blame approaches damage community trust and program effectiveness.',
                    'expensive-solutions': '❌ <strong>Expensive Prevention Methods</strong> - WHO advocates for affordable solutions to ensure equity. Expensive methods exclude 70% of vulnerable populations who need protection most.',
                    'ignore-culture': '❌ <strong>Ignoring Cultural Context</strong> - WHO stresses cultural sensitivity as ignoring local beliefs reduces message acceptance by 50% and program effectiveness by 65%.'
                },
                hi: {
                    demonstrations: '✅ <strong>प्रत्यक्ष प्रदर्शन</strong> - WHO सक्रिय प्रदर्शन की सिफारिश करता है क्योंकि यह ज्ञान प्रतिधारण को 80% और व्यवहार परिवर्तन को 60% बढ़ाता है। अध्ययन दिखाते हैं कि लोग सक्रिय भागीदारी के माध्यम से बेहतर सीखते हैं।',
                    'visual-aids': '✅ <strong>दृश्य सहायक सामग्री और पोस्टर</strong> - WHO दिशानिर्देश कम साक्षरता वाली आबादी के लिए दृश्य सामग्री पर जोर देते हैं। दृश्य सहायक सामग्री समझ को 70% बेहतर बनाती है।',
                    'community-sessions': '✅ <strong>सामुदायिक स्वास्थ्य शिक्षा सत्र</strong> - WHO सामुदायिक दृष्टिकोण को बढ़ावा देता है क्योंकि यह स्थानीय स्वामित्व और विश्वास बनाता है। सामुदायिक सत्र कार्यक्रम स्थिरता को 85% बढ़ाते हैं।',
                    'peer-education': '✅ <strong>साथी शिक्षा कार्यक्रम</strong> - WHO साथी शिक्षकों को अत्यधिक प्रभावी मानता है, जिनकी संदेश विश्वसनीयता 90% है। साथी शिक्षा बाहरी शिक्षकों की तुलना में व्यवहार परिवर्तन अपनाने को 75% बढ़ाती है।',
                    'fear-tactics': '❌ <strong>डर आधारित संदेश</strong> - WHO डर की रणनीतियों के खिलाफ चेतावनी देता है क्योंकि वे अक्सर उल्टे परिणाम देते हैं, अनुपालन को 40% कम करते हैं। डर आधारित दृष्टिकोण चिंता और परिहार व्यवहार पैदा कर सकते हैं।',
                    'blame-approach': '❌ <strong>व्यक्तियों को दोष देना</strong> - WHO दिशानिर्देश दोष से बचने पर जोर देते हैं क्योंकि यह कलंक पैदा करता है और सहायता मांगने को 60% कम करता है। दोष दृष्टिकोण सामुदायिक विश्वास और कार्यक्रम प्रभावशीलता को नुकसान पहुंचाता है।',
                    'expensive-solutions': '❌ <strong>महंगी रोकथाम विधियां</strong> - WHO न्यायसंगतता सुनिश्चित करने के लिए सस्ते समाधानों की वकालत करता है। महंगी विधियां 70% कमजोर आबादी को बाहर करती हैं जिन्हें सबसे ज्यादा सुरक्षा चाहिए।',
                    'ignore-culture': '❌ <strong>सांस्कृतिक संदर्भ की अनदेखी</strong> - WHO सांस्कृतिक संवेदनशीलता पर जोर देता है क्योंकि स्थानीय मान्यताओं की अनदेखी संदेश स्वीकार्यता को 50% और कार्यक्रम प्रभावशीलता को 65% कम करती है।'
                }
            };
            
            selectedEducationMethods.forEach(method => {
                const isCorrect = correctMethods.includes(method);
                const color = isCorrect ? 'green' : 'red';
                marketExplanationHTML += `<li style="color: ${color}; margin-bottom: 0.5rem;">${methodExplanations[lang][method]}</li>`;
            });
            
            // Add expandable sections for enhanced learning
            const expandableContent = `
                <div class="fact-box">
                    <h4>🔬 Why This Works</h4>
                    <p>${lang === 'en' ? 
                        'WHO research shows that peer education is 90% more effective than external messaging because community members trust their neighbors more than outsiders. This builds local ownership and sustainable behavior change.' :
                        'WHO अनुसंधान दिखाता है कि साथी शिक्षा बाहरी संदेशों की तुलना में 90% अधिक प्रभावी है क्योंकि समुदाय के सदस्य बाहरी लोगों की तुलना में अपने पड़ोसियों पर अधिक भरोसा करते हैं। यह स्थानीय स्वामित्व और स्थायी व्यवहार परिवर्तन बनाता है।'}</p>
                </div>
                <div class="stat-highlight">
                    <h4>📊 Real-World Impact</h4>
                    <p>${lang === 'en' ? 
                        'In Tanzania, community health education programs reduced malaria cases by 45% in just 2 years. The key was using local leaders and peer educators who spoke the community\'s language and understood their culture.' :
                        'तंजानिया में, सामुदायिक स्वास्थ्य शिक्षा कार्यक्रमों ने केवल 2 वर्षों में मलेरिया के मामलों को 45% कम कर दिया। मुख्य बात स्थानीय नेताओं और साथी शिक्षकों का उपयोग करना था जो समुदाय की भाषा बोलते थे और उनकी संस्कृति को समझते थे।'}</p>
                </div>
                <div class="real-world-example">
                    <h4>🌍 Did You Know?</h4>
                    <p>${lang === 'en' ? 
                        'Fear-based messaging actually increases risky behavior! WHO studies show that people exposed to scary malaria ads are 40% less likely to seek treatment because they feel hopeless. Positive, empowering messages work much better!' :
                        'डर आधारित संदेश वास्तव में जोखिम भरे व्यवहार को बढ़ाते हैं! WHO अध्ययन दिखाते हैं कि डरावने मलेरिया विज्ञापनों के संपर्क में आने वाले लोग निराश महसूस करने के कारण उपचार की तलाश करने की 40% कम संभावना रखते हैं। सकारात्मक, सशक्तिकरण संदेश बहुत बेहतर काम करते हैं!'}</p>
                </div>
            `;

            marketExplanationHTML += '</ul>';
            
            // Add expandable sections
            const expandableSection = createExpandableSection(
                lang === 'en' ? 'Learn More About Health Communication' : 'स्वास्थ्य संचार के बारे में अधिक जानें',
                expandableContent,
                '🗣️'
            );
            
            marketExplanationHTML += '</div>';
            marketFeedback.innerHTML = marketExplanationHTML;
            marketFeedback.appendChild(expandableSection);
            marketFeedback.classList.add('show');
            
            // Calculate performance and scoring
            let performance, points, lives;
            
            if (correctCount >= 3 && incorrectCount === 0) {
                performance = 'excellent';
                points = 120;
                lives = 15;
            } else if (correctCount >= 2) {
                performance = 'good';
                points = 90;
                lives = 10;
            } else if (correctCount >= 1) {
                performance = 'satisfactory';
                points = 60;
                lives = 6;
            } else {
                performance = 'needs-improvement';
                points = 30;
                lives = 3;
            }
            
            // Add final scoring display
            marketExplanationHTML += '<div style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            marketExplanationHTML += '<h5>' + (lang === 'en' ? 'Mission Results:' : 'मिशन परिणाम:') + '</h5>';
            marketExplanationHTML += '<p>📈 <strong>' + (lang === 'en' ? 'Knowledge Points Earned:' : 'अर्जित ज्ञान अंक:') + '</strong> ' + points + '</p>';
            marketExplanationHTML += '<p>💚 <strong>' + (lang === 'en' ? 'Lives Protected:' : 'संरक्षित जीवन:') + '</strong> ' + lives + '</p>';
            marketExplanationHTML += '<p>🏆 <strong>' + (lang === 'en' ? 'Performance:' : 'प्रदर्शन:') + '</strong> ' + translatePerformance(performance, lang) + '</p>';
            marketExplanationHTML += '</div></div>';
            
            marketFeedback.innerHTML = marketExplanationHTML;
            marketFeedback.classList.add('show');
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            // Update submit button
            const continueText = gameState.currentLanguage === 'en' ? '🚀 Continue to Next Mission' : '🚀 अगले मिशन पर जारी रखें';
            document.getElementById('market-submit').textContent = continueText;
            document.getElementById('market-submit').onclick = () => completeMission('market');
        }

        // HOMES MISSION - MOSQUITO BREEDING GAME
        function loadHomesMission() {
            foundBreedingSites = [];
            breedingHelpShown = false; // Reset help shown flag for this mission
            breedingAttempts = 0; // Reset attempts counter
            
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👨‍👩‍👧‍👦</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">The Mensah Family</div>
                                <p>"Our daughter has developed malaria symptoms, and we keep getting bitten by mosquitoes every night! We suspect they're breeding somewhere around our compound. Please help us identify where the mosquitoes are reproducing so we can eliminate these deadly breeding sites."</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">🦟 Vector Control Challenge</h3>
                        <p class="challenge-description"><strong>Mission:</strong> Find exactly 6 mosquito breeding sites out of 12 locations. Use your scientific knowledge to identify where mosquitoes breed! Remember: mosquitoes need standing water for 7-14 days to breed!</p>
                        
                        <div class="breeding-progress">
                            <div class="progress-item">
                                <span class="progress-number found" id="sites-found">0</span>
                                <div class="progress-label">Sites Found</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number target">6</span>
                                <div class="progress-label">Target Sites</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number score" id="current-score">0</span>
                                <div class="progress-label">Score</div>
                            </div>
                        </div>

                        <div class="compound-container">
                            <div class="compound-title">🏠 Mensah Family Compound</div>
                            
                            <!-- Correct breeding sites -->
                            <div class="breeding-site site-1" onclick="checkBreedingSite('water-barrel', true)">🪣</div>
                            <div class="breeding-site site-2" onclick="checkBreedingSite('plant-saucers', true)">🪴</div>
                            <div class="breeding-site site-3" onclick="checkBreedingSite('roof-gutter', true)">🏠</div>
                            <div class="breeding-site site-4" onclick="checkBreedingSite('old-bucket', true)">🪣</div>
                            <div class="breeding-site site-5" onclick="checkBreedingSite('flower-vase', true)">🏺</div>
                            <div class="breeding-site site-6" onclick="checkBreedingSite('tire-planter', true)">🛞</div>
                            
                            <!-- Incorrect sites -->
                            <div class="breeding-site site-7" onclick="checkBreedingSite('tree-base', false)">🌳</div>
                            <div class="breeding-site site-8" onclick="checkBreedingSite('dry-garden', false)">🌿</div>
                            <div class="breeding-site site-9" onclick="checkBreedingSite('house-wall', false)">🧱</div>
                            <div class="breeding-site site-10" onclick="checkBreedingSite('flowing-drain', false)">🌊</div>
                            <div class="breeding-site site-11" onclick="checkBreedingSite('solid-pavement', false)">🪨</div>
                            <div class="breeding-site site-12" onclick="checkBreedingSite('hanging-clothes', false)">👕</div>
                        </div>

                        <div class="help-panel" id="breeding-help">
                            <div class="help-title">🔬 Scientific Guidance</div>
                            <p><strong>Mosquito Biology:</strong> Female Anopheles mosquitoes need clean, standing water that remains undisturbed for 7-14 days to complete their life cycle. Look for containers, puddles, or blocked drainage that can hold water for extended periods.</p>
                            <p><strong>Key Signs:</strong> Water storage containers, flower pot saucers, blocked gutters, abandoned buckets, tire planters with collected water.</p>
                            <p><strong>Not Breeding Sites:</strong> Dry surfaces, flowing water, solid objects without water retention, well-drained areas.</p>
                        </div>
                        
                        <div class="feedback-panel" id="homes-feedback"></div>
                        <button class="action-btn" id="homes-submit" onclick="evaluateVectorControl()" disabled>🏠 Complete Vector Control</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">👨‍👩‍👧‍👦</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">मेन्साह परिवार</div>
                                <p>"हमारी बेटी में मलेरिया के लक्षण विकसित हो गए हैं, और हमें हर रात मच्छरों के काटने का सामना करना पड़ता है! हमें संदेह है कि वे हमारे परिसर के आसपास कहीं प्रजनन कर रहे हैं। कृपया हमारी सहायता करें यह पहचानने में कि मच्छर कहाँ प्रजनन कर रहे हैं ताकि हम इन घातक प्रजनन स्थलों को समाप्त कर सकें।"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">🦟 वेक्टर नियंत्रण चुनौती</h3>
                        <p class="challenge-description"><strong>मिशन:</strong> 12 स्थानों में से ठीक 6 मच्छर प्रजनन स्थलों की पहचान करें। अपने वैज्ञानिक ज्ञान का उपयोग करके बताएं कि मच्छर कहाँ प्रजनन करते हैं! याद रखें: मच्छरों को प्रजनन के लिए 7-14 दिनों तक स्थिर पानी की आवश्यकता होती है!</p>
                        
                        <div class="breeding-progress">
                            <div class="progress-item">
                                <span class="progress-number found" id="sites-found">0</span>
                                <div class="progress-label">मिले स्थल</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number target">6</span>
                                <div class="progress-label">लक्ष्य स्थल</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number score" id="current-score">0</span>
                                <div class="progress-label">स्कोर</div>
                            </div>
                        </div>

                        <div class="compound-container">
                            <div class="compound-title">🏠 मेन्साह परिवार परिसर</div>
                            
                            <!-- Correct breeding sites -->
                            <div class="breeding-site site-1" onclick="checkBreedingSite('water-barrel', true)">🪣</div>
                            <div class="breeding-site site-2" onclick="checkBreedingSite('plant-saucers', true)">🪴</div>
                            <div class="breeding-site site-3" onclick="checkBreedingSite('roof-gutter', true)">🏠</div>
                            <div class="breeding-site site-4" onclick="checkBreedingSite('old-bucket', true)">🪣</div>
                            <div class="breeding-site site-5" onclick="checkBreedingSite('flower-vase', true)">🏺</div>
                            <div class="breeding-site site-6" onclick="checkBreedingSite('tire-planter', true)">🛞</div>
                            
                            <!-- Incorrect sites -->
                            <div class="breeding-site site-7" onclick="checkBreedingSite('tree-base', false)">🌳</div>
                            <div class="breeding-site site-8" onclick="checkBreedingSite('dry-garden', false)">🌿</div>
                            <div class="breeding-site site-9" onclick="checkBreedingSite('house-wall', false)">🧱</div>
                            <div class="breeding-site site-10" onclick="checkBreedingSite('flowing-drain', false)">🌊</div>
                            <div class="breeding-site site-11" onclick="checkBreedingSite('solid-pavement', false)">🪨</div>
                            <div class="breeding-site site-12" onclick="checkBreedingSite('hanging-clothes', false)">👕</div>
                        </div>

                        <div class="help-panel" id="breeding-help">
                            <div class="help-title">🔬 वैज्ञानिक मार्गदर्शन</div>
                            <p><strong>मच्छर जीव विज्ञान:</strong> मादा एनोफिलीज मच्छरों को अपना जीवन चक्र पूरा करने के लिए साफ, स्थिर पानी की आवश्यकता होती है जो 7-14 दिनों तक अबाधित रहे। ऐसे पात्र, गड्ढे, या अवरुद्ध नालियों को देखें जो लंबे समय तक पानी धारण कर सकते हैं।</p>
                            <p><strong>मुख्य संकेत:</strong> जल भंडारण कंटेनर, फूलों के गमलों की तश्तरी, अवरुद्ध नालियां, परित्यक्त बाल्टियां, जल संग्रहित टायर प्लांटर।</p>
                            <p><strong>प्रजनन स्थल नहीं:</strong> सूखी सतहें, बहता पानी, जल धारण के बिना ठोस वस्तुएं, अच्छी जल निकासी वाले क्षेत्र।</p>
                        </div>
                        
                        <div class="feedback-panel" id="homes-feedback"></div>
                        <button class="action-btn" id="homes-submit" onclick="evaluateVectorControl()" disabled>🏠 वेक्टर नियंत्रण पूरा करें</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Sound effects
        function playSound(type) {
            // Create audio context for sound effects
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'correct') {
                // Play success sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'incorrect') {
                // Play error sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'complete') {
                // Play completion sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.4);
                oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.6);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            }
        }

        // Particle effects
        function createParticles(x, y, count = 5) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.left = (x + (Math.random() - 0.5) * 20) + 'px';
                particle.style.top = (y + (Math.random() - 0.5) * 20) + 'px';
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }

        // Celebration confetti
        function createCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            document.body.appendChild(celebration);
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                celebration.appendChild(confetti);
            }
            
            setTimeout(() => {
                celebration.remove();
            }, 5000);
        }

        // Check breeding site - MOSQUITO BREEDING GAME
        function checkBreedingSite(siteId, isCorrect) {
            const siteElement = event.target;
            
            if (siteElement.classList.contains('correct') || siteElement.classList.contains('incorrect')) {
                return;
            }
            
            // Increment attempts counter
            breedingAttempts++;
            
            if (isCorrect) {
                siteElement.classList.add('correct');
                foundBreedingSites.push(siteId);
                document.getElementById('sites-found').textContent = foundBreedingSites.length;
                
                // Play success sound
                playSound('correct');
                
                // Create particle effect
                const rect = siteElement.getBoundingClientRect();
                createParticles(rect.left + rect.width/2, rect.top + rect.height/2, 8);
                
                // Update score
                const currentScore = foundBreedingSites.length * 10;
                document.getElementById('current-score').textContent = currentScore;
                
                if (foundBreedingSites.length >= 6) {
                    document.getElementById('homes-submit').disabled = false;
                    playSound('complete');
                    createCelebration();
                }
            } else {
                siteElement.classList.add('incorrect');
                
                // Play error sound
                playSound('incorrect');
                
                // Show help message after first wrong attempt
                if (!breedingHelpShown) {
                    document.getElementById('breeding-help').classList.add('show');
                    breedingHelpShown = true;
                    const helpMessage = gameState.currentLanguage === 'en' ?
                        '🎓 Scientific guidance is now available! Use the hint system to find the remaining breeding sites.' :
                        '🎓 वैज्ञानिक मार्गदर्शन अब उपलब्ध है! शेष प्रजनन स्थलों को खोजने के लिए संकेत प्रणाली का उपयोग करें।';
                    alert(helpMessage);
                }
            }
        }

        // Evaluate vector control
        function evaluateVectorControl() {
            let performance, points, lives;
            
            // Calculate base points based on sites found
            let basePoints = 0;
            let baseLives = 0;
            
            if (foundBreedingSites.length >= 6) {
                performance = 'excellent';
                basePoints = 300;
                baseLives = 20;
            } else if (foundBreedingSites.length >= 5) {
                performance = 'good';
                basePoints = 200;
                baseLives = 15;
            } else if (foundBreedingSites.length >= 4) {
                performance = 'satisfactory';
                basePoints = 150;
                baseLives = 10;
            } else {
                performance = 'needs-improvement';
                basePoints = 100;
                baseLives = 5;
            }
            
            // Apply penalty for too many attempts
            let attemptPenalty = 0;
            if (breedingAttempts > 12) {
                attemptPenalty = Math.floor((breedingAttempts - 12) * 5); // 5 points penalty per extra attempt
                performance = 'needs-improvement'; // Downgrade performance if too many attempts
            } else if (breedingAttempts > 8) {
                attemptPenalty = Math.floor((breedingAttempts - 8) * 3); // 3 points penalty per extra attempt
                if (performance === 'excellent') performance = 'good';
            }
            
            // Calculate final points and lives
            points = Math.max(0, basePoints - attemptPenalty);
            lives = Math.max(1, baseLives - Math.floor(attemptPenalty / 10)); // Reduce lives based on penalty
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            const homesFeedback = document.getElementById('homes-feedback');
            const lang = gameState.currentLanguage;
            homesFeedback.innerHTML = `
                <div style="margin-top: 1rem;">
                    <h4>${lang === 'en' ? 'Mosquito Breeding Game Results:' : 'मच्छर प्रजनन खेल परिणाम:'}</h4>
                    <p>✅ ${lang === 'en' ? 'Breeding sites found:' : 'प्रजनन स्थल मिले:'} ${foundBreedingSites.length}/6</p>
                    <p>🎯 ${lang === 'en' ? 'Total attempts:' : 'कुल प्रयास:'} ${breedingAttempts}</p>
                    <p>🏆 ${lang === 'en' ? 'Performance:' : 'प्रदर्शन:'} ${translatePerformance(performance, lang)}</p>
                    <p>📈 ${lang === 'en' ? 'Points earned:' : 'अर्जित अंक:'} ${points} ${attemptPenalty > 0 ? `(${lang === 'en' ? 'penalty applied' : 'जुर्माना लगाया गया'})` : ''}</p>
                    <p>💚 ${lang === 'en' ? 'Lives protected:' : 'संरक्षित जीवन:'} ${lives}</p>
                    <p>🎯 ${lang === 'en' ? 'Efficiency Score:' : 'दक्षता स्कोर:'} ${foundBreedingSites.length * 10} ${lang === 'en' ? 'points' : 'अंक'}</p>
                </div>
            `;
            homesFeedback.classList.add('show');
            
            const completeText = gameState.currentLanguage === 'en' ? '🏁 End Mission' : '🏁 मिशन समाप्त';
            document.getElementById('homes-submit').textContent = completeText;
            document.getElementById('homes-submit').onclick = () => completeMission('homes');
        }

        // Complete mission
        function completeMission(missionId) {
            gameState.completedMissions.push(missionId);
            gameState.missionsCompleted++;
            
            // Mark location as completed
            const location = document.getElementById(missionId + '-location') || document.querySelector('.' + missionId);
            location.classList.add('completed');
            location.classList.remove('disabled');
            
            closeMissionModal();
            
            // Enable next location
            const sequence = ['clinic', 'school', 'market', 'homes'];
            const currentIndex = sequence.indexOf(missionId);
            
            if (currentIndex < sequence.length - 1) {
                const nextMission = sequence[currentIndex + 1];
                const nextLocation = document.getElementById(nextMission + '-location');
                if (nextLocation) {
                    nextLocation.classList.remove('disabled');
                    const badge = nextLocation.querySelector('.priority-badge');
                    if (badge) badge.style.display = 'flex';
                }
                
                // Update mission text
                const missionTexts = {
                    en: {
                        school: 'Protect vulnerable students at the Village School with limited bed nets!',
                        market: 'Educate the community at the Market with effective health communication!',
                        homes: 'Eliminate deadly mosquito breeding sites in the Family Compounds!'
                    },
                    hi: {
                        school: 'सीमित मच्छरदानी के साथ गांव के विद्यालय में संवेदनशील छात्रों की सुरक्षा करें!',
                        market: 'प्रभावी स्वास्थ्य संचार के साथ बाजार में समुदाय को शिक्षित करें!',
                        homes: 'पारिवारिक परिसरों में घातक मच्छर प्रजनन स्थलों को समाप्त करें!'
                    }
                };
                
                const textElement = gameState.currentLanguage === 'en' ? 
                    document.getElementById('current-mission-text') : 
                    document.getElementById('current-mission-text-hi');
                
                if (textElement && missionTexts[gameState.currentLanguage][nextMission]) {
                    textElement.textContent = missionTexts[gameState.currentLanguage][nextMission];
                }
            } else {
                // All missions complete
                const completeTexts = {
                    en: 'All missions completed! You are a Malaria Hero! 🎉',
                    hi: 'सभी मिशन पूर्ण! आप एक मलेरिया वीर हैं! 🎉'
                };
                
                const textElement = gameState.currentLanguage === 'en' ? 
                    document.getElementById('current-mission-text') : 
                    document.getElementById('current-mission-text-hi');
                
                if (textElement) {
                    textElement.textContent = completeTexts[gameState.currentLanguage];
                }
                
                setTimeout(() => {
                    showGameCompletion();
                }, 2000);
            }
            
            updateStats();
        }

        // Test function to manually show completion modal
        function testCompletionModal() {
            console.log('Testing completion modal...');
            gameState.livesProtected = 50;
            gameState.knowledgePoints = 200;
            gameState.completedMissions = ['clinic', 'school', 'market', 'homes'];
            showGameCompletion();
        }
        
        // Make test function available globally
        window.testCompletionModal = testCompletionModal;
        
        // Also add a keyboard shortcut for testing
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'c') {
                testCompletionModal();
            }
        });

        // Show game completion
        function showGameCompletion() {
            console.log('showGameCompletion called');
            console.log('Lives protected:', gameState.livesProtected);
            console.log('Knowledge points:', gameState.knowledgePoints);
            
            const finalLives = document.getElementById('final-lives');
            const finalPoints = document.getElementById('final-points');
            const finalLivesHi = document.getElementById('final-lives-hi');
            const finalPointsHi = document.getElementById('final-points-hi');
            const completionModal = document.getElementById('completion-modal');
            
            if (finalLives) finalLives.textContent = gameState.livesProtected;
            if (finalPoints) finalPoints.textContent = gameState.knowledgePoints;
            if (finalLivesHi) finalLivesHi.textContent = gameState.livesProtected;
            if (finalPointsHi) finalPointsHi.textContent = gameState.knowledgePoints;
            
            if (completionModal) {
                console.log('Adding active class to completion modal');
                completionModal.classList.add('active');
            } else {
                console.error('Completion modal element not found!');
            }
            
            // Add Play Again button to mission panel
            addPlayAgainButton();
        }

        // Add Play Again button to mission panel
        function addPlayAgainButton() {
            const missionPanel = document.querySelector('.mission-panel');
            if (missionPanel && !document.getElementById('play-again-btn')) {
                const playAgainBtn = document.createElement('div');
                playAgainBtn.id = 'play-again-btn';
                playAgainBtn.style.cssText = `
                    text-align: center;
                    margin-top: 2rem;
                    padding: 1rem;
                    background: linear-gradient(135deg, #f0f9ff, #dbeafe);
                    border-radius: 16px;
                    border: 2px solid var(--hero-blue);
                `;
                
                const lang = gameState.currentLanguage;
                playAgainBtn.innerHTML = `
                    <h3 style="color: var(--hero-blue); margin-bottom: 1rem; font-family: 'Fredoka', sans-serif;">
                        ${lang === 'en' ? '🎉 All Missions Complete!' : '🎉 सभी मिशन पूर्ण!'}
                    </h3>
                    <p style="margin-bottom: 1rem; color: var(--neutral-slate);">
                        ${lang === 'en' ? 
                            'Congratulations! You\'ve successfully protected Nyanja Village from malaria!' : 
                            'बधाई हो! आपने न्यांजा गांव को मलेरिया से सफलतापूर्वक बचाया है!'}
                    </p>
                    <button class="action-btn" onclick="restartGame()" style="background: var(--victory-green); font-size: 1.1rem; padding: 1rem 2rem;">
                        ${lang === 'en' ? '🎮 Play Again' : '🎮 फिर से खेलें'}
                    </button>
                `;
                
                missionPanel.appendChild(playAgainBtn);
            }
        }

        // Restart game
        function restartGame() {
            // Reset game state
            gameState.livesProtected = 0;
            gameState.knowledgePoints = 0;
            gameState.missionsCompleted = 0;
            gameState.completedMissions = [];
            
            // Reset mission tracking
            selectedSymptoms = [];
            protectedStudents = [];
            selectedEducationMethods = [];
            foundBreedingSites = [];
            breedingHelpShown = false;
            breedingAttempts = 0;
            
            // Reset UI - enable only first mission
            const locations = ['clinic', 'school', 'market', 'homes'];
            locations.forEach((locationId, index) => {
                const location = document.getElementById(locationId + '-location') || document.querySelector('.' + locationId);
                if (location) {
                    location.classList.remove('completed');
                    if (index === 0) {
                        location.classList.remove('disabled');
                    } else {
                        location.classList.add('disabled');
                    }
                    const badge = location.querySelector('.priority-badge');
                    if (badge) {
                        badge.style.display = index === 0 ? 'flex' : 'none';
                    }
                }
            });
            
            // Reset mission text
            const missionTexts = {
                en: 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!',
                hi: 'आपातकालीन क्लिनिक में जाएं जहां एक गंभीर रूप से बीमार 8 वर्षीय रोगी को तत्काल चिकित्सा निदान की आवश्यकता है। जीवन आपकी विशेषज्ञता पर निर्भर है!'
            };
            
            const textElement = gameState.currentLanguage === 'en' ? 
                document.getElementById('current-mission-text') : 
                document.getElementById('current-mission-text-hi');
            
            if (textElement) {
                textElement.textContent = missionTexts[gameState.currentLanguage];
            }
            
            // Close completion modal
            document.getElementById('completion-modal').classList.remove('active');
            
            // Update stats
            updateStats();
        }

        // Reset game completely (for GitHub hosting issues)
        function resetGame() {
            // Clear all localStorage
            localStorage.removeItem('malariaHeroesProgress');
            localStorage.removeItem('malariaHeroesTutorialComplete');
            
            // Reset game state
            gameState = {
                currentLanguage: gameState.currentLanguage, // Preserve language choice
                livesProtected: 0,
                knowledgePoints: 0,
                missionsCompleted: 0,
                currentMission: 'clinic',
                completedMissions: []
            };
            
            // Reset mission tracking variables
            selectedSymptoms = [];
            protectedStudents = [];
            selectedEducationMethods = [];
            foundBreedingSites = [];
            breedingHelpShown = false;
            breedingAttempts = 0;
            
            // Reset UI
            document.getElementById('completion-modal').classList.remove('active');
            
            // Remove Play Again button if it exists
            const playAgainBtn = document.getElementById('play-again-btn');
            if (playAgainBtn) {
                playAgainBtn.remove();
            }
            
            // Reset locations
            document.querySelectorAll('.location').forEach(location => {
                location.classList.remove('completed');
                if (!location.classList.contains('clinic')) {
                    location.classList.add('disabled');
                    const badge = location.querySelector('.priority-badge');
                    if (badge) badge.style.display = 'none';
                }
            });
            
            // Reset mission text
            const initialTexts = {
                en: 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!',
                hi: 'आपातकालीन क्लिनिक में जाएं जहां एक गंभीर रूप से बीमार 8 वर्षीय रोगी को तत्काल चिकित्सा निदान की आवश्यकता है। जीवन आपकी विशेषज्ञता पर निर्भर है!'
            };
            
            const textElement = gameState.currentLanguage === 'en' ? 
                document.getElementById('current-mission-text') : 
                document.getElementById('current-mission-text-hi');
            
            if (textElement) {
                textElement.textContent = initialTexts[gameState.currentLanguage];
            }
            
            // Update stats and UI
            updateStats();
            updateUI();
            
            // Show tutorial
            setTimeout(() => {
                startTutorial();
            }, 500);
            
            console.log('Game reset successfully');
        }

        // FIXED: Certificate functions work properly now
        function showCertificateModal() {
            document.getElementById('certificate-modal').style.display = 'flex';
            document.getElementById('certificate-modal').classList.add('active');
            const today = new Date().toLocaleDateString();
            document.getElementById('certificate-date').textContent = today;
            document.getElementById('certificate-date-hi').textContent = today;
        }
        
        function closeCertificateModal() {
            document.getElementById('certificate-modal').style.display = 'none';
            document.getElementById('certificate-modal').classList.remove('active');
        }
        
        function generateCertificate() {
            const nameInputEn = document.getElementById('player-name-input');
            const nameInputHi = document.getElementById('player-name-input-hi');
            const nameInput = gameState.currentLanguage === 'en' ? nameInputEn : nameInputHi;
            const name = nameInput.value.trim() || (gameState.currentLanguage === 'en' ? 'Malaria Hero' : 'मलेरिया वीर');
            
            document.getElementById('certificate-name').textContent = name;
            document.getElementById('certificate-name-hi').textContent = name;
            document.getElementById('certificate-lives').textContent = gameState.livesProtected;
            document.getElementById('certificate-points').textContent = gameState.knowledgePoints;
            
            const successMessage = gameState.currentLanguage === 'en' ? 
                '🎓 Certificate generated! Click "Download PNG" to save it to your device.' :
                '🎓 प्रमाणपत्र तैयार! अपने डिवाइस में सहेजने के लिए "PNG डाउनलोड करें" पर क्लिक करें।';
            alert(successMessage);
        }
        
        function downloadCertificate() {
            const certificate = document.getElementById('certificate-container');
            
            if (window.html2canvas) {
                html2canvas(certificate, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'Malaria-Heroes-Certificate.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    const successMessage = gameState.currentLanguage === 'en' ? 
                        '📥 Certificate downloaded successfully!' :
                        '📥 प्रमाणपत्र सफलतापूर्वक डाउनलोड हो गया!';
                    alert(successMessage);
                }).catch(error => {
                    console.error('Certificate download failed:', error);
                    const errorMessage = gameState.currentLanguage === 'en' ? 
                        '📷 Certificate download failed. Please take a screenshot manually.' :
                        '📷 प्रमाणपत्र डाउनलोड असफल। कृपया मैन्युअल रूप से स्क्रीनशॉट लें।';
                    alert(errorMessage);
                });
            } else {
                const errorMessage = gameState.currentLanguage === 'en' ? 
                    '📷 Screenshot feature not available. Please take a screenshot manually.' :
                    '📷 स्क्रीनशॉट सुविधा उपलब्ध नहीं। कृपया मैन्युअल रूप से स्क्रीनशॉट लें।';
                alert(errorMessage);
            }
        }

        // Restart game
        function restartGame() {
            // Reset all game state
            gameState = {
                currentLanguage: gameState.currentLanguage, // Preserve language choice
                livesProtected: 0,
                knowledgePoints: 0,
                missionsCompleted: 0,
                currentMission: 'clinic',
                completedMissions: []
            };
            
            selectedSymptoms = [];
            protectedStudents = [];
            selectedEducationMethods = [];
            foundBreedingSites = [];
            breedingHelpShown = false;
            
            // Reset UI
            document.getElementById('completion-modal').classList.remove('active');
            
            // Remove Play Again button if it exists
            const playAgainBtn = document.getElementById('play-again-btn');
            if (playAgainBtn) {
                playAgainBtn.remove();
            }
            
            // Reset locations
            document.querySelectorAll('.location').forEach(location => {
                location.classList.remove('completed');
                if (!location.classList.contains('clinic')) {
                    location.classList.add('disabled');
                    const badge = location.querySelector('.priority-badge');
                    if (badge) badge.style.display = 'none';
                }
            });
            
            const initialTexts = {
                en: 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!',
                hi: 'आपातकालीन क्लिनिक में जाएं जहां एक गंभीर रूप से बीमार 8 वर्षीय रोगी को तत्काल चिकित्सा निदान की आवश्यकता है। जीवन आपकी विशेषज्ञता पर निर्भर है!'
            };
            
            const textElement = gameState.currentLanguage === 'en' ? 
                document.getElementById('current-mission-text') : 
                document.getElementById('current-mission-text-hi');
            
            if (textElement) {
                textElement.textContent = initialTexts[gameState.currentLanguage];
            }
            
            updateStats();
        }

        // Initialize game on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            console.log('🌍 Malaria Heroes - Professional Edition Loaded!');
            console.log('📊 Latest WHO 2024 Statistics: 597,000 deaths, 263 million cases');
            console.log('🦟 Vector Control Challenge: 3 wrong attempts max');
            console.log('🇮🇳 Bilingual Support: Accurate Hindi translations');
        });
    </script>
</body>
</html>
