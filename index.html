<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaria Heroes: Save Nyanja Village</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Quicksand:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');

        :root {
            --hero-blue: #3b82f6;
            --victory-green: #10b981;
            --warning-amber: #f59e0b;
            --danger-red: #ef4444;
            --neutral-slate: #64748b;
            --light-background: #f8fafc;
            --white: #ffffff;
            --clinic-red: #dc2626;
            --school-blue: #3b82f6;
            --market-green: #059669;
            --homes-orange: #ea580c;
            --success-glow: #10b981;
            --error-glow: #ef4444;
            --primary-glow: #3b82f6;
            --gold: #fbbf24;
            --purple: #8b5cf6;
            --pink: #ec4899;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1f2937;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Language Toggle */
        .language-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            background: white;
            border-radius: 25px;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--hero-blue);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            color: var(--neutral-slate);
        }

        .lang-btn.active {
            background: var(--hero-blue);
            color: white;
        }

        .lang-btn:hover:not(.active) {
            background: var(--light-background);
        }

        .lang-btn.reset-btn {
            background: var(--warning-amber);
            color: white;
            margin-left: 0.5rem;
        }

        .lang-btn.reset-btn:hover {
            background: #d97706;
        }

        /* Hindi Text Styling */
        .hindi-text {
            font-family: 'Noto Sans Devanagari', sans-serif;
            font-weight: 500;
        }

        /* Hide inactive language content */
        .lang-content {
            display: none;
        }

        .lang-content.active {
            display: block;
        }

        /* Header Styles */
        .game-header {
            background: linear-gradient(135deg, var(--hero-blue), #1d4ed8, var(--purple));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.4);
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .game-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #fff, #f0f9ff, #e0f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 2s ease-in-out infinite alternate;
            position: relative;
            z-index: 1;
        }

        @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8)); }
        }

        .game-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        /* Stats Bar */
        .stats-container {
            background: white;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .stats-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 0 2rem;
        }

        .stat-card {
            background: var(--light-background);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--hero-blue);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--neutral-slate);
            font-weight: 600;
            margin-top: 0.25rem;
        }

        /* Village Map */
        .village-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        .village-map {
            background: 
                linear-gradient(135deg, #87CEEB 0%, #98FB98 30%, #90EE90 70%, #228B22 100%),
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
            border-radius: 24px;
            padding: 2rem;
            position: relative;
            min-height: 600px;
            box-shadow: 0 20px 50px rgba(22, 163, 74, 0.4);
            border: 4px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            animation: mapPulse 6s ease-in-out infinite;
        }

        .village-map::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Sky gradient */
                linear-gradient(to bottom, rgba(135, 206, 235, 0.3) 0%, transparent 30%),
                /* Ground texture */
                radial-gradient(ellipse at 50% 100%, rgba(139, 69, 19, 0.1) 0%, transparent 60%),
                /* Path lines */
                linear-gradient(45deg, transparent 48%, rgba(139, 69, 19, 0.2) 49%, rgba(139, 69, 19, 0.2) 51%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(139, 69, 19, 0.2) 49%, rgba(139, 69, 19, 0.2) 51%, transparent 52%),
                /* Vegetation spots */
                radial-gradient(circle at 20% 30%, rgba(34, 139, 34, 0.2) 0%, transparent 15%),
                radial-gradient(circle at 80% 70%, rgba(34, 139, 34, 0.2) 0%, transparent 15%),
                radial-gradient(circle at 60% 40%, rgba(34, 139, 34, 0.2) 0%, transparent 15%);
            pointer-events: none;
        }

        .village-map::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Trees */
                radial-gradient(circle at 15% 25%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                radial-gradient(circle at 85% 75%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                radial-gradient(circle at 25% 75%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                radial-gradient(circle at 75% 25%, rgba(34, 139, 34, 0.4) 0%, transparent 8%),
                /* Rocks */
                radial-gradient(circle at 40% 60%, rgba(105, 105, 105, 0.3) 0%, transparent 5%),
                radial-gradient(circle at 70% 40%, rgba(105, 105, 105, 0.3) 0%, transparent 5%);
            pointer-events: none;
        }

        @keyframes mapPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .map-title {
            text-align: center;
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 2rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .location {
            position: absolute;
            width: 140px;
            height: 140px;
            border-radius: 30px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid white;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.8),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            position: absolute;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .location::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.6s;
        }

        .location:hover::before {
            left: 100%;
        }

        .location::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--gold), var(--victory-green), var(--hero-blue), var(--pink));
            border-radius: 32px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .location:hover::after {
            opacity: 1;
        }

        .location:hover {
            transform: translateY(-12px) scale(1.1) rotateY(5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--gold);
        }

        .location:active {
            transform: translateY(-6px) scale(1.05);
        }

        .location.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        .location.completed {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
        }

        .location.completed::after {
            content: "âœ“";
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--victory-green);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.1rem;
            border: 3px solid white;
        }

        .location-icon {
            font-size: 4rem;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
            animation: iconFloat 4s ease-in-out infinite;
            position: relative;
        }

        .location:hover .location-icon {
            transform: scale(1.3) rotate(15deg);
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.4));
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-2px) rotate(1deg); }
            50% { transform: translateY(-4px) rotate(0deg); }
            75% { transform: translateY(-2px) rotate(-1deg); }
        }

        .location-name {
            font-weight: 700;
            font-size: 0.75rem;
            text-align: center;
            line-height: 1.2;
        }

        .priority-badge {
            position: absolute;
            top: -8px;
            left: -8px;
            background: var(--danger-red);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            border: 3px solid white;
        }

        /* Location positioning - place in all four corners */
        .clinic { top: 12%; left: 12%; }
        .clinic .location-icon { color: var(--clinic-red); }

        .school { top: 12%; right: 12%; }
        .school .location-icon { color: var(--school-blue); }

        .market { bottom: 12%; left: 12%; }
        .market .location-icon { color: var(--market-green); }

        .homes { bottom: 12%; right: 12%; }
        .homes .location-icon { color: var(--homes-orange); }

        /* Mission Panel */
        .mission-panel {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
            border: 2px solid var(--hero-blue);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--hero-blue);
            text-align: center;
            font-family: 'Fredoka', sans-serif;
        }

        .emergency-alert {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid var(--danger-red);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .alert-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-title {
            font-weight: 700;
            color: var(--danger-red);
            font-size: 1.1rem;
        }

        .current-mission {
            background: var(--light-background);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .mission-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .mission-title {
            font-weight: 700;
            color: var(--hero-blue);
            font-size: 1.1rem;
        }

        /* Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            max-width: 900px;
            width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-background);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .close-btn {
            background: var(--danger-red);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: scale(1.1);
        }

        /* Mission Content */
        .mission-intro {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid var(--hero-blue);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .npc-dialogue {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .npc-avatar {
            width: 80px;
            height: 80px;
            background: var(--hero-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            flex-shrink: 0;
        }

        .dialogue-bubble {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            flex: 1;
            border: 2px solid var(--light-background);
            position: relative;
        }

        .dialogue-bubble::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 30px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-right: 12px solid white;
            border-bottom: 10px solid transparent;
        }

        .npc-name {
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
        }

        /* Challenge Section */
        .challenge-section {
            background: var(--light-background);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .challenge-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 1rem;
            text-align: center;
            font-family: 'Fredoka', sans-serif;
        }

        .challenge-description {
            color: var(--neutral-slate);
            margin-bottom: 2rem;
            text-align: center;
            line-height: 1.6;
        }

        /* Option Grids */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .option-card {
            background: white;
            border: 2px solid var(--light-background);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .option-card.selected {
            border-color: var(--hero-blue);
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
        }

        .option-card.correct {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .option-card.incorrect {
            border-color: var(--danger-red);
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
        }

        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .option-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.95rem;
        }

        /* Student Grid for School */
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .student-card {
            background: white;
            border: 2px solid var(--light-background);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .student-card.protected {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .student-card.high-risk {
            border-color: var(--danger-red);
        }

        .student-card.medium-risk {
            border-color: var(--warning-amber);
        }

        .student-card.low-risk {
            border-color: var(--victory-green);
        }

        .bed-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .student-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .student-age {
            font-size: 0.85rem;
            color: var(--neutral-slate);
        }

        /* Compound Map for Homes */
        .compound-container {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 20px;
            padding: 1rem;
            margin: 2rem 0;
            position: relative;
            min-height: 450px;
            width: 100%;
            border: 3px solid var(--warning-amber);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 20px, transparent 20px),
                radial-gradient(circle at 80% 20%, rgba(34, 197, 94, 0.1) 15px, transparent 15px),
                radial-gradient(circle at 60% 70%, rgba(245, 158, 11, 0.1) 25px, transparent 25px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .compound-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .compound-title {
            text-align: center;
            font-weight: 700;
            color: var(--homes-orange);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            position: relative;
            z-index: 2;
        }

        .breeding-progress {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            border: 2px solid var(--warning-amber);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .breeding-progress:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .progress-item {
            text-align: center;
        }

        .progress-number {
            font-size: 1.8rem;
            font-weight: 800;
            display: block;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .progress-number:hover {
            transform: scale(1.1);
        }

        .progress-number.found { color: var(--victory-green); }
        .progress-number.attempts { color: var(--danger-red); }
        .progress-number.target { color: var(--warning-amber); }
        .progress-number.score { color: var(--hero-blue); }

        .progress-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--neutral-slate);
        }

        .breeding-site {
            position: absolute;
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            border: 2px solid var(--light-background);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(15px);
            overflow: hidden;
            z-index: 3;
        }

        .breeding-site::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.5s;
        }

        .breeding-site:hover::before {
            left: 100%;
        }

        .breeding-site:hover {
            transform: scale(1.2) rotateY(5deg);
            border-color: var(--gold);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(248, 250, 252, 1) 100%);
        }

        .breeding-site.correct {
            border-color: var(--victory-green);
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            animation: correctPulse 1s ease-out;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }

        .breeding-site.incorrect {
            border-color: var(--danger-red);
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            animation: incorrectShake 0.6s ease-out;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        @keyframes correctPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7); }
            70% { transform: scale(1.2); box-shadow: 0 0 0 10px rgba(22, 163, 74, 0); }
            100% { transform: scale(1.15); box-shadow: 0 0 0 0 rgba(22, 163, 74, 0); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Breeding site positions using percentages - all visible in the compound */
        .site-1  { top: 15%; left: 10%; }
        .site-2  { top: 15%; left: 30%; }
        .site-3  { top: 15%; left: 50%; }
        .site-4  { top: 15%; left: 70%; }

        .site-5  { top: 45%; left: 15%; }
        .site-6  { top: 45%; left: 35%; }
        .site-7  { top: 45%; left: 55%; }
        .site-8  { top: 45%; left: 75%; }

        .site-9  { top: 75%; left: 10%; }
        .site-10 { top: 75%; left: 30%; }
        .site-11 { top: 75%; left: 50%; }
        .site-12 { top: 75%; left: 70%; }

        /* Particle effects */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gold);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 2s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        /* Celebration animation */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--gold);
            animation: confettiFall 3s linear forwards;
        }

        .confetti:nth-child(odd) {
            background: var(--victory-green);
        }

        .confetti:nth-child(3n) {
            background: var(--hero-blue);
        }

        .confetti:nth-child(4n) {
            background: var(--pink);
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Help Panel */
        .help-panel {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid var(--hero-blue);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 2rem 0;
            display: none;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
            transition: all 0.3s ease;
        }

        .help-panel.show {
            display: block;
            animation: slideDown 0.5s ease;
            box-shadow: 0 12px 35px rgba(37, 99, 235, 0.25);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .help-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 1rem;
        }

        /* Action Buttons */
        .action-btn {
            background: linear-gradient(135deg, var(--victory-green), #16a34a);
            color: white;
            border: none;
            padding: 1.4rem 3rem;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 2rem auto;
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);
            font-family: 'Quicksand', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(22, 163, 74, 0.4);
            background: linear-gradient(135deg, #16a34a, var(--victory-green));
        }

        .action-btn:disabled {
            background: var(--neutral-slate);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Feedback Panels */
        .feedback-panel {
            background: var(--light-background);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            display: none;
        }

        .feedback-panel.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .feedback-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .feedback-icon.success {
            background: var(--victory-green);
            color: white;
        }

        .feedback-icon.warning {
            background: var(--warning-amber);
            color: white;
        }

        .feedback-icon.error {
            background: var(--danger-red);
            color: white;
        }

        .feedback-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .feedback-title.success { color: var(--victory-green); }
        .feedback-title.warning { color: var(--warning-amber); }
        .feedback-title.error { color: var(--danger-red); }

        /* Completion Modal */
        .completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .completion-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .completion-content {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            max-width: 800px;
            width: 95vw;
            text-align: center;
            transform: scale(0.8);
            transition: all 0.5s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .completion-modal.active .completion-content {
            transform: scale(1);
        }

        .completion-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--victory-green);
            margin-bottom: 1rem;
            font-family: 'Fredoka', sans-serif;
        }

        .completion-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .completion-stat {
            background: var(--light-background);
            border-radius: 16px;
            padding: 2rem;
        }

        .completion-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .completion-label {
            font-weight: 600;
            color: var(--neutral-slate);
        }

        /* Certificate Styles */
        .certificate-modal {
            z-index: 3000;
        }

        .certificate-container {
            border: 4px solid var(--hero-blue);
            border-radius: 16px;
            padding: 2rem;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            position: relative;
            min-height: 400px;
        }

        .certificate-decorations {
            position: absolute;
            font-size: 2rem;
        }

        .cert-trophy { top: 10px; right: 10px; }
        .cert-globe { top: 10px; left: 10px; }
        .cert-mosquito { bottom: 10px; right: 10px; }
        .cert-medical { bottom: 10px; left: 10px; }

        .certificate-title {
            color: var(--hero-blue);
            font-size: 2.5rem;
            margin: 1rem 0;
            font-family: 'Fredoka', sans-serif;
        }

        .certificate-subtitle {
            color: var(--victory-green);
            font-family: 'Quicksand', sans-serif;
            margin: 1rem 0;
            font-size: 1.5rem;
        }

        .certificate-name {
            color: var(--hero-blue);
            font-size: 2rem;
            margin: 1rem 0;
            border-bottom: 2px solid var(--hero-blue);
            display: inline-block;
            padding: 0.5rem 1rem;
            min-width: 300px;
        }

        .certificate-stats {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 12px;
        }

        .cert-stat {
            text-align: center;
        }

        .cert-stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .cert-stat-number.lives { color: var(--victory-green); }
        .cert-stat-number.points { color: var(--hero-blue); }
        .cert-stat-number.success { color: var(--warning-amber); }

        .cert-stat-label {
            font-size: 0.9rem;
            color: var(--neutral-slate);
        }

        .certificate-footer {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: var(--neutral-slate);
        }

        .certificate-signature {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
        }

        .signature-line {
            border-top: 2px solid var(--hero-blue);
            width: 200px;
            text-align: center;
            padding-top: 0.5rem;
        }

        .signature-title {
            font-size: 0.8rem;
            color: var(--neutral-slate);
        }

        .name-input {
            padding: 0.75rem 1rem;
            border: 2px solid var(--hero-blue);
            border-radius: 8px;
            font-size: 1rem;
            width: 300px;
            text-align: center;
            margin: 1rem 0;
        }

        .cert-buttons {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cert-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cert-btn.generate {
            background: var(--hero-blue);
            color: white;
        }

        .cert-btn.download {
            background: var(--victory-green);
            color: white;
        }

        .cert-btn.close {
            background: var(--neutral-slate);
            color: white;
        }

        .cert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Tutorial System */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tutorial-overlay.active {
            display: flex;
            opacity: 1;
        }

        .tutorial-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
            position: relative;
        }

        .tutorial-overlay.active .tutorial-card {
            transform: scale(1);
        }

        .tutorial-mascot {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: mascotBounce 2s ease-in-out infinite;
        }

        @keyframes mascotBounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .tutorial-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 1rem;
            font-family: 'Fredoka', sans-serif;
        }

        .tutorial-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #374151;
            margin-bottom: 2rem;
        }

        .tutorial-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: background 0.3s ease;
        }

        .progress-dot.active {
            background: var(--hero-blue);
        }

        .tutorial-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tutorial-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tutorial-btn.primary {
            background: var(--hero-blue);
            color: white;
        }

        .tutorial-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .tutorial-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .tutorial-highlight {
            position: absolute;
            border: 3px solid var(--gold);
            border-radius: 12px;
            background: rgba(251, 191, 36, 0.1);
            pointer-events: none;
            animation: highlightPulse 2s ease-in-out infinite;
        }

        @keyframes highlightPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
        }

        .help-icon {
            position: fixed;
            top: 20px;
            right: 80px;
            width: 50px;
            height: 50px;
            background: var(--hero-blue);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .help-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        /* Expandable Feedback Sections */
        .expandable-section {
            margin: 1rem 0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .expandable-header {
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
            padding: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .expandable-header:hover {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }

        .expandable-title {
            font-weight: 600;
            color: var(--hero-blue);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .expand-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }

        .expandable-header.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
            border-radius: 0 0 12px 12px;
        }

        .expandable-content.expanded {
            max-height: 500px;
        }

        .expandable-body {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .fact-box {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-left: 4px solid var(--victory-green);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .fact-box h4 {
            color: var(--victory-green);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .stat-highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--warning-amber);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .stat-highlight h4 {
            color: var(--warning-amber);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .real-world-example {
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
            border-left: 4px solid var(--hero-blue);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .real-world-example h4 {
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        /* Glossary System */
        .glossary-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .glossary-overlay.active {
            display: flex;
            opacity: 1;
        }

        .glossary-panel {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .glossary-overlay.active .glossary-panel {
            transform: scale(1);
        }

        .glossary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .glossary-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--hero-blue);
            font-family: 'Fredoka', sans-serif;
        }

        .glossary-search {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
        }

        .glossary-search:focus {
            outline: none;
            border-color: var(--hero-blue);
        }

        .glossary-term {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid var(--hero-blue);
        }

        .term-title {
            font-weight: 700;
            color: var(--hero-blue);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .term-simple {
            color: #374151;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .term-medical {
            color: #6b7280;
            font-size: 0.9rem;
            font-style: italic;
        }

        .glossary-icon {
            position: fixed;
            top: 80px;
            right: 80px;
            width: 50px;
            height: 50px;
            background: var(--victory-green);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .glossary-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        @media (max-width: 768px) {
            .village-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .village-map {
                min-height: 400px;
            }

            .location {
                width: 100px;
                height: 100px;
            }

            /* Mobile location positioning */
            .clinic { top: 10%; left: 8%; }
            .school { top: 10%; right: 8%; }
            .market { bottom: 10%; left: 8%; }
            .homes { bottom: 10%; right: 8%; }

            .location-icon {
                font-size: 2.5rem;
            }

            .breeding-site {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
            }

            .compound-container {
                min-height: 380px;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .student-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .cert-buttons {
                flex-direction: column;
                align-items: center;
            }

            .certificate-name {
                font-size: 1.5rem;
                min-width: 250px;
            }

            .certificate-stats {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Language Toggle -->
    <div class="language-toggle">
        <button class="lang-btn active" onclick="switchLanguage('en')" data-lang="en">ðŸ‡¬ðŸ‡§ English</button>
        <button class="lang-btn" onclick="switchLanguage('hi')" data-lang="hi">ðŸ‡®ðŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</button>
        <button class="lang-btn reset-btn" onclick="resetGame()" title="Reset Game">ðŸ”„ Reset</button>
    </div>

    <!-- Help Icon -->
    <button class="help-icon" onclick="startTutorial()" title="Help & Tutorial">?</button>

    <!-- Glossary Icon -->
    <button class="glossary-icon" onclick="openGlossary()" title="Medical Terms Glossary">ðŸ“–</button>

    <!-- Game Header -->
    <header class="game-header">
        <!-- English Header -->
        <div class="lang-content active" data-lang="en">
            <h1 class="game-title">ðŸŒ Malaria Heroes</h1>
            <p class="game-subtitle">Emergency Response Training â€¢ Save Nyanja Village</p>
        </div>
        <!-- Hindi Header -->
        <div class="lang-content hindi-text" data-lang="hi">
            <h1 class="game-title">ðŸŒ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤µà¥€à¤°</h1>
            <p class="game-subtitle">à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£ â€¢ à¤¨à¥à¤¯à¤¾à¤‚à¤œà¤¾ à¤—à¤¾à¤‚à¤µ à¤•à¥‹ à¤¬à¤šà¤¾à¤à¤‚</p>
        </div>
    </header>

    <!-- Stats Container -->
    <div class="stats-container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="livesProtected">0</div>
                <!-- English -->
                <div class="stat-label lang-content active" data-lang="en">Lives Protected</div>
                <!-- Hindi -->
                <div class="stat-label lang-content hindi-text" data-lang="hi">à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="knowledgePoints">0</div>
                <!-- English -->
                <div class="stat-label lang-content active" data-lang="en">Knowledge Points</div>
                <!-- Hindi -->
                <div class="stat-label lang-content hindi-text" data-lang="hi">à¤œà¥à¤žà¤¾à¤¨ à¤…à¤‚à¤•</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="missionsCompleted">0</div>
                <!-- English -->
                <div class="stat-label lang-content active" data-lang="en">Missions Completed</div>
                <!-- Hindi -->
                <div class="stat-label lang-content hindi-text" data-lang="hi">à¤ªà¥‚à¤°à¥à¤£ à¤®à¤¿à¤¶à¤¨</div>
            </div>
        </div>
    </div>

    <!-- Village Container -->
    <div class="village-container">
        <!-- Village Map -->
        <div class="village-map">
            <!-- English Title -->
            <h2 class="map-title lang-content active" data-lang="en">ðŸ˜ï¸ Nyanja Village Emergency Response</h2>
            <!-- Hindi Title -->
            <h2 class="map-title lang-content hindi-text" data-lang="hi">ðŸ˜ï¸ à¤¨à¥à¤¯à¤¾à¤‚à¤œà¤¾ à¤—à¤¾à¤‚à¤µ à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾</h2>
            
            <!-- Emergency Clinic -->
            <div class="location clinic" id="clinic-location" onclick="openMission('clinic')">
                <div class="location-icon">ðŸ¥</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Emergency<br>Clinic</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨<br>à¤•à¥à¤²à¤¿à¤¨à¤¿à¤•</div>
                <div class="priority-badge">1</div>
            </div>
            
            <!-- Village School -->
            <div class="location school disabled" id="school-location" onclick="openMission('school')">
                <div class="location-icon">ðŸ«</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Village<br>School</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">à¤—à¤¾à¤‚à¤µ à¤•à¤¾<br>à¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯</div>
                <div class="priority-badge" style="display: none;">2</div>
            </div>
            
            <!-- Community Market -->
            <div class="location market disabled" id="market-location" onclick="openMission('market')">
                <div class="location-icon">ðŸª</div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Community<br>Market</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">à¤¸à¤¾à¤®à¥à¤¦à¤¾à¤¯à¤¿à¤•<br>à¤¬à¤¾à¤œà¤¾à¤°</div>
                <div class="priority-badge" style="display: none;">3</div>
            </div>
            
            <!-- Family Homes -->
            <div class="location homes disabled" id="homes-location" onclick="openMission('homes')">
                <div class="location-icon">ðŸ </div>
                <!-- English -->
                <div class="location-name lang-content active" data-lang="en">Family<br>Compounds</div>
                <!-- Hindi -->
                <div class="location-name lang-content hindi-text" data-lang="hi">à¤ªà¤¾à¤°à¤¿à¤µà¤¾à¤°à¤¿à¤•<br>à¤ªà¤°à¤¿à¤¸à¤°</div>
                <div class="priority-badge" style="display: none;">4</div>
            </div>
        </div>

        <!-- Mission Panel -->
        <div class="mission-panel">
            <!-- English Panel -->
            <div class="lang-content active" data-lang="en">
                <h2 class="panel-title">ðŸ“‹ Mission Control</h2>
                
                <div class="emergency-alert">
                    <div class="alert-header">
                        <span class="alert-icon">ðŸš¨</span>
                        <h3 class="alert-title">Critical Health Emergency</h3>
                    </div>
                    <p>A severe malaria outbreak is spreading rapidly through Nyanja Village. Latest WHO 2024 data shows 597,000 malaria deaths globally with 263 million cases. As a medical expert, you must use scientific knowledge and evidence-based strategies to save lives and prevent further transmission.</p>
                </div>
                
                <div class="current-mission">
                    <div class="mission-header">
                        <span class="alert-icon">ðŸŽ¯</span>
                        <h3 class="mission-title">Current Mission</h3>
                    </div>
                    <p id="current-mission-text">Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!</p>
                </div>
            </div>

            <!-- Hindi Panel -->
            <div class="lang-content hindi-text" data-lang="hi">
                <h2 class="panel-title">ðŸ“‹ à¤®à¤¿à¤¶à¤¨ à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£</h2>
                
                <div class="emergency-alert">
                    <div class="alert-header">
                        <span class="alert-icon">ðŸš¨</span>
                        <h3 class="alert-title">à¤—à¤‚à¤­à¥€à¤° à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²</h3>
                    </div>
                    <p>à¤¨à¥à¤¯à¤¾à¤‚à¤œà¤¾ à¤—à¤¾à¤‚à¤µ à¤®à¥‡à¤‚ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¤¾ à¤—à¤‚à¤­à¥€à¤° à¤ªà¥à¤°à¤•à¥‹à¤ª à¤¤à¥‡à¤œà¥€ à¤¸à¥‡ à¤«à¥ˆà¤² à¤°à¤¹à¤¾ à¤¹à¥ˆà¥¤ à¤¨à¤µà¥€à¤¨à¤¤à¤® WHO 2024 à¤†à¤‚à¤•à¤¡à¤¼à¥‡ 263 à¤®à¤¿à¤²à¤¿à¤¯à¤¨ à¤®à¤¾à¤®à¤²à¥‹à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤µà¤¿à¤¶à¥à¤µà¤µà¥à¤¯à¤¾à¤ªà¥€ à¤¸à¥à¤¤à¤° à¤ªà¤° 597,000 à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤®à¥ƒà¤¤à¥à¤¯à¥ à¤¦à¤°à¥à¤¶à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤à¤• à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤ž à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚, à¤†à¤ªà¤•à¥‹ à¤µà¥ˆà¤œà¥à¤žà¤¾à¤¨à¤¿à¤• à¤œà¥à¤žà¤¾à¤¨ à¤”à¤° à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤°à¤£à¤¨à¥€à¤¤à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤œà¥€à¤µà¤¨ à¤¬à¤šà¤¾à¤¨à¤¾ à¤”à¤° à¤†à¤—à¥‡ à¤•à¥‡ à¤¸à¤‚à¤šà¤°à¤£ à¤•à¥‹ à¤°à¥‹à¤•à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾à¥¤</p>
                </div>
                
                <div class="current-mission">
                    <div class="mission-header">
                        <span class="alert-icon">ðŸŽ¯</span>
                        <h3 class="mission-title">à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤®à¤¿à¤¶à¤¨</h3>
                    </div>
                    <p id="current-mission-text-hi">à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤•à¥à¤²à¤¿à¤¨à¤¿à¤• à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤œà¤¹à¤¾à¤‚ à¤à¤• à¤—à¤‚à¤­à¥€à¤° à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤° 8 à¤µà¤°à¥à¤·à¥€à¤¯ à¤°à¥‹à¤—à¥€ à¤•à¥‹ à¤¤à¤¤à¥à¤•à¤¾à¤² à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤¨à¤¿à¤¦à¤¾à¤¨ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤œà¥€à¤µà¤¨ à¤†à¤ªà¤•à¥€ à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤žà¤¤à¤¾ à¤ªà¤° à¤¨à¤¿à¤°à¥à¤­à¤° à¤¹à¥ˆ!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mission Modal -->
    <div class="modal" id="mission-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Mission Details</h2>
                <button class="close-btn" onclick="closeMissionModal()">Ã—</button>
            </div>
            <div id="modal-content">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="completion-modal" id="completion-modal">
        <div class="completion-content">
            <!-- English Completion -->
            <div class="lang-content active" data-lang="en">
                <h2 class="completion-title">ðŸ† Mission Accomplished!</h2>
                <p>Congratulations! You've successfully helped protect Nyanja Village from malaria using scientific evidence and proven medical strategies.</p>
                
                <div class="completion-stats">
                    <div class="completion-stat">
                        <div class="completion-number" id="final-lives">0</div>
                        <div class="completion-label">Lives Protected</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number" id="final-points">0</div>
                        <div class="completion-label">Knowledge Points</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number">100%</div>
                        <div class="completion-label">Village Protected</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="action-btn" onclick="showCertificateModal()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        ðŸŽ“ Get Certificate
                    </button>
                    <button class="action-btn" onclick="restartGame()">ðŸŽ® Play Again</button>
                </div>
            </div>

            <!-- Hindi Completion -->
            <div class="lang-content hindi-text" data-lang="hi">
                <h2 class="completion-title">ðŸ† à¤®à¤¿à¤¶à¤¨ à¤ªà¥‚à¤°à¥à¤£!</h2>
                <p>à¤¬à¤§à¤¾à¤ˆ à¤¹à¥‹! à¤†à¤ªà¤¨à¥‡ à¤µà¥ˆà¤œà¥à¤žà¤¾à¤¨à¤¿à¤• à¤¸à¤¾à¤•à¥à¤·à¥à¤¯ à¤”à¤° à¤¸à¤¿à¤¦à¥à¤§ à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤°à¤£à¤¨à¥€à¤¤à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤¨à¥à¤¯à¤¾à¤‚à¤œà¤¾ à¤—à¤¾à¤‚à¤µ à¤•à¥‹ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤¸à¥‡ à¤¬à¤šà¤¾à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¥€ à¤¹à¥ˆà¥¤</p>
                
                <div class="completion-stats">
                    <div class="completion-stat">
                        <div class="completion-number" id="final-lives-hi">0</div>
                        <div class="completion-label">à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number" id="final-points-hi">0</div>
                        <div class="completion-label">à¤œà¥à¤žà¤¾à¤¨ à¤…à¤‚à¤•</div>
                    </div>
                    <div class="completion-stat">
                        <div class="completion-number">100%</div>
                        <div class="completion-label">à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤—à¤¾à¤‚à¤µ</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="action-btn" onclick="showCertificateModal()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        ðŸŽ“ à¤ªà¥à¤°à¤®à¤¾à¤£à¤ªà¤¤à¥à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¥‡à¤‚
                    </button>
                    <button class="action-btn" onclick="restartGame()">ðŸŽ® à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥‡à¤²à¥‡à¤‚</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Glossary Modal -->
    <div class="glossary-overlay" id="glossary-overlay">
        <div class="glossary-panel">
            <div class="glossary-header">
                <h2 class="glossary-title">ðŸ“– Medical Terms Glossary</h2>
                <button onclick="closeGlossary()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
            </div>
            <input type="text" class="glossary-search" id="glossary-search" placeholder="Search medical terms...">
            <div id="glossary-content">
                <!-- Terms will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="tutorial-overlay" id="tutorial-overlay">
        <div class="tutorial-card">
            <div class="tutorial-mascot" id="tutorial-mascot">ðŸ¦Ÿ</div>
            <h2 class="tutorial-title" id="tutorial-title">Welcome to Malaria Heroes!</h2>
            <div class="tutorial-content" id="tutorial-content">
                You're about to become a malaria prevention expert! This game will teach you how to save lives using real WHO guidelines and scientific evidence.
            </div>
            <div class="tutorial-progress">
                <div class="progress-dot active" id="progress-1"></div>
                <div class="progress-dot" id="progress-2"></div>
                <div class="progress-dot" id="progress-3"></div>
                <div class="progress-dot" id="progress-4"></div>
                <div class="progress-dot" id="progress-5"></div>
            </div>
            <div class="tutorial-buttons">
                <button class="tutorial-btn secondary" onclick="skipTutorial()">Skip Tutorial</button>
                <button class="tutorial-btn primary" onclick="nextTutorialStep()" id="tutorial-next">Let's Start!</button>
            </div>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal certificate-modal" id="certificate-modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; text-align: center;">
            <div class="certificate-container" id="certificate-container">
                <div class="certificate-decorations cert-trophy">ðŸ†</div>
                <div class="certificate-decorations cert-globe">ðŸŒ</div>
                <div class="certificate-decorations cert-mosquito">ðŸ¦Ÿ</div>
                <div class="certificate-decorations cert-medical">ðŸ©º</div>
                
                <!-- English Certificate -->
                <div class="lang-content active" data-lang="en">
                    <h1 class="certificate-title">Certificate of Achievement</h1>
                    <h2 class="certificate-subtitle">Malaria Heroes Training Program</h2>
                    
                    <div style="margin: 2rem 0; font-size: 1.2rem;">
                        <p style="margin: 0.5rem 0;">This certifies that</p>
                        <div class="certificate-name" id="certificate-name">Player Name</div>
                        <p style="margin: 0.5rem 0;">has successfully completed the Malaria Heroes emergency response training</p>
                    </div>
                </div>

                <!-- Hindi Certificate -->
                <div class="lang-content hindi-text" data-lang="hi">
                    <h1 class="certificate-title">à¤‰à¤ªà¤²à¤¬à¥à¤§à¤¿ à¤ªà¥à¤°à¤®à¤¾à¤£à¤ªà¤¤à¥à¤°</h1>
                    <h2 class="certificate-subtitle">à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤µà¥€à¤° à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£ à¤•à¤¾à¤°à¥à¤¯à¤•à¥à¤°à¤®</h2>
                    
                    <div style="margin: 2rem 0; font-size: 1.2rem;">
                        <p style="margin: 0.5rem 0;">à¤¯à¤¹ à¤ªà¥à¤°à¤®à¤¾à¤£à¤¿à¤¤ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ à¤•à¤¿</p>
                        <div class="certificate-name" id="certificate-name-hi">à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¥€ à¤•à¤¾ à¤¨à¤¾à¤®</div>
                        <p style="margin: 0.5rem 0;">à¤¨à¥‡ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤µà¥€à¤° à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£ à¤ªà¥‚à¤°à¤¾ à¤•à¤¿à¤¯à¤¾ à¤¹à¥ˆ</p>
                    </div>
                </div>
                
                <div class="certificate-stats">
                    <div class="cert-stat">
                        <span class="cert-stat-number lives" id="certificate-lives">0</span>
                        <!-- English -->
                        <div class="cert-stat-label lang-content active" data-lang="en">Lives Protected</div>
                        <!-- Hindi -->
                        <div class="cert-stat-label lang-content hindi-text" data-lang="hi">à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨</div>
                    </div>
                    <div class="cert-stat">
                        <span class="cert-stat-number points" id="certificate-points">0</span>
                        <!-- English -->
                        <div class="cert-stat-label lang-content active" data-lang="en">Knowledge Points</div>
                        <!-- Hindi -->
                        <div class="cert-stat-label lang-content hindi-text" data-lang="hi">à¤œà¥à¤žà¤¾à¤¨ à¤…à¤‚à¤•</div>
                    </div>
                    <div class="cert-stat">
                        <span class="cert-stat-number success">100%</span>
                        <!-- English -->
                        <div class="cert-stat-label lang-content active" data-lang="en">Mission Success</div>
                        <!-- Hindi -->
                        <div class="cert-stat-label lang-content hindi-text" data-lang="hi">à¤®à¤¿à¤¶à¤¨ à¤¸à¤«à¤²à¤¤à¤¾</div>
                    </div>
                </div>
                
                <div class="certificate-footer">
                    <!-- English -->
                    <div class="lang-content active" data-lang="en">
                        <p>Issued on <span id="certificate-date"></span></p>
                        <p style="margin-top: 0.5rem;">WHO Malaria Prevention Guidelines â€¢ Evidence-Based Training</p>
                    </div>
                    <!-- Hindi -->
                    <div class="lang-content hindi-text" data-lang="hi">
                        <p>à¤œà¤¾à¤°à¥€ à¤•à¤°à¤¨à¥‡ à¤•à¥€ à¤¤à¤¿à¤¥à¤¿ <span id="certificate-date-hi"></span></p>
                        <p style="margin-top: 0.5rem;">WHO à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤°à¥‹à¤•à¤¥à¤¾à¤® à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ â€¢ à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£</p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <!-- English -->
                <input type="text" id="player-name-input" class="name-input lang-content active" data-lang="en" placeholder="Enter your name">
                <!-- Hindi -->
                <input type="text" id="player-name-input-hi" class="name-input lang-content hindi-text" data-lang="hi" placeholder="à¤…à¤ªà¤¨à¤¾ à¤¨à¤¾à¤® à¤²à¤¿à¤–à¥‡à¤‚">
            </div>
            
            <div class="cert-buttons">
                <!-- English -->
                <div class="lang-content active" data-lang="en">
                    <button onclick="generateCertificate()" class="cert-btn generate">Generate Certificate</button>
                    <button onclick="downloadCertificate()" class="cert-btn download">Download PNG</button>
                    <button onclick="closeCertificateModal()" class="cert-btn close">Close</button>
                </div>
                <!-- Hindi -->
                <div class="lang-content hindi-text" data-lang="hi">
                    <button onclick="generateCertificate()" class="cert-btn generate">à¤ªà¥à¤°à¤®à¤¾à¤£à¤ªà¤¤à¥à¤° à¤¬à¤¨à¤¾à¤à¤‚</button>
                    <button onclick="downloadCertificate()" class="cert-btn download">PNG à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚</button>
                    <button onclick="closeCertificateModal()" class="cert-btn close">à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentLanguage: 'en',
            livesProtected: 0,
            knowledgePoints: 0,
            missionsCompleted: 0,
            currentMission: 'clinic',
            completedMissions: []
        };

        // Mission tracking
        let selectedSymptoms = [];
        let protectedStudents = [];
        let selectedEducationMethods = [];
        let foundBreedingSites = [];
        let breedingHelpShown = false;
        let breedingAttempts = 0;
        let tutorialStep = 0;

        // Simple anchored explanation popover (auto-dismiss)
        function showExplanation(anchorEl, html, type = 'info') {
            const pop = document.createElement('div');
            pop.style.position = 'fixed';
            const rect = anchorEl.getBoundingClientRect();
            pop.style.left = (rect.left + rect.width / 2) + 'px';
            pop.style.top = (rect.top - 12) + 'px';
            pop.style.transform = 'translate(-50%, -100%)';
            pop.style.zIndex = '5000';
            pop.style.maxWidth = '280px';
            pop.style.padding = '10px 12px';
            pop.style.borderRadius = '10px';
            pop.style.fontSize = '0.9rem';
            pop.style.lineHeight = '1.3';
            pop.style.color = '#111827';
            pop.style.background = '#ffffff';
            pop.style.border = '2px solid ' + (type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#93c5fd');
            pop.style.boxShadow = '0 8px 24px rgba(0,0,0,0.18)';
            pop.innerHTML = html;

            document.body.appendChild(pop);
            setTimeout(() => { pop.remove(); }, 2500);
        }

        // Breeding-site explanations (correct and wrong)
        const breedingExplanations = {
            'water-barrel':   { correct: 'Standing water in barrels can allow larvae to develop in 7â€“14 days.' },
            'plant-saucers':  { correct: 'Plant saucers collect water after rain; classic larval habitat.' },
            'roof-gutter':    { correct: 'Blocked gutters trap water. Anopheles can breed in these pools.' },
            'old-bucket':     { correct: 'Unused buckets often hold rainwaterâ€”prime breeding habitat.' },
            'flower-vase':    { correct: 'Water retained in vases supports larval growth.' },
            'tire-planter':   { correct: 'Tires collect rainwater; WHO notes them as common breeding sites.' },

            'tree-base':      { wrong: 'Dry tree bases without water do not support aquatic larvae.' },
            'dry-garden':     { wrong: 'No standing waterâ€”mosquitoes cannot complete their aquatic stages.' },
            'house-wall':     { wrong: 'Solid walls don\'t hold water; larvae require standing water.' },
            'flowing-drain':  { wrong: 'Flowing water flushes larvae; stagnant pools are the risk.' },
            'solid-pavement': { wrong: 'No water retentionâ€”no larval development possible.' },
            'hanging-clothes':{ wrong: 'Clothes do not provide water; not a breeding habitat.' }
        };

        // Clinic symptom immediate explanations
        const symptomFeedback = {
            fever:   { type: 'success', msg: 'Fever â‰¥38Â°C is the primary clinical sign in malaria (WHO).' },
            headache:{ type: 'success', msg: 'Headache is common with malaria fever paroxysms.' },
            chills:  { type: 'success', msg: 'Chills/sweats are hallmark paroxysm features.' },
            nausea:  { type: 'success', msg: 'Nausea/vomiting are frequent in pediatric malaria.' },
            fatigue: { type: 'success', msg: 'Systemic fatigue/malaise are typical with malaria.' },

            rash:    { type: 'error',   msg: 'Rash is uncommon in malariaâ€”suggests another etiology.' },
            cough:   { type: 'error',   msg: 'Persistent cough is not typical in uncomplicated malaria.' },
            throat:  { type: 'error',   msg: 'Sore throat suggests an upper respiratory cause, not malaria.' }
        };

        // Language switching
        function switchLanguage(lang) {
            gameState.currentLanguage = lang;
            
            // Update active language button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide language content
            document.querySelectorAll('.lang-content').forEach(content => {
                content.classList.remove('active');
                if (content.dataset.lang === lang) {
                    content.classList.add('active');
                }
            });
        }

        // Save progress functionality
        function saveProgress() {
            const progressData = {
                gameState: gameState,
                selectedSymptoms: selectedSymptoms,
                protectedStudents: protectedStudents,
                selectedEducationMethods: selectedEducationMethods,
                foundBreedingSites: foundBreedingSites,
                breedingHelpShown: breedingHelpShown,
                breedingAttempts: breedingAttempts,
                timestamp: Date.now()
            };
            
            try {
                localStorage.setItem('malariaHeroesProgress', JSON.stringify(progressData));
                console.log('Progress saved successfully');
                return true;
            } catch (error) {
                console.error('Failed to save progress:', error);
                return false;
            }
        }

        function loadProgress() {
            try {
                const savedData = localStorage.getItem('malariaHeroesProgress');
                if (savedData) {
                    const progressData = JSON.parse(savedData);
                    
                    // Check if save is not too old (7 days)
                    const daysSinceSave = (Date.now() - progressData.timestamp) / (1000 * 60 * 60 * 24);
                    if (daysSinceSave > 7) {
                        localStorage.removeItem('malariaHeroesProgress');
                        return false;
                    }
                    
                    // Restore game state
                    gameState = { ...gameState, ...progressData.gameState };
                    selectedSymptoms = progressData.selectedSymptoms || [];
                    protectedStudents = progressData.protectedStudents || [];
                    selectedEducationMethods = progressData.selectedEducationMethods || [];
                    foundBreedingSites = progressData.foundBreedingSites || [];
                    breedingHelpShown = progressData.breedingHelpShown || false;
                    breedingAttempts = progressData.breedingAttempts || 0;
                    
                    updateStats();
                    updateUI();
                    return true;
                }
            } catch (error) {
                console.error('Failed to load progress:', error);
                localStorage.removeItem('malariaHeroesProgress');
            }
            return false;
        }

        function updateUI() {
            // Update location states based on completed missions
            const locations = ['clinic', 'school', 'market', 'homes'];
            locations.forEach((locationId, index) => {
                const location = document.getElementById(locationId + '-location') || document.querySelector('.' + locationId);
                if (location) {
                    if (gameState.completedMissions.includes(locationId)) {
                        location.classList.add('completed');
                        location.classList.remove('disabled');
                    } else if (index > 0 && !gameState.completedMissions.includes(locations[index - 1])) {
                        location.classList.add('disabled');
                        location.classList.remove('completed');
                    } else if (index === 0) {
                        location.classList.remove('disabled', 'completed');
                    }
                }
            });
            
            // Update current mission text
            const currentMissionText = document.getElementById('current-mission-text');
            const currentMissionTextHi = document.getElementById('current-mission-text-hi');
            
            if (gameState.completedMissions.length === 0) {
                if (currentMissionText) currentMissionText.textContent = 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!';
                if (currentMissionTextHi) currentMissionTextHi.textContent = 'à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤•à¥à¤²à¤¿à¤¨à¤¿à¤• à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤œà¤¹à¤¾à¤‚ à¤à¤• à¤—à¤‚à¤­à¥€à¤° à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤° 8 à¤µà¤°à¥à¤·à¥€à¤¯ à¤°à¥‹à¤—à¥€ à¤•à¥‹ à¤¤à¤¤à¥à¤•à¤¾à¤² à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤¨à¤¿à¤¦à¤¾à¤¨ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤œà¥€à¤µà¤¨ à¤†à¤ªà¤•à¥€ à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤žà¤¤à¤¾ à¤ªà¤° à¤¨à¤¿à¤°à¥à¤­à¤° à¤¹à¥ˆ!';
            } else if (gameState.completedMissions.length < 4) {
                const nextMission = ['school', 'market', 'homes'][gameState.completedMissions.length - 1];
                const missionTexts = {
                    school: {
                        en: 'Visit the Village School to help protect students from malaria using evidence-based strategies.',
                        hi: 'à¤—à¤¾à¤‚à¤µ à¤•à¥‡ à¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯ à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤”à¤° à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤°à¤£à¤¨à¥€à¤¤à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥‹ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤¸à¥‡ à¤¬à¤šà¤¾à¤¨à¥‡ à¤®à¥‡à¤‚ à¤®à¤¦à¤¦ à¤•à¤°à¥‡à¤‚à¥¤'
                    },
                    market: {
                        en: 'Visit the Community Market to educate villagers about malaria prevention methods.',
                        hi: 'à¤¸à¤¾à¤®à¥à¤¦à¤¾à¤¯à¤¿à¤• à¤¬à¤¾à¤œà¤¾à¤° à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤”à¤° à¤—à¥à¤°à¤¾à¤®à¥€à¤£à¥‹à¤‚ à¤•à¥‹ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤°à¥‹à¤•à¤¥à¤¾à¤® à¤•à¥‡ à¤¤à¤°à¥€à¤•à¥‹à¤‚ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤¶à¤¿à¤•à¥à¤·à¤¿à¤¤ à¤•à¤°à¥‡à¤‚à¥¤'
                    },
                    homes: {
                        en: 'Visit Family Compounds to identify and eliminate mosquito breeding sites.',
                        hi: 'à¤ªà¤¾à¤°à¤¿à¤µà¤¾à¤°à¤¿à¤• à¤ªà¤°à¤¿à¤¸à¤°à¥‹à¤‚ à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤”à¤° à¤®à¤šà¥à¤›à¤° à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤¸à¥à¤¥à¤²à¥‹à¤‚ à¤•à¥€ à¤ªà¤¹à¤šà¤¾à¤¨ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤‰à¤¨à¥à¤¹à¥‡à¤‚ à¤¸à¤®à¤¾à¤ªà¥à¤¤ à¤•à¤°à¥‡à¤‚à¥¤'
                    }
                };
                if (currentMissionText) currentMissionText.textContent = missionTexts[nextMission].en;
                if (currentMissionTextHi) currentMissionTextHi.textContent = missionTexts[nextMission].hi;
            }
        }

        // Auto-save progress every 30 seconds
        setInterval(saveProgress, 30000);

        // Save progress on page unload
        window.addEventListener('beforeunload', saveProgress);

        // Translate performance ratings
        function translatePerformance(performance, lang) {
            const translations = {
                en: {
                    'excellent': 'EXCELLENT',
                    'good': 'GOOD',
                    'satisfactory': 'SATISFACTORY',
                    'needs-improvement': 'NEEDS IMPROVEMENT'
                },
                hi: {
                    'excellent': 'à¤‰à¤¤à¥à¤•à¥ƒà¤·à¥à¤Ÿ',
                    'good': 'à¤…à¤šà¥à¤›à¤¾',
                    'satisfactory': 'à¤¸à¤‚à¤¤à¥‹à¤·à¤œà¤¨à¤•',
                    'needs-improvement': 'à¤¸à¥à¤§à¤¾à¤° à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾'
                }
            };
            return translations[lang][performance] || performance.toUpperCase();
        }

        // Update stats display
        function updateStats() {
            document.getElementById('livesProtected').textContent = gameState.livesProtected;
            document.getElementById('knowledgePoints').textContent = gameState.knowledgePoints;
            document.getElementById('missionsCompleted').textContent = gameState.missionsCompleted;
        }

        // Glossary System
        const glossaryTerms = [
            {
                term: "Vector Control",
                icon: "ðŸ¦Ÿ",
                simple: "Stopping mosquitoes from breeding and spreading disease",
                medical: "Methods to eliminate or reduce disease-carrying organisms"
            },
            {
                term: "WHO (World Health Organization)",
                icon: "ðŸŒ",
                simple: "The world's main health authority that creates guidelines for treating diseases",
                medical: "United Nations specialized agency responsible for international public health"
            },
            {
                term: "Mortality Rate",
                icon: "ðŸ“‰",
                simple: "How many people die from a disease",
                medical: "The number of deaths in a population from a specific cause"
            },
            {
                term: "Anopheles Mosquito",
                icon: "ðŸ¦Ÿ",
                simple: "The specific type of mosquito that carries malaria",
                medical: "Genus of mosquitoes that transmit malaria parasites"
            },
            {
                term: "Malaria Parasite",
                icon: "ðŸ”¬",
                simple: "Tiny organisms that live in mosquitoes and cause malaria",
                medical: "Plasmodium species that infect human red blood cells"
            },
            {
                term: "Bed Net",
                icon: "ðŸ›ï¸",
                simple: "Special netting that protects people from mosquito bites while sleeping",
                medical: "Insecticide-treated netting used for malaria prevention"
            },
            {
                term: "Breeding Site",
                icon: "ðŸ’§",
                simple: "Places where mosquitoes lay eggs and grow",
                medical: "Standing water locations where mosquito larvae develop"
            },
            {
                term: "Fever",
                icon: "ðŸŒ¡ï¸",
                simple: "When your body temperature is higher than normal",
                medical: "Elevated body temperature above 38Â°C (100.4Â°F)"
            },
            {
                term: "Diagnosis",
                icon: "ðŸ”",
                simple: "Finding out what disease someone has",
                medical: "Identification of a disease through examination and testing"
            },
            {
                term: "Prevention",
                icon: "ðŸ›¡ï¸",
                simple: "Stopping something bad from happening",
                medical: "Actions taken to avoid disease occurrence"
            },
            {
                term: "Epidemic",
                icon: "ðŸ“ˆ",
                simple: "When many people in an area get the same disease",
                medical: "Rapid spread of disease to many people in a short time"
            },
            {
                term: "Endemic",
                icon: "ðŸ“",
                simple: "A disease that is always present in a certain area",
                medical: "Constant presence of a disease in a geographic area"
            },
            {
                term: "Immunity",
                icon: "ðŸ’ª",
                simple: "Your body's ability to fight off diseases",
                medical: "Biological resistance to infectious diseases"
            },
            {
                term: "Transmission",
                icon: "ðŸ”„",
                simple: "How a disease spreads from one person to another",
                medical: "Process by which infectious agents are spread"
            },
            {
                term: "Treatment",
                icon: "ðŸ’Š",
                simple: "Medicine or care given to make someone better",
                medical: "Medical intervention to cure or manage disease"
            }
        ];

        function openGlossary() {
            document.getElementById('glossary-overlay').classList.add('active');
            populateGlossary();
        }

        function closeGlossary() {
            document.getElementById('glossary-overlay').classList.remove('active');
        }

        function populateGlossary() {
            const content = document.getElementById('glossary-content');
            content.innerHTML = '';
            
            glossaryTerms.forEach(term => {
                const termDiv = document.createElement('div');
                termDiv.className = 'glossary-term';
                termDiv.innerHTML = `
                    <div class="term-title">
                        <span>${term.icon}</span>
                        ${term.term}
                    </div>
                    <div class="term-simple">${term.simple}</div>
                    <div class="term-medical">Medical: ${term.medical}</div>
                `;
                content.appendChild(termDiv);
            });

            // Add search functionality
            const searchInput = document.getElementById('glossary-search');
            searchInput.addEventListener('input', filterGlossary);
        }

        function filterGlossary() {
            const searchTerm = document.getElementById('glossary-search').value.toLowerCase();
            const terms = document.querySelectorAll('.glossary-term');
            
            terms.forEach(term => {
                const text = term.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    term.style.display = 'block';
                } else {
                    term.style.display = 'none';
                }
            });
        }

        // Expandable Feedback Functions
        function createExpandableSection(title, content, icon = "ðŸ”¬") {
            const section = document.createElement('div');
            section.className = 'expandable-section';
            section.innerHTML = `
                <div class="expandable-header" onclick="toggleExpandable(this)">
                    <div class="expandable-title">
                        <span>${icon}</span>
                        ${title}
                    </div>
                    <span class="expand-icon">â–¼</span>
                </div>
                <div class="expandable-content">
                    <div class="expandable-body">
                        ${content}
                    </div>
                </div>
            `;
            return section;
        }

        function toggleExpandable(header) {
            const content = header.nextElementSibling;
            const isExpanded = header.classList.contains('expanded');
            
            if (isExpanded) {
                header.classList.remove('expanded');
                content.classList.remove('expanded');
            } else {
                header.classList.add('expanded');
                content.classList.add('expanded');
            }
        }

        const tutorialSteps = [
            {
                mascot: 'ðŸ¦Ÿ',
                title: 'Welcome to Malaria Heroes!',
                content: 'You\'re about to become a malaria prevention expert! This game will teach you how to save lives using real WHO guidelines and scientific evidence.',
                nextText: 'Let\'s Start!'
            },
            {
                mascot: 'ðŸ—ºï¸',
                title: 'Navigate the Village Map',
                content: 'Click on the location cards to start missions. Each location has different challenges that teach you about malaria prevention.',
                nextText: 'Got It!'
            },
            {
                mascot: 'ðŸ“Š',
                title: 'Understanding Your Progress',
                content: 'Watch your stats grow as you complete missions! Knowledge Points show how much you\'ve learned, and Lives Protected shows your real impact.',
                nextText: 'Continue'
            },
            {
                mascot: 'ðŸ”¬',
                title: 'Learn from WHO Guidelines',
                content: 'Every decision you make is based on real scientific evidence. Read the detailed explanations to understand why certain choices save more lives.',
                nextText: 'Almost Done!'
            },
            {
                mascot: 'ðŸ†',
                title: 'Ready to Save Nyanja Village!',
                content: 'You\'re all set! Remember: there are no wrong answers here - every choice teaches you something valuable. Let\'s start saving lives!',
                nextText: 'Start Mission!'
            }
        ];

        function startTutorial() {
            tutorialStep = 0;
            showTutorialStep();
            document.getElementById('tutorial-overlay').classList.add('active');
        }

        function showTutorialStep() {
            const step = tutorialSteps[tutorialStep];
            document.getElementById('tutorial-mascot').textContent = step.mascot;
            document.getElementById('tutorial-title').textContent = step.title;
            document.getElementById('tutorial-content').textContent = step.content;
            document.getElementById('tutorial-next').textContent = step.nextText;

            // Update progress dots
            for (let i = 1; i <= 5; i++) {
                const dot = document.getElementById(`progress-${i}`);
                if (i <= tutorialStep + 1) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            }
        }

        function nextTutorialStep() {
            tutorialStep++;
            if (tutorialStep >= tutorialSteps.length) {
                closeTutorial();
            } else {
                showTutorialStep();
            }
        }

        function skipTutorial() {
            closeTutorial();
        }

        function closeTutorial() {
            document.getElementById('tutorial-overlay').classList.remove('active');
            // Mark tutorial as completed
            localStorage.setItem('malariaHeroesTutorialComplete', 'true');
        }

        // Initialize game
        function initializeGame() {
            // Check if we're on GitHub Pages or similar hosting
            const isGitHubHosted = window.location.hostname.includes('github.io') || 
                                  window.location.hostname.includes('github.com') ||
                                  window.location.hostname.includes('pages.dev') ||
                                  window.location.hostname.includes('netlify.app');
            
            // For GitHub hosting, always start fresh and clear any saved progress
            if (isGitHubHosted) {
                localStorage.removeItem('malariaHeroesProgress');
                localStorage.removeItem('malariaHeroesTutorialComplete');
                console.log('GitHub hosting detected - starting fresh game');
                updateStats();
                updateUI();
                
                // Always show tutorial for GitHub hosted games
                setTimeout(() => {
                    startTutorial();
                }, 1000);
                return;
            }
            
            // For local hosting, try to load saved progress
            if (loadProgress()) {
                console.log('Previous progress loaded');
            } else {
                console.log('Starting new game');
                updateStats();
                updateUI();
                
                // Always show tutorial for new games
                setTimeout(() => {
                    startTutorial();
                }, 1000);
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeGame);

        // Open mission modal
        function openMission(missionId) {
            const location = document.getElementById(missionId + '-location') || document.querySelector('.' + missionId);
            
            if (location && location.classList.contains('disabled')) {
                const messages = {
                    en: 'Complete previous missions first!',
                    hi: 'à¤ªà¤¹à¤²à¥‡ à¤ªà¤¿à¤›à¤²à¥‡ à¤®à¤¿à¤¶à¤¨ à¤ªà¥‚à¤°à¥‡ à¤•à¤°à¥‡à¤‚!'
                };
                alert(messages[gameState.currentLanguage]);
                return;
            }
            
            if (gameState.completedMissions.includes(missionId)) {
                const messages = {
                    en: 'Mission already completed!',
                    hi: 'à¤®à¤¿à¤¶à¤¨ à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤ªà¥‚à¤°à¤¾ à¤¹à¥ˆ!'
                };
                alert(messages[gameState.currentLanguage]);
                return;
            }

            document.getElementById('mission-modal').classList.add('active');
            loadMissionContent(missionId);
        }

        // Close mission modal
        function closeMissionModal() {
            document.getElementById('mission-modal').classList.remove('active');
        }

        // Load mission content
        function loadMissionContent(missionId) {
            const titles = {
                en: {
                    clinic: 'ðŸ¥ Emergency Clinic - Patient Diagnosis',
                    school: 'ðŸ« Village School - Student Protection',
                    market: 'ðŸª Community Market - Health Education',
                    homes: 'ðŸ  Family Compounds - Vector Control'
                },
                hi: {
                    clinic: 'ðŸ¥ à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤•à¥à¤²à¤¿à¤¨à¤¿à¤• - à¤°à¥‹à¤—à¥€ à¤¨à¤¿à¤¦à¤¾à¤¨',
                    school: 'ðŸ« à¤—à¤¾à¤‚à¤µ à¤•à¤¾ à¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯ - à¤›à¤¾à¤¤à¥à¤° à¤¸à¤‚à¤°à¤•à¥à¤·à¤£',
                    market: 'ðŸª à¤¸à¤¾à¤®à¥à¤¦à¤¾à¤¯à¤¿à¤• à¤¬à¤¾à¤œà¤¾à¤° - à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¶à¤¿à¤•à¥à¤·à¤¾',
                    homes: 'ðŸ  à¤ªà¤¾à¤°à¤¿à¤µà¤¾à¤°à¤¿à¤• à¤ªà¤°à¤¿à¤¸à¤° - à¤µà¥‡à¤•à¥à¤Ÿà¤° à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£'
                }
            };

            document.getElementById('modal-title').textContent = titles[gameState.currentLanguage][missionId];

            if (missionId === 'clinic') {
                loadClinicMission();
            } else if (missionId === 'school') {
                loadSchoolMission();
            } else if (missionId === 'market') {
                loadMarketMission();
            } else if (missionId === 'homes') {
                loadHomesMission();
            }
        }

        // CLINIC MISSION
        function loadClinicMission() {
            selectedSymptoms = [];
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘¨â€âš•ï¸</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">Dr. Kwame Asante - Head of Emergency Medicine</div>
                                <p>"We have a critically ill 8-year-old child with high fever. The symptoms started 3 days ago and are worsening rapidly. I need your expertise to identify which symptoms are consistent with malaria based on WHO clinical guidelines. Every second counts!"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ©º Clinical Symptom Assessment</h3>
                        <p class="challenge-description">Select ALL symptoms that are consistent with malaria diagnosis according to WHO 2024 guidelines. Accurate identification is crucial for immediate treatment.</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-symptom="fever" onclick="toggleSymptom('fever')">
                                <div class="option-icon">ðŸŒ¡ï¸</div>
                                <div class="option-name">High fever (39.5Â°C)</div>
                            </div>
                            <div class="option-card" data-symptom="headache" onclick="toggleSymptom('headache')">
                                <div class="option-icon">ðŸ¤•</div>
                                <div class="option-name">Severe headache</div>
                            </div>
                            <div class="option-card" data-symptom="chills" onclick="toggleSymptom('chills')">
                                <div class="option-icon">ðŸ¥¶</div>
                                <div class="option-name">Chills and sweats</div>
                            </div>
                            <div class="option-card" data-symptom="nausea" onclick="toggleSymptom('nausea')">
                                <div class="option-icon">ðŸ¤¢</div>
                                <div class="option-name">Nausea and vomiting</div>
                            </div>
                            <div class="option-card" data-symptom="fatigue" onclick="toggleSymptom('fatigue')">
                                <div class="option-icon">ðŸ˜´</div>
                                <div class="option-name">Extreme fatigue</div>
                            </div>
                            <div class="option-card" data-symptom="rash" onclick="toggleSymptom('rash')">
                                <div class="option-icon">ðŸ”´</div>
                                <div class="option-name">Skin rash</div>
                            </div>
                            <div class="option-card" data-symptom="cough" onclick="toggleSymptom('cough')">
                                <div class="option-icon">ðŸ˜·</div>
                                <div class="option-name">Persistent cough</div>
                            </div>
                            <div class="option-card" data-symptom="throat" onclick="toggleSymptom('throat')">
                                <div class="option-icon">ðŸ˜£</div>
                                <div class="option-name">Sore throat</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="clinic-feedback"></div>
                        <button class="action-btn" id="clinic-submit" onclick="evaluateClinicDiagnosis()" disabled>ðŸ©º Submit Diagnosis</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘¨â€âš•ï¸</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">à¤¡à¥‰. à¤•à¥à¤µà¤¾à¤®à¥‡ à¤…à¤¸à¤¾à¤‚à¤¤à¥‡ - à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤ªà¥à¤°à¤®à¥à¤–</div>
                                <p>"à¤¹à¤®à¤¾à¤°à¥‡ à¤ªà¤¾à¤¸ à¤¤à¥‡à¤œ à¤¬à¥à¤–à¤¾à¤° à¤•à¥‡ à¤¸à¤¾à¤¥ à¤—à¤‚à¤­à¥€à¤° à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤° 8 à¤¸à¤¾à¤² à¤•à¤¾ à¤¬à¤šà¥à¤šà¤¾ à¤¹à¥ˆà¥¤ à¤²à¤•à¥à¤·à¤£ 3 à¤¦à¤¿à¤¨ à¤ªà¤¹à¤²à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥à¤ à¤”à¤° à¤¤à¥‡à¤œà¥€ à¤¸à¥‡ à¤¬à¤¿à¤—à¤¡à¤¼ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤®à¥à¤à¥‡ à¤†à¤ªà¤•à¥€ à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤žà¤¤à¤¾ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆ à¤•à¤¿ WHO à¤¨à¥ˆà¤¦à¤¾à¤¨à¤¿à¤• à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶à¥‹à¤‚ à¤•à¥‡ à¤†à¤§à¤¾à¤° à¤ªà¤° à¤•à¥Œà¤¨ à¤¸à¥‡ à¤²à¤•à¥à¤·à¤£ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤…à¤¨à¥à¤•à¥‚à¤² à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤° à¤¸à¥‡à¤•à¤‚à¤¡ à¤®à¤¾à¤¯à¤¨à¥‡ à¤°à¤–à¤¤à¤¾ à¤¹à¥ˆ!"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ©º à¤¨à¥ˆà¤¦à¤¾à¤¨à¤¿à¤• à¤²à¤•à¥à¤·à¤£ à¤®à¥‚à¤²à¥à¤¯à¤¾à¤‚à¤•à¤¨</h3>
                        <p class="challenge-description">WHO 2024 à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶à¥‹à¤‚ à¤•à¥‡ à¤…à¤¨à¥à¤¸à¤¾à¤° à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤¨à¤¿à¤¦à¤¾à¤¨ à¤•à¥‡ à¤…à¤¨à¥à¤•à¥‚à¤² à¤¸à¤­à¥€ à¤²à¤•à¥à¤·à¤£à¥‹à¤‚ à¤•à¤¾ à¤šà¤¯à¤¨ à¤•à¤°à¥‡à¤‚à¥¤ à¤¤à¤¤à¥à¤•à¤¾à¤² à¤‰à¤ªà¤šà¤¾à¤° à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¤Ÿà¥€à¤• à¤ªà¤¹à¤šà¤¾à¤¨ à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£ à¤¹à¥ˆà¥¤</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-symptom="fever" onclick="toggleSymptom('fever')">
                                <div class="option-icon">ðŸŒ¡ï¸</div>
                                <div class="option-name">à¤¤à¥‡à¤œ à¤¬à¥à¤–à¤¾à¤° (39.5Â°C)</div>
                            </div>
                            <div class="option-card" data-symptom="headache" onclick="toggleSymptom('headache')">
                                <div class="option-icon">ðŸ¤•</div>
                                <div class="option-name">à¤¤à¥€à¤µà¥à¤° à¤¸à¤¿à¤°à¤¦à¤°à¥à¤¦</div>
                            </div>
                            <div class="option-card" data-symptom="chills" onclick="toggleSymptom('chills')">
                                <div class="option-icon">ðŸ¥¶</div>
                                <div class="option-name">à¤•à¤‚à¤ªà¤•à¤‚à¤ªà¥€ à¤”à¤° à¤ªà¤¸à¥€à¤¨à¤¾</div>
                            </div>
                            <div class="option-card" data-symptom="nausea" onclick="toggleSymptom('nausea')">
                                <div class="option-icon">ðŸ¤¢</div>
                                <div class="option-name">à¤®à¤¤à¤²à¥€ à¤”à¤° à¤‰à¤²à¥à¤Ÿà¥€</div>
                            </div>
                            <div class="option-card" data-symptom="fatigue" onclick="toggleSymptom('fatigue')">
                                <div class="option-icon">ðŸ˜´</div>
                                <div class="option-name">à¤…à¤¤à¥à¤¯à¤§à¤¿à¤• à¤¥à¤•à¤¾à¤¨</div>
                            </div>
                            <div class="option-card" data-symptom="rash" onclick="toggleSymptom('rash')">
                                <div class="option-icon">ðŸ”´</div>
                                <div class="option-name">à¤¤à¥à¤µà¤šà¤¾ à¤ªà¤° à¤¦à¤¾à¤¨à¥‡</div>
                            </div>
                            <div class="option-card" data-symptom="cough" onclick="toggleSymptom('cough')">
                                <div class="option-icon">ðŸ˜·</div>
                                <div class="option-name">à¤²à¤—à¤¾à¤¤à¤¾à¤° à¤–à¤¾à¤‚à¤¸à¥€</div>
                            </div>
                            <div class="option-card" data-symptom="throat" onclick="toggleSymptom('throat')">
                                <div class="option-icon">ðŸ˜£</div>
                                <div class="option-name">à¤—à¤²à¥‡ à¤®à¥‡à¤‚ à¤–à¤°à¤¾à¤¶</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="clinic-feedback"></div>
                        <button class="action-btn" id="clinic-submit" onclick="evaluateClinicDiagnosis()" disabled>ðŸ©º à¤¨à¤¿à¤¦à¤¾à¤¨ à¤ªà¥à¤°à¤¸à¥à¤¤à¥à¤¤ à¤•à¤°à¥‡à¤‚</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Toggle symptom selection with immediate explanation
        function toggleSymptom(symptomId) {
            const symptomCard = document.querySelector(`[data-symptom="${symptomId}"]`);

            const wasSelected = selectedSymptoms.includes(symptomId);
            if (wasSelected) {
                selectedSymptoms = selectedSymptoms.filter(s => s !== symptomId);
                symptomCard.classList.remove('selected');
                playSound('incorrect');
            } else {
                selectedSymptoms.push(symptomId);
                symptomCard.classList.add('selected');
                playSound('correct');
            }

            // Immediate explanation next to the card (correct vs wrong)
            const fb = symptomFeedback[symptomId];
            if (fb) {
                const html = (fb.type === 'success' ? 'âœ… ' : 'âŒ ') + fb.msg;
                showExplanation(symptomCard, html, fb.type === 'success' ? 'success' : 'error');
            }

            document.getElementById('clinic-submit').disabled = selectedSymptoms.length === 0;
        }

        // Evaluate clinic diagnosis
        function evaluateClinicDiagnosis() {
            const correctSymptoms = ['fever', 'headache', 'chills', 'nausea', 'fatigue'];
            const incorrectSymptoms = ['rash', 'cough', 'throat'];
            
            let correctCount = 0;
            let incorrectCount = 0;
            
            // Evaluate each selected symptom
            selectedSymptoms.forEach(symptomId => {
                const symptomCard = document.querySelector(`[data-symptom="${symptomId}"]`);
                if (correctSymptoms.includes(symptomId)) {
                    symptomCard.classList.add('correct');
                    correctCount++;
                } else {
                    symptomCard.classList.add('incorrect');
                    incorrectCount++;
                }
            });
            
            // Add detailed explanation for each symptom with WHO information
            const feedbackPanel = document.getElementById('clinic-feedback');
            feedbackPanel.innerHTML = ''; // Clear any existing content first
            
            const lang = gameState.currentLanguage;
            let explanationHTML = '<div style="margin-top: 1rem;"><h4>' +
                (lang === 'en' ? 'WHO Clinical Guidelines Analysis:' : 'WHO à¤¨à¥ˆà¤¦à¤¾à¤¨à¤¿à¤• à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£:') + '</h4><ul>';

            // Define detailed explanations for each symptom
            const symptomExplanations = {
                en: {
                    fever: 'âœ… <strong>High Fever (39.5Â°C)</strong> - WHO lists fever as the primary symptom of malaria. Temperature above 38Â°C with no other obvious cause is considered malaria until proven otherwise in endemic areas.',
                    headache: 'âœ… <strong>Severe Headache</strong> - WHO identifies headache as one of the classic triad of malaria symptoms (fever, headache, chills). Present in 80-90% of malaria cases.',
                    chills: 'âœ… <strong>Chills and Sweats</strong> - WHO recognizes chills and sweating as hallmark symptoms of malaria, especially during the febrile paroxysms that occur every 48-72 hours.',
                    nausea: 'âœ… <strong>Nausea and Vomiting</strong> - WHO guidelines include gastrointestinal symptoms like nausea and vomiting as common in malaria, especially in children.',
                    fatigue: 'âœ… <strong>Extreme Fatigue</strong> - WHO identifies fatigue and malaise as typical symptoms of malaria due to the body\'s inflammatory response to the parasite.',
                    rash: 'âŒ <strong>Skin Rash</strong> - WHO guidelines state that rash is NOT a typical malaria symptom. This suggests other conditions like viral infections or allergic reactions.',
                    cough: 'âŒ <strong>Persistent Cough</strong> - WHO notes that respiratory symptoms like cough are uncommon in uncomplicated malaria and may indicate other diseases or complications.',
                    throat: 'âŒ <strong>Sore Throat</strong> - WHO guidelines indicate that sore throat is NOT associated with malaria and suggests upper respiratory infections instead.'
                },
                hi: {
                    fever: 'âœ… <strong>à¤¤à¥‡à¤œ à¤¬à¥à¤–à¤¾à¤° (39.5Â°C)</strong> - WHO à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤• à¤²à¤•à¥à¤·à¤£ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤¬à¥à¤–à¤¾à¤° à¤•à¥‹ à¤¸à¥‚à¤šà¥€à¤¬à¤¦à¥à¤§ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤¸à¥à¤¥à¤¾à¤¨à¤¿à¤• à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¥‹à¤‚ à¤®à¥‡à¤‚ 38Â°C à¤¸à¥‡ à¤…à¤§à¤¿à¤• à¤¤à¤¾à¤ªà¤®à¤¾à¤¨ à¤•à¥‹ à¤…à¤¨à¥à¤¯ à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤•à¤¾à¤°à¤£ à¤•à¥‡ à¤¬à¤¿à¤¨à¤¾ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤®à¤¾à¤¨à¤¾ à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤',
                    headache: 'âœ… <strong>à¤¤à¥€à¤µà¥à¤° à¤¸à¤¿à¤°à¤¦à¤°à¥à¤¦</strong> - WHO à¤¸à¤¿à¤°à¤¦à¤°à¥à¤¦ à¤•à¥‹ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤•à¥à¤²à¤¾à¤¸à¤¿à¤• à¤¤à¥à¤°à¤¯ (à¤¬à¥à¤–à¤¾à¤°, à¤¸à¤¿à¤°à¤¦à¤°à¥à¤¦, à¤•à¤‚à¤ªà¤•à¤‚à¤ªà¥€) à¤®à¥‡à¤‚ à¤¸à¥‡ à¤à¤• à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤ªà¤¹à¤šà¤¾à¤¨à¤¤à¤¾ à¤¹à¥ˆà¥¤ 80-90% à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤®à¤¾à¤®à¤²à¥‹à¤‚ à¤®à¥‡à¤‚ à¤®à¥Œà¤œà¥‚à¤¦à¥¤',
                    chills: 'âœ… <strong>à¤•à¤‚à¤ªà¤•à¤‚à¤ªà¥€ à¤”à¤° à¤ªà¤¸à¥€à¤¨à¤¾</strong> - WHO à¤•à¤‚à¤ªà¤•à¤‚à¤ªà¥€ à¤”à¤° à¤ªà¤¸à¥€à¤¨à¥‡ à¤•à¥‹ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤ªà¥à¤°à¤®à¥à¤– à¤²à¤•à¥à¤·à¤£à¥‹à¤‚ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤ªà¤¹à¤šà¤¾à¤¨à¤¤à¤¾ à¤¹à¥ˆ, à¤µà¤¿à¤¶à¥‡à¤· à¤°à¥‚à¤ª à¤¸à¥‡ à¤¹à¤° 48-72 à¤˜à¤‚à¤Ÿà¥‡ à¤®à¥‡à¤‚ à¤¹à¥‹à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤œà¥à¤µà¤° à¤•à¥‡ à¤¦à¥Œà¤°à¤¾à¤¨à¥¤',
                    nausea: 'âœ… <strong>à¤®à¤¤à¤²à¥€ à¤”à¤° à¤‰à¤²à¥à¤Ÿà¥€</strong> - WHO à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤®à¥‡à¤‚ à¤®à¤¤à¤²à¥€ à¤”à¤° à¤‰à¤²à¥à¤Ÿà¥€ à¤œà¥ˆà¤¸à¥‡ à¤—à¥ˆà¤¸à¥à¤Ÿà¥à¤°à¥‹à¤‡à¤‚à¤Ÿà¥‡à¤¸à¥à¤Ÿà¤¾à¤‡à¤¨à¤² à¤²à¤•à¥à¤·à¤£à¥‹à¤‚ à¤•à¥‹ à¤¶à¤¾à¤®à¤¿à¤² à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚, à¤µà¤¿à¤¶à¥‡à¤· à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¤šà¥à¤šà¥‹à¤‚ à¤®à¥‡à¤‚à¥¤',
                    fatigue: 'âœ… <strong>à¤…à¤¤à¥à¤¯à¤§à¤¿à¤• à¤¥à¤•à¤¾à¤¨</strong> - WHO à¤ªà¤°à¤œà¥€à¤µà¥€ à¤•à¥‡ à¤ªà¥à¤°à¤¤à¤¿ à¤¶à¤°à¥€à¤° à¤•à¥€ à¤¸à¥‚à¤œà¤¨ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤•à¤¾à¤°à¤£ à¤¥à¤•à¤¾à¤¨ à¤”à¤° à¤¬à¥‡à¤šà¥ˆà¤¨à¥€ à¤•à¥‹ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿ à¤²à¤•à¥à¤·à¤£à¥‹à¤‚ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤ªà¤¹à¤šà¤¾à¤¨à¤¤à¤¾ à¤¹à¥ˆà¥¤',
                    rash: 'âŒ <strong>à¤¤à¥à¤µà¤šà¤¾ à¤ªà¤° à¤¦à¤¾à¤¨à¥‡</strong> - WHO à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ à¤¬à¤¤à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¤¿ à¤¦à¤¾à¤¨à¥‡ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¤¾ à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿ à¤²à¤•à¥à¤·à¤£ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ à¤¯à¤¹ à¤µà¤¾à¤¯à¤°à¤² à¤¸à¤‚à¤•à¥à¤°à¤®à¤£ à¤¯à¤¾ à¤à¤²à¤°à¥à¤œà¥€ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾à¤“à¤‚ à¤œà¥ˆà¤¸à¥€ à¤…à¤¨à¥à¤¯ à¤¸à¥à¤¥à¤¿à¤¤à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤¸à¥à¤à¤¾à¤µ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥ˆà¥¤',
                    cough: 'âŒ <strong>à¤²à¤—à¤¾à¤¤à¤¾à¤° à¤–à¤¾à¤‚à¤¸à¥€</strong> - WHO à¤¨à¥‹à¤Ÿ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ à¤•à¤¿ à¤–à¤¾à¤‚à¤¸à¥€ à¤œà¥ˆà¤¸à¥‡ à¤¶à¥à¤µà¤¸à¤¨ à¤²à¤•à¥à¤·à¤£ à¤…à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤®à¥‡à¤‚ à¤…à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤¹à¥ˆà¤‚ à¤”à¤° à¤…à¤¨à¥à¤¯ à¤¬à¥€à¤®à¤¾à¤°à¤¿à¤¯à¥‹à¤‚ à¤¯à¤¾ à¤œà¤Ÿà¤¿à¤²à¤¤à¤¾à¤“à¤‚ à¤•à¤¾ à¤¸à¤‚à¤•à¥‡à¤¤ à¤¦à¥‡ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤',
                    throat: 'âŒ <strong>à¤—à¤²à¥‡ à¤®à¥‡à¤‚ à¤–à¤°à¤¾à¤¶</strong> - WHO à¤¦à¤¿à¤¶à¤¾à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ à¤¬à¤¤à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¤¿ à¤—à¤²à¥‡ à¤®à¥‡à¤‚ à¤–à¤°à¤¾à¤¶ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤¸à¥‡ à¤œà¥à¤¡à¤¼à¥€ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ à¤”à¤° à¤‡à¤¸à¤•à¥‡ à¤¬à¤œà¤¾à¤¯ à¤Šà¤ªà¤°à¥€ à¤¶à¥à¤µà¤¸à¤¨ à¤¸à¤‚à¤•à¥à¤°à¤®à¤£ à¤•à¤¾ à¤¸à¥à¤à¤¾à¤µ à¤¦à¥‡à¤¤à¥€ à¤¹à¥ˆà¥¤'
                }
            };
        
            selectedSymptoms.forEach(symptom => {
                const isCorrect = correctSymptoms.includes(symptom);
                const color = isCorrect ? 'green' : 'red';
                explanationHTML += `<li style="color: ${color}; margin-bottom: 0.5rem;">${symptomExplanations[lang][symptom]}</li>`;
            });

            explanationHTML += '</ul>';
            
            // Calculate performance
            const accuracy = correctCount / correctSymptoms.length;
            let performance, points, lives;
            
            if (accuracy >= 0.8 && incorrectCount === 0) {
                performance = 'excellent';
                points = 150;
                lives = 12;
            } else if (accuracy >= 0.6) {
                performance = 'good';
                points = 100;
                lives = 8;
            } else if (accuracy >= 0.4) {
                performance = 'satisfactory';
                points = 75;
                lives = 5;
            } else {
                performance = 'needs-improvement';
                points = 50;
                lives = 3;
            }
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            // Add final scoring display
            explanationHTML += '<div style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            explanationHTML += '<h5>' + (lang === 'en' ? 'Mission Results:' : 'à¤®à¤¿à¤¶à¤¨ à¤ªà¤°à¤¿à¤£à¤¾à¤®:') + '</h5>';
            explanationHTML += '<p>ðŸ“ˆ <strong>' + (lang === 'en' ? 'Knowledge Points Earned:' : 'à¤…à¤°à¥à¤œà¤¿à¤¤ à¤œà¥à¤žà¤¾à¤¨ à¤…à¤‚à¤•:') + '</strong> ' + points + '</p>';
            explanationHTML += '<p>ðŸ’š <strong>' + (lang === 'en' ? 'Lives Protected:' : 'à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨:') + '</strong> ' + lives + '</p>';
            explanationHTML += '<p>ðŸ† <strong>' + (lang === 'en' ? 'Performance:' : 'à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨:') + '</strong> ' + translatePerformance(performance, lang) + '</p>';
            explanationHTML += '</div>';
            
            feedbackPanel.innerHTML = explanationHTML + '</div>';
            feedbackPanel.classList.add('show');
            
            // Update submit button
            const continueText = gameState.currentLanguage === 'en' ? 'ðŸš€ Continue to Next Mission' : 'ðŸš€ à¤…à¤—à¤²à¥‡ à¤®à¤¿à¤¶à¤¨ à¤ªà¤° à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚';
            document.getElementById('clinic-submit').textContent = continueText;
            document.getElementById('clinic-submit').onclick = () => completeMission('clinic');
        }

        // SCHOOL MISSION
        function loadSchoolMission() {
            protectedStudents = [];
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘¨â€ðŸ«</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">Mr. Joseph Kwame - School Principal</div>
                                <p>"We have 12 students who need protection, but only 7 bed nets available! WHO data shows children under 10 have much higher malaria mortality rates. Please help us prioritize which students to protect based on their age and vulnerability."</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ›¡ï¸ Evidence-Based Student Protection</h3>
                        <p class="challenge-description">Select 7 students to receive bed net protection. Prioritize based on WHO vulnerability data: younger children (under 10) are at highest risk.</p>
                        
                        <div class="student-grid">
                            <div class="student-card high-risk" data-student="0" onclick="toggleStudentProtection(0)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Ama</div>
                                <div class="student-age">Age 8</div>
                            </div>
                            <div class="student-card high-risk" data-student="1" onclick="toggleStudentProtection(1)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Kofi</div>
                                <div class="student-age">Age 9</div>
                            </div>
                            <div class="student-card medium-risk" data-student="2" onclick="toggleStudentProtection(2)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Esi</div>
                                <div class="student-age">Age 10</div>
                            </div>
                            <div class="student-card medium-risk" data-student="3" onclick="toggleStudentProtection(3)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Yaw</div>
                                <div class="student-age">Age 11</div>
                            </div>
                            <div class="student-card low-risk" data-student="4" onclick="toggleStudentProtection(4)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Akua</div>
                                <div class="student-age">Age 12</div>
                            </div>
                            <div class="student-card low-risk" data-student="5" onclick="toggleStudentProtection(5)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Kwame</div>
                                <div class="student-age">Age 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="6" onclick="toggleStudentProtection(6)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Afia</div>
                                <div class="student-age">Age 14</div>
                            </div>
                            <div class="student-card high-risk" data-student="7" onclick="toggleStudentProtection(7)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Kojo</div>
                                <div class="student-age">Age 8</div>
                            </div>
                            <div class="student-card medium-risk" data-student="8" onclick="toggleStudentProtection(8)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Adwoa</div>
                                <div class="student-age">Age 10</div>
                            </div>
                            <div class="student-card high-risk" data-student="9" onclick="toggleStudentProtection(9)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Yaa</div>
                                <div class="student-age">Age 9</div>
                            </div>
                            <div class="student-card low-risk" data-student="10" onclick="toggleStudentProtection(10)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Kweku</div>
                                <div class="student-age">Age 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="11" onclick="toggleStudentProtection(11)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">Akosua</div>
                                <div class="student-age">Age 12</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="school-feedback"></div>
                        <button class="action-btn" id="school-submit" onclick="evaluateSchoolProtection()" disabled>ðŸ›¡ï¸ Implement Protection Plan</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘¨â€ðŸ«</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">à¤¶à¥à¤°à¥€ à¤œà¥‹à¤¸à¥‡à¤« à¤•à¥à¤µà¤¾à¤®à¥‡ - à¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯ à¤ªà¥à¤°à¤¾à¤šà¤¾à¤°à¥à¤¯</div>
                                <p>"à¤¹à¤®à¤¾à¤°à¥‡ à¤ªà¤¾à¤¸ 12 à¤›à¤¾à¤¤à¥à¤° à¤¹à¥ˆà¤‚ à¤œà¤¿à¤¨à¥à¤¹à¥‡à¤‚ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆ, à¤²à¥‡à¤•à¤¿à¤¨ à¤•à¥‡à¤µà¤² 7 à¤®à¤šà¥à¤›à¤°à¤¦à¤¾à¤¨à¥€ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¹à¥ˆà¤‚! WHO à¤¡à¥‡à¤Ÿà¤¾ à¤¦à¤°à¥à¤¶à¤¾à¤¤à¤¾ à¤¹à¥ˆ à¤•à¤¿ 10 à¤µà¤°à¥à¤· à¤¸à¥‡ à¤•à¤® à¤‰à¤®à¥à¤° à¤•à¥‡ à¤¬à¤šà¥à¤šà¥‹à¤‚ à¤®à¥‡à¤‚ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤®à¥ƒà¤¤à¥à¤¯à¥ à¤¦à¤° à¤¬à¤¹à¥à¤¤ à¤…à¤§à¤¿à¤• à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¹à¤®à¤¾à¤°à¥€ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¤°à¥‡à¤‚ à¤¯à¤¹ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾ à¤¤à¤¯ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤•à¤¿ à¤‰à¤¨à¤•à¥€ à¤‰à¤®à¥à¤° à¤”à¤° à¤¸à¤‚à¤µà¥‡à¤¦à¤¨à¤¶à¥€à¤²à¤¤à¤¾ à¤•à¥‡ à¤†à¤§à¤¾à¤° à¤ªà¤° à¤•à¤¿à¤¨ à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥‹ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤¦à¥€ à¤œà¤¾à¤à¥¤"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ›¡ï¸ à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤›à¤¾à¤¤à¥à¤° à¤¸à¤‚à¤°à¤•à¥à¤·à¤£</h3>
                        <p class="challenge-description">à¤®à¤šà¥à¤›à¤°à¤¦à¤¾à¤¨à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ 7 à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¤¾ à¤šà¤¯à¤¨ à¤•à¤°à¥‡à¤‚à¥¤ WHO à¤¸à¤‚à¤µà¥‡à¤¦à¤¨à¤¶à¥€à¤²à¤¤à¤¾ à¤¡à¥‡à¤Ÿà¤¾ à¤•à¥‡ à¤†à¤§à¤¾à¤° à¤ªà¤° à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾ à¤¦à¥‡à¤‚: à¤›à¥‹à¤Ÿà¥‡ à¤¬à¤šà¥à¤šà¥‡ (10 à¤µà¤°à¥à¤· à¤¸à¥‡ à¤•à¤®) à¤‰à¤šà¥à¤šà¤¤à¤® à¤œà¥‹à¤–à¤¿à¤® à¤®à¥‡à¤‚ à¤¹à¥ˆà¤‚à¥¤</p>
                        
                        <div class="student-grid">
                            <div class="student-card high-risk" data-student="0" onclick="toggleStudentProtection(0)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤…à¤®à¤¾</div>
                                <div class="student-age">à¤†à¤¯à¥ 8</div>
                            </div>
                            <div class="student-card high-risk" data-student="1" onclick="toggleStudentProtection(1)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤•à¥‹à¤«à¥€</div>
                                <div class="student-age">à¤†à¤¯à¥ 9</div>
                            </div>
                            <div class="student-card medium-risk" data-student="2" onclick="toggleStudentProtection(2)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤à¤¸à¥€</div>
                                <div class="student-age">à¤†à¤¯à¥ 10</div>
                            </div>
                            <div class="student-card medium-risk" data-student="3" onclick="toggleStudentProtection(3)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤¯à¤¾à¤µ</div>
                                <div class="student-age">à¤†à¤¯à¥ 11</div>
                            </div>
                            <div class="student-card low-risk" data-student="4" onclick="toggleStudentProtection(4)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤…à¤•à¥à¤†</div>
                                <div class="student-age">à¤†à¤¯à¥ 12</div>
                            </div>
                            <div class="student-card low-risk" data-student="5" onclick="toggleStudentProtection(5)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤•à¥à¤µà¤¾à¤®à¥‡</div>
                                <div class="student-age">à¤†à¤¯à¥ 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="6" onclick="toggleStudentProtection(6)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤…à¤«à¤¿à¤¯à¤¾</div>
                                <div class="student-age">à¤†à¤¯à¥ 14</div>
                            </div>
                            <div class="student-card high-risk" data-student="7" onclick="toggleStudentProtection(7)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤•à¥‹à¤œà¥‹</div>
                                <div class="student-age">à¤†à¤¯à¥ 8</div>
                            </div>
                            <div class="student-card medium-risk" data-student="8" onclick="toggleStudentProtection(8)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤…à¤¦à¤µà¥‹à¤†</div>
                                <div class="student-age">à¤†à¤¯à¥ 10</div>
                            </div>
                            <div class="student-card high-risk" data-student="9" onclick="toggleStudentProtection(9)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤¯à¤¾à¤†</div>
                                <div class="student-age">à¤†à¤¯à¥ 9</div>
                            </div>
                            <div class="student-card low-risk" data-student="10" onclick="toggleStudentProtection(10)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤•à¥à¤µà¥‡à¤•à¥‚</div>
                                <div class="student-age">à¤†à¤¯à¥ 13</div>
                            </div>
                            <div class="student-card low-risk" data-student="11" onclick="toggleStudentProtection(11)">
                                <div class="bed-icon">ðŸ›ï¸</div>
                                <div class="student-name">à¤…à¤•à¥‹à¤¸à¥à¤†</div>
                                <div class="student-age">à¤†à¤¯à¥ 12</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="school-feedback"></div>
                        <button class="action-btn" id="school-submit" onclick="evaluateSchoolProtection()" disabled>ðŸ›¡ï¸ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤¯à¥‹à¤œà¤¨à¤¾ à¤²à¤¾à¤—à¥‚ à¤•à¤°à¥‡à¤‚</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Toggle student protection
        function toggleStudentProtection(studentIndex) {
            const studentCard = document.querySelector(`[data-student="${studentIndex}"]`);
            
            if (protectedStudents.includes(studentIndex)) {
                protectedStudents = protectedStudents.filter(s => s !== studentIndex);
                studentCard.classList.remove('protected');
            } else if (protectedStudents.length < 7) {
                protectedStudents.push(studentIndex);
                studentCard.classList.add('protected');
            } else {
                const messages = {
                    en: 'Only 7 bed nets available! Remove protection from another student first.',
                    hi: 'à¤•à¥‡à¤µà¤² 7 à¤®à¤šà¥à¤›à¤°à¤¦à¤¾à¤¨à¥€ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¹à¥ˆà¤‚! à¤ªà¤¹à¤²à¥‡ à¤•à¤¿à¤¸à¥€ à¤…à¤¨à¥à¤¯ à¤›à¤¾à¤¤à¥à¤° à¤¸à¥‡ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤¹à¤Ÿà¤¾à¤à¤‚à¥¤'
                };
                alert(messages[gameState.currentLanguage]);
                return;
            }
            
            document.getElementById('school-submit').disabled = protectedStudents.length !== 7;
        }

        // Evaluate school protection
        function evaluateSchoolProtection() {
            const students = [
                { name: 'Ama', age: 8, risk: 'HIGH' },
                { name: 'Kofi', age: 9, risk: 'HIGH' },
                { name: 'Esi', age: 10, risk: 'MEDIUM' },
                { name: 'Yaw', age: 11, risk: 'MEDIUM' },
                { name: 'Akua', age: 12, risk: 'LOW' },
                { name: 'Kwame', age: 13, risk: 'LOW' },
                { name: 'Afia', age: 14, risk: 'LOW' },
                { name: 'Kojo', age: 8, risk: 'HIGH' },
                { name: 'Adwoa', age: 10, risk: 'MEDIUM' },
                { name: 'Yaa', age: 9, risk: 'HIGH' },
                { name: 'Kweku', age: 13, risk: 'LOW' },
                { name: 'Akosua', age: 12, risk: 'LOW' }
            ];
            
            let highRiskProtected = 0;
            let mediumRiskProtected = 0;
            let lowRiskProtected = 0;
            
            protectedStudents.forEach(index => {
                const student = students[index];
                if (student.age <= 9) highRiskProtected++;
                else if (student.age <= 11) mediumRiskProtected++;
                else lowRiskProtected++;
            });
            
            // Add detailed explanation with WHO evidence
            const schoolFeedback = document.getElementById('school-feedback');
            schoolFeedback.innerHTML = ''; // Clear any existing content first
            
            const lang = gameState.currentLanguage;
            let schoolExplanationHTML = '<div style="margin-top: 1rem;"><h4>' + 
                (lang === 'en' ? 'WHO Evidence-Based Risk Assessment:' : 'WHO à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤œà¥‹à¤–à¤¿à¤® à¤®à¥‚à¤²à¥à¤¯à¤¾à¤‚à¤•à¤¨:') + '</h4>';
            
            schoolExplanationHTML += '<div style="margin: 1rem 0; padding: 1rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid var(--hero-blue);">';
            schoolExplanationHTML += '<h5>' + (lang === 'en' ? 'Protection Priority Analysis:' : 'à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£:') + '</h5>';
            schoolExplanationHTML += '<p>âœ… <strong>' + (lang === 'en' ? 'High-risk students protected (age â‰¤9):' : 'à¤‰à¤šà¥à¤š à¤œà¥‹à¤–à¤¿à¤® à¤µà¤¾à¤²à¥‡ à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ (à¤†à¤¯à¥ â‰¤9):') + '</strong> ' + highRiskProtected + '/4</p>';
            schoolExplanationHTML += '<p>ðŸŸ¡ <strong>' + (lang === 'en' ? 'Medium-risk students protected (age 10-11):' : 'à¤®à¤§à¥à¤¯à¤® à¤œà¥‹à¤–à¤¿à¤® à¤µà¤¾à¤²à¥‡ à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ (à¤†à¤¯à¥ 10-11):') + '</strong> ' + mediumRiskProtected + '/2</p>';
            schoolExplanationHTML += '<p>ðŸ”´ <strong>' + (lang === 'en' ? 'Low-risk students protected (age â‰¥12):' : 'à¤•à¤® à¤œà¥‹à¤–à¤¿à¤® à¤µà¤¾à¤²à¥‡ à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ (à¤†à¤¯à¥ â‰¥12):') + '</strong> ' + lowRiskProtected + '/6</p>';
            schoolExplanationHTML += '</div>';
            
            // Calculate performance and scoring
            let performance, points, lives;
            
            if (highRiskProtected >= 3) {
                performance = 'excellent';
                points = 130;
                lives = 12;
            } else if (highRiskProtected >= 2) {
                performance = 'good';  
                points = 100;
                lives = 9;
            } else if (highRiskProtected >= 1) {
                performance = 'satisfactory';
                points = 70;
                lives = 6;
            } else {
                performance = 'needs-improvement';
                points = 40;
                lives = 3;
            }
            
            // Add final scoring display
            schoolExplanationHTML += '<div style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            schoolExplanationHTML += '<h5>' + (lang === 'en' ? 'Mission Results:' : 'à¤®à¤¿à¤¶à¤¨ à¤ªà¤°à¤¿à¤£à¤¾à¤®:') + '</h5>';
            schoolExplanationHTML += '<p>ðŸ“ˆ <strong>' + (lang === 'en' ? 'Knowledge Points Earned:' : 'à¤…à¤°à¥à¤œà¤¿à¤¤ à¤œà¥à¤žà¤¾à¤¨ à¤…à¤‚à¤•:') + '</strong> ' + points + '</p>';
            schoolExplanationHTML += '<p>ðŸ’š <strong>' + (lang === 'en' ? 'Lives Protected:' : 'à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨:') + '</strong> ' + lives + '</p>';
            schoolExplanationHTML += '<p>ðŸ† <strong>' + (lang === 'en' ? 'Performance:' : 'à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨:') + '</strong> ' + translatePerformance(performance, lang) + '</p>';
            schoolExplanationHTML += '</div></div>';
            
            schoolFeedback.innerHTML = schoolExplanationHTML;
            schoolFeedback.classList.add('show');
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            // Update submit button
            const continueText = gameState.currentLanguage === 'en' ? 'ðŸš€ Continue to Next Mission' : 'ðŸš€ à¤…à¤—à¤²à¥‡ à¤®à¤¿à¤¶à¤¨ à¤ªà¤° à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚';
            document.getElementById('school-submit').textContent = continueText;
            document.getElementById('school-submit').onclick = () => completeMission('school');
        }

        // MARKET MISSION
        function loadMarketMission() {
            selectedEducationMethods = [];
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘µ</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">Elder Akosua - Community Leader</div>
                                <p>"Many vendors are falling ill with malaria, and people are scared. We need effective health education methods to teach prevention without causing panic or blame. What approaches actually change behavior and save lives?"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ“¢ Evidence-Based Health Communication</h3>
                        <p class="challenge-description">Select effective health education methods that build trust and change behavior. Avoid approaches that blame or frighten people.</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-method="demonstrations" onclick="toggleEducationMethod('demonstrations')">
                                <div class="option-name">ðŸŽ­ Live demonstrations of prevention methods</div>
                            </div>
                            <div class="option-card" data-method="visual-aids" onclick="toggleEducationMethod('visual-aids')">
                                <div class="option-name">ðŸ“‹ Clear visual aids and posters</div>
                            </div>
                            <div class="option-card" data-method="community-sessions" onclick="toggleEducationMethod('community-sessions')">
                                <div class="option-name">ðŸ‘¥ Community health education sessions</div>
                            </div>
                            <div class="option-card" data-method="peer-education" onclick="toggleEducationMethod('peer-education')">
                                <div class="option-name">ðŸ¤ Train community members as educators</div>
                            </div>
                            <div class="option-card" data-method="fear-tactics" onclick="toggleEducationMethod('fear-tactics')">
                                <div class="option-name">ðŸ˜± Use scary statistics to motivate</div>
                            </div>
                            <div class="option-card" data-method="blame-approach" onclick="toggleEducationMethod('blame-approach')">
                                <div class="option-name">ðŸ˜  Blame people for getting sick</div>
                            </div>
                            <div class="option-card" data-method="expensive-solutions" onclick="toggleEducationMethod('expensive-solutions')">
                                <div class="option-name">ðŸ’° Only promote costly prevention methods</div>
                            </div>
                            <div class="option-card" data-method="ignore-culture" onclick="toggleEducationMethod('ignore-culture')">
                                <div class="option-name">ðŸš« Ignore local beliefs and practices</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="market-feedback"></div>
                        <button class="action-btn" id="market-submit" onclick="evaluateHealthEducation()" disabled>ðŸ“¢ Launch Education Campaign</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘µ</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">à¤¬à¥à¤œà¥à¤°à¥à¤— à¤…à¤•à¥‹à¤¸à¥à¤† - à¤¸à¤¾à¤®à¥à¤¦à¤¾à¤¯à¤¿à¤• à¤¨à¥‡à¤¤à¤¾</div>
                                <p>"à¤•à¤ˆ à¤µà¤¿à¤•à¥à¤°à¥‡à¤¤à¤¾ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤° à¤ªà¤¡à¤¼ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚, à¤”à¤° à¤²à¥‹à¤— à¤¡à¤°à¥‡ à¤¹à¥à¤ à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤®à¥‡à¤‚ à¤°à¥‹à¤•à¤¥à¤¾à¤® à¤¸à¤¿à¤–à¤¾à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¥à¤°à¤­à¤¾à¤µà¥€ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¶à¤¿à¤•à¥à¤·à¤¾ à¤µà¤¿à¤§à¤¿à¤¯à¥‹à¤‚ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆ à¤¬à¤¿à¤¨à¤¾ à¤˜à¤¬à¤°à¤¾à¤¹à¤Ÿ à¤¯à¤¾ à¤¦à¥‹à¤·à¤¾à¤°à¥‹à¤ªà¤£ à¤•à¥‡à¥¤ à¤•à¥Œà¤¨ à¤¸à¥‡ à¤¦à¥ƒà¤·à¥à¤Ÿà¤¿à¤•à¥‹à¤£ à¤µà¤¾à¤¸à¥à¤¤à¤µ à¤®à¥‡à¤‚ à¤µà¥à¤¯à¤µà¤¹à¤¾à¤° à¤¬à¤¦à¤²à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤”à¤° à¤œà¥€à¤µà¤¨ à¤¬à¤šà¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚?"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ“¢ à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¸à¤‚à¤šà¤¾à¤°</h3>
                        <p class="challenge-description">à¤ªà¥à¤°à¤­à¤¾à¤µà¥€ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¶à¤¿à¤•à¥à¤·à¤¾ à¤µà¤¿à¤§à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤šà¤¯à¤¨ à¤•à¤°à¥‡à¤‚ à¤œà¥‹ à¤µà¤¿à¤¶à¥à¤µà¤¾à¤¸ à¤¬à¤¨à¤¾à¤¤à¥€ à¤¹à¥ˆà¤‚ à¤”à¤° à¤µà¥à¤¯à¤µà¤¹à¤¾à¤° à¤¬à¤¦à¤²à¤¤à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤à¤¸à¥‡ à¤¦à¥ƒà¤·à¥à¤Ÿà¤¿à¤•à¥‹à¤£à¥‹à¤‚ à¤¸à¥‡ à¤¬à¤šà¥‡à¤‚ à¤œà¥‹ à¤²à¥‹à¤—à¥‹à¤‚ à¤•à¥‹ à¤¦à¥‹à¤·à¥€ à¤ à¤¹à¤°à¤¾à¤¤à¥‡ à¤¯à¤¾ à¤¡à¤°à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤</p>
                        
                        <div class="options-grid">
                            <div class="option-card" data-method="demonstrations" onclick="toggleEducationMethod('demonstrations')">
                                <div class="option-name">ðŸŽ­ à¤°à¥‹à¤•à¤¥à¤¾à¤® à¤µà¤¿à¤§à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤ªà¥à¤°à¤¤à¥à¤¯à¤•à¥à¤· à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨</div>
                            </div>
                            <div class="option-card" data-method="visual-aids" onclick="toggleEducationMethod('visual-aids')">
                                <div class="option-name">ðŸ“‹ à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤¦à¥ƒà¤¶à¥à¤¯ à¤¸à¤¹à¤¾à¤¯à¤• à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤”à¤° à¤ªà¥‹à¤¸à¥à¤Ÿà¤°</div>
                            </div>
                            <div class="option-card" data-method="community-sessions" onclick="toggleEducationMethod('community-sessions')">
                                <div class="option-name">ðŸ‘¥ à¤¸à¤¾à¤®à¥à¤¦à¤¾à¤¯à¤¿à¤• à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¶à¤¿à¤•à¥à¤·à¤¾ à¤¸à¤¤à¥à¤°</div>
                            </div>
                            <div class="option-card" data-method="peer-education" onclick="toggleEducationMethod('peer-education')">
                                <div class="option-name">ðŸ¤ à¤¸à¤®à¥à¤¦à¤¾à¤¯à¤¿à¤• à¤¸à¤¦à¤¸à¥à¤¯à¥‹à¤‚ à¤•à¥‹ à¤¶à¤¿à¤•à¥à¤·à¤•à¥‹à¤‚ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤¿à¤¤ à¤•à¤°à¤¨à¤¾</div>
                            </div>
                            <div class="option-card" data-method="fear-tactics" onclick="toggleEducationMethod('fear-tactics')">
                                <div class="option-name">ðŸ˜± à¤ªà¥à¤°à¥‡à¤°à¤¿à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¡à¤°à¤¾à¤µà¤¨à¥‡ à¤†à¤‚à¤•à¤¡à¤¼à¥‹à¤‚ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤—</div>
                            </div>
                            <div class="option-card" data-method="blame-approach" onclick="toggleEducationMethod('blame-approach')">
                                <div class="option-name">ðŸ˜  à¤¬à¥€à¤®à¤¾à¤° à¤¹à¥‹à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤²à¥‹à¤—à¥‹à¤‚ à¤•à¥‹ à¤¦à¥‹à¤·à¥€ à¤ à¤¹à¤°à¤¾à¤¨à¤¾</div>
                            </div>
                            <div class="option-card" data-method="expensive-solutions" onclick="toggleEducationMethod('expensive-solutions')">
                                <div class="option-name">ðŸ’° à¤•à¥‡à¤µà¤² à¤®à¤¹à¤‚à¤—à¥€ à¤°à¥‹à¤•à¤¥à¤¾à¤® à¤µà¤¿à¤§à¤¿à¤¯à¥‹à¤‚ à¤•à¥‹ à¤¬à¤¢à¤¼à¤¾à¤µà¤¾ à¤¦à¥‡à¤¨à¤¾</div>
                            </div>
                            <div class="option-card" data-method="ignore-culture" onclick="toggleEducationMethod('ignore-culture')">
                                <div class="option-name">ðŸš« à¤¸à¥à¤¥à¤¾à¤¨à¥€à¤¯ à¤®à¤¾à¤¨à¥à¤¯à¤¤à¤¾à¤“à¤‚ à¤”à¤° à¤ªà¥à¤°à¤¥à¤¾à¤“à¤‚ à¤•à¥€ à¤…à¤¨à¤¦à¥‡à¤–à¥€</div>
                            </div>
                        </div>
                        
                        <div class="feedback-panel" id="market-feedback"></div>
                        <button class="action-btn" id="market-submit" onclick="evaluateHealthEducation()" disabled>ðŸ“¢ à¤¶à¤¿à¤•à¥à¤·à¤¾ à¤…à¤­à¤¿à¤¯à¤¾à¤¨ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Toggle education method selection
        function toggleEducationMethod(methodId) {
            const methodCard = document.querySelector(`[data-method="${methodId}"]`);
            
            if (selectedEducationMethods.includes(methodId)) {
                selectedEducationMethods = selectedEducationMethods.filter(m => m !== methodId);
                methodCard.classList.remove('selected');
            } else {
                selectedEducationMethods.push(methodId);
                methodCard.classList.add('selected');
            }
            
            document.getElementById('market-submit').disabled = selectedEducationMethods.length === 0;
        }

        // Evaluate health education
        function evaluateHealthEducation() {
            const correctMethods = ['demonstrations', 'visual-aids', 'community-sessions', 'peer-education'];
            const incorrectMethods = ['fear-tactics', 'blame-approach', 'expensive-solutions', 'ignore-culture'];
            
            let correctCount = 0;
            let incorrectCount = 0;
            
            selectedEducationMethods.forEach(methodId => {
                const methodCard = document.querySelector(`[data-method="${methodId}"]`);
                if (correctMethods.includes(methodId)) {
                    methodCard.classList.add('correct');
                    correctCount++;
                } else {
                    methodCard.classList.add('incorrect');
                    incorrectCount++;
                }
            });
            
            // Calculate performance and scoring
            let performance, points, lives;
            
            if (correctCount >= 3 && incorrectCount === 0) {
                performance = 'excellent';
                points = 120;
                lives = 15;
            } else if (correctCount >= 2) {
                performance = 'good';
                points = 90;
                lives = 10;
            } else if (correctCount >= 1) {
                performance = 'satisfactory';
                points = 60;
                lives = 6;
            } else {
                performance = 'needs-improvement';
                points = 30;
                lives = 3;
            }
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            // Add detailed explanation with WHO evidence
            const marketFeedback = document.getElementById('market-feedback');
            const lang = gameState.currentLanguage;
            let marketExplanationHTML = '<div style="margin-top: 1rem;"><h4>' + 
                (lang === 'en' ? 'WHO Evidence-Based Health Communication Analysis:' : 'WHO à¤¸à¤¾à¤•à¥à¤·à¥à¤¯-à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¸à¤‚à¤šà¤¾à¤° à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£:') + '</h4>';
            
            // Add final scoring display
            marketExplanationHTML += '<div style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--victory-green);">';
            marketExplanationHTML += '<h5>' + (lang === 'en' ? 'Mission Results:' : 'à¤®à¤¿à¤¶à¤¨ à¤ªà¤°à¤¿à¤£à¤¾à¤®:') + '</h5>';
            marketExplanationHTML += '<p>ðŸ“ˆ <strong>' + (lang === 'en' ? 'Knowledge Points Earned:' : 'à¤…à¤°à¥à¤œà¤¿à¤¤ à¤œà¥à¤žà¤¾à¤¨ à¤…à¤‚à¤•:') + '</strong> ' + points + '</p>';
            marketExplanationHTML += '<p>ðŸ’š <strong>' + (lang === 'en' ? 'Lives Protected:' : 'à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨:') + '</strong> ' + lives + '</p>';
            marketExplanationHTML += '<p>ðŸ† <strong>' + (lang === 'en' ? 'Performance:' : 'à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨:') + '</strong> ' + translatePerformance(performance, lang) + '</p>';
            marketExplanationHTML += '</div></div>';
            
            marketFeedback.innerHTML = marketExplanationHTML;
            marketFeedback.classList.add('show');
            
            // Update submit button
            const continueText = gameState.currentLanguage === 'en' ? 'ðŸš€ Continue to Next Mission' : 'ðŸš€ à¤…à¤—à¤²à¥‡ à¤®à¤¿à¤¶à¤¨ à¤ªà¤° à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚';
            document.getElementById('market-submit').textContent = continueText;
            document.getElementById('market-submit').onclick = () => completeMission('market');
        }

        // HOMES MISSION - MOSQUITO BREEDING GAME
        function loadHomesMission() {
            foundBreedingSites = [];
            breedingHelpShown = false; // Reset help shown flag for this mission
            breedingAttempts = 0; // Reset attempts counter
            
            const content = {
                en: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">The Mensah Family</div>
                                <p>"Our daughter has developed malaria symptoms, and we keep getting bitten by mosquitoes every night! We suspect they're breeding somewhere around our compound. Please help us identify where the mosquitoes are reproducing so we can eliminate these deadly breeding sites."</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ¦Ÿ Vector Control Challenge</h3>
                        <p class="challenge-description"><strong>Mission:</strong> Find exactly 6 mosquito breeding sites out of 12 locations. Use your scientific knowledge to identify where mosquitoes breed! Remember: mosquitoes need standing water for 7-14 days to breed!</p>
                        
                        <div class="breeding-progress">
                            <div class="progress-item">
                                <span class="progress-number found" id="sites-found">0</span>
                                <div class="progress-label">Sites Found</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number target">6</span>
                                <div class="progress-label">Target Sites</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number score" id="current-score">0</span>
                                <div class="progress-label">Score</div>
                            </div>
                        </div>

                        <div class="compound-container">
                            <div class="compound-title">ðŸ  Mensah Family Compound</div>
                            
                            <!-- Correct breeding sites -->
                            <div class="breeding-site site-1" onclick="checkBreedingSite(event, 'water-barrel', true)">ðŸª£</div>
                            <div class="breeding-site site-2" onclick="checkBreedingSite(event, 'plant-saucers', true)">ðŸª´</div>
                            <div class="breeding-site site-3" onclick="checkBreedingSite(event, 'roof-gutter', true)">ðŸ </div>
                            <div class="breeding-site site-4" onclick="checkBreedingSite(event, 'old-bucket', true)">ðŸª£</div>
                            <div class="breeding-site site-5" onclick="checkBreedingSite(event, 'flower-vase', true)">ðŸº</div>
                            <div class="breeding-site site-6" onclick="checkBreedingSite(event, 'tire-planter', true)">ðŸ›ž</div>
                            
                            <!-- Incorrect sites -->
                            <div class="breeding-site site-7" onclick="checkBreedingSite(event, 'tree-base', false)">ðŸŒ³</div>
                            <div class="breeding-site site-8" onclick="checkBreedingSite(event, 'dry-garden', false)">ðŸŒ¿</div>
                            <div class="breeding-site site-9" onclick="checkBreedingSite(event, 'house-wall', false)">ðŸ§±</div>
                            <div class="breeding-site site-10" onclick="checkBreedingSite(event, 'flowing-drain', false)">ðŸŒŠ</div>
                            <div class="breeding-site site-11" onclick="checkBreedingSite(event, 'solid-pavement', false)">ðŸª¨</div>
                            <div class="breeding-site site-12" onclick="checkBreedingSite(event, 'hanging-clothes', false)">ðŸ‘•</div>
                        </div>

                        <div class="help-panel" id="breeding-help">
                            <div class="help-title">ðŸ”¬ Scientific Guidance</div>
                            <p><strong>Mosquito Biology:</strong> Female Anopheles mosquitoes need clean, standing water that remains undisturbed for 7-14 days to complete their life cycle. Look for containers, puddles, or blocked drainage that can hold water for extended periods.</p>
                            <p><strong>Key Signs:</strong> Water storage containers, flower pot saucers, blocked gutters, abandoned buckets, tire planters with collected water.</p>
                            <p><strong>Not Breeding Sites:</strong> Dry surfaces, flowing water, solid objects without water retention, well-drained areas.</p>
                        </div>
                        
                        <div class="feedback-panel" id="homes-feedback"></div>
                        <button class="action-btn" id="homes-submit" onclick="evaluateVectorControl()" disabled>ðŸ  Complete Vector Control</button>
                    </div>
                `,
                hi: `
                    <div class="mission-intro">
                        <div class="npc-dialogue">
                            <div class="npc-avatar">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦</div>
                            <div class="dialogue-bubble">
                                <div class="npc-name">à¤®à¥‡à¤¨à¥à¤¸à¤¾à¤¹ à¤ªà¤°à¤¿à¤µà¤¾à¤°</div>
                                <p>"à¤¹à¤®à¤¾à¤°à¥€ à¤¬à¥‡à¤Ÿà¥€ à¤®à¥‡à¤‚ à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤²à¤•à¥à¤·à¤£ à¤µà¤¿à¤•à¤¸à¤¿à¤¤ à¤¹à¥‹ à¤—à¤ à¤¹à¥ˆà¤‚, à¤”à¤° à¤¹à¤®à¥‡à¤‚ à¤¹à¤° à¤°à¤¾à¤¤ à¤®à¤šà¥à¤›à¤°à¥‹à¤‚ à¤•à¥‡ à¤•à¤¾à¤Ÿà¤¨à¥‡ à¤•à¤¾ à¤¸à¤¾à¤®à¤¨à¤¾ à¤•à¤°à¤¨à¤¾ à¤ªà¤¡à¤¼à¤¤à¤¾ à¤¹à¥ˆ! à¤¹à¤®à¥‡à¤‚ à¤¸à¤‚à¤¦à¥‡à¤¹ à¤¹à¥ˆ à¤•à¤¿ à¤µà¥‡ à¤¹à¤®à¤¾à¤°à¥‡ à¤ªà¤°à¤¿à¤¸à¤° à¤•à¥‡ à¤†à¤¸à¤ªà¤¾à¤¸ à¤•à¤¹à¥€à¤‚ à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤•à¤° à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¹à¤®à¤¾à¤°à¥€ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¤°à¥‡à¤‚ à¤¯à¤¹ à¤ªà¤¹à¤šà¤¾à¤¨à¤¨à¥‡ à¤®à¥‡à¤‚ à¤•à¤¿ à¤®à¤šà¥à¤›à¤° à¤•à¤¹à¤¾à¤ à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤•à¤° à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚ à¤¤à¤¾à¤•à¤¿ à¤¹à¤® à¤‡à¤¨ à¤˜à¤¾à¤¤à¤• à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤¸à¥à¤¥à¤²à¥‹à¤‚ à¤•à¥‹ à¤¸à¤®à¤¾à¤ªà¥à¤¤ à¤•à¤° à¤¸à¤•à¥‡à¤‚à¥¤"</p>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-section">
                        <h3 class="challenge-title">ðŸ¦Ÿ à¤µà¥‡à¤•à¥à¤Ÿà¤° à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£ à¤šà¥à¤¨à¥Œà¤¤à¥€</h3>
                        <p class="challenge-description"><strong>à¤®à¤¿à¤¶à¤¨:</strong> 12 à¤¸à¥à¤¥à¤¾à¤¨à¥‹à¤‚ à¤®à¥‡à¤‚ à¤¸à¥‡ à¤ à¥€à¤• 6 à¤®à¤šà¥à¤›à¤° à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤¸à¥à¤¥à¤²à¥‹à¤‚ à¤•à¥€ à¤ªà¤¹à¤šà¤¾à¤¨ à¤•à¤°à¥‡à¤‚à¥¤ à¤…à¤ªà¤¨à¥‡ à¤µà¥ˆà¤œà¥à¤žà¤¾à¤¨à¤¿à¤• à¤œà¥à¤žà¤¾à¤¨ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤¬à¤¤à¤¾à¤à¤‚ à¤•à¤¿ à¤®à¤šà¥à¤›à¤° à¤•à¤¹à¤¾à¤ à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚! à¤¯à¤¾à¤¦ à¤°à¤–à¥‡à¤‚: à¤®à¤šà¥à¤›à¤°à¥‹à¤‚ à¤•à¥‹ à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤•à¥‡ à¤²à¤¿à¤ 7-14 à¤¦à¤¿à¤¨à¥‹à¤‚ à¤¤à¤• à¤¸à¥à¤¥à¤¿à¤° à¤ªà¤¾à¤¨à¥€ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆ!</p>
                        
                        <div class="breeding-progress">
                            <div class="progress-item">
                                <span class="progress-number found" id="sites-found">0</span>
                                <div class="progress-label">à¤®à¤¿à¤²à¥‡ à¤¸à¥à¤¥à¤²</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number target">6</span>
                                <div class="progress-label">à¤²à¤•à¥à¤·à¥à¤¯ à¤¸à¥à¤¥à¤²</div>
                            </div>
                            <div class="progress-item">
                                <span class="progress-number score" id="current-score">0</span>
                                <div class="progress-label">à¤¸à¥à¤•à¥‹à¤°</div>
                            </div>
                        </div>

                        <div class="compound-container">
                            <div class="compound-title">ðŸ  à¤®à¥‡à¤¨à¥à¤¸à¤¾à¤¹ à¤ªà¤°à¤¿à¤µà¤¾à¤° à¤ªà¤°à¤¿à¤¸à¤°</div>
                            
                            <!-- Correct breeding sites -->
                            <div class="breeding-site site-1" onclick="checkBreedingSite(event, 'water-barrel', true)">ðŸª£</div>
                            <div class="breeding-site site-2" onclick="checkBreedingSite(event, 'plant-saucers', true)">ðŸª´</div>
                            <div class="breeding-site site-3" onclick="checkBreedingSite(event, 'roof-gutter', true)">ðŸ </div>
                            <div class="breeding-site site-4" onclick="checkBreedingSite(event, 'old-bucket', true)">ðŸª£</div>
                            <div class="breeding-site site-5" onclick="checkBreedingSite(event, 'flower-vase', true)">ðŸº</div>
                            <div class="breeding-site site-6" onclick="checkBreedingSite(event, 'tire-planter', true)">ðŸ›ž</div>
                            
                            <!-- Incorrect sites -->
                            <div class="breeding-site site-7" onclick="checkBreedingSite(event, 'tree-base', false)">ðŸŒ³</div>
                            <div class="breeding-site site-8" onclick="checkBreedingSite(event, 'dry-garden', false)">ðŸŒ¿</div>
                            <div class="breeding-site site-9" onclick="checkBreedingSite(event, 'house-wall', false)">ðŸ§±</div>
                            <div class="breeding-site site-10" onclick="checkBreedingSite(event, 'flowing-drain', false)">ðŸŒŠ</div>
                            <div class="breeding-site site-11" onclick="checkBreedingSite(event, 'solid-pavement', false)">ðŸª¨</div>
                            <div class="breeding-site site-12" onclick="checkBreedingSite(event, 'hanging-clothes', false)">ðŸ‘•</div>
                        </div>

                        <div class="help-panel" id="breeding-help">
                            <div class="help-title">ðŸ”¬ à¤µà¥ˆà¤œà¥à¤žà¤¾à¤¨à¤¿à¤• à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¨</div>
                            <p><strong>à¤®à¤šà¥à¤›à¤° à¤œà¥€à¤µ à¤µà¤¿à¤œà¥à¤žà¤¾à¤¨:</strong> à¤®à¤¾à¤¦à¤¾ à¤à¤¨à¥‹à¤«à¤¿à¤²à¥€à¤œ à¤®à¤šà¥à¤›à¤°à¥‹à¤‚ à¤•à¥‹ à¤…à¤ªà¤¨à¤¾ à¤œà¥€à¤µà¤¨ à¤šà¤•à¥à¤° à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¤¾à¤«, à¤¸à¥à¤¥à¤¿à¤° à¤ªà¤¾à¤¨à¥€ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆ à¤œà¥‹ 7-14 à¤¦à¤¿à¤¨à¥‹à¤‚ à¤¤à¤• à¤…à¤¬à¤¾à¤§à¤¿à¤¤ à¤°à¤¹à¥‡à¥¤ à¤à¤¸à¥‡ à¤ªà¤¾à¤¤à¥à¤°, à¤—à¤¡à¥à¤¢à¥‡, à¤¯à¤¾ à¤…à¤µà¤°à¥à¤¦à¥à¤§ à¤¨à¤¾à¤²à¤¿à¤¯à¥‹à¤‚ à¤•à¥‹ à¤¦à¥‡à¤–à¥‡à¤‚ à¤œà¥‹ à¤²à¤‚à¤¬à¥‡ à¤¸à¤®à¤¯ à¤¤à¤• à¤ªà¤¾à¤¨à¥€ à¤§à¤¾à¤°à¤£ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤</p>
                            <p><strong>à¤®à¥à¤–à¥à¤¯ à¤¸à¤‚à¤•à¥‡à¤¤:</strong> à¤œà¤² à¤­à¤‚à¤¡à¤¾à¤°à¤£ à¤•à¤‚à¤Ÿà¥‡à¤¨à¤°, à¤«à¥‚à¤²à¥‹à¤‚ à¤•à¥‡ à¤—à¤®à¤²à¥‹à¤‚ à¤•à¥€ à¤¤à¤¶à¥à¤¤à¤°à¥€, à¤…à¤µà¤°à¥à¤¦à¥à¤§ à¤¨à¤¾à¤²à¤¿à¤¯à¤¾à¤‚, à¤ªà¤°à¤¿à¤¤à¥à¤¯à¤•à¥à¤¤ à¤¬à¤¾à¤²à¥à¤Ÿà¤¿à¤¯à¤¾à¤‚, à¤œà¤² à¤¸à¤‚à¤—à¥à¤°à¤¹à¤¿à¤¤ à¤Ÿà¤¾à¤¯à¤° à¤ªà¥à¤²à¤¾à¤‚à¤Ÿà¤°à¥¤</p>
                            <p><strong>à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤¸à¥à¤¥à¤² à¤¨à¤¹à¥€à¤‚:</strong> à¤¸à¥‚à¤–à¥€ à¤¸à¤¤à¤¹à¥‡à¤‚, à¤¬à¤¹à¤¤à¤¾ à¤ªà¤¾à¤¨à¥€, à¤œà¤² à¤§à¤¾à¤°à¤£ à¤•à¥‡ à¤¬à¤¿à¤¨à¤¾ à¤ à¥‹à¤¸ à¤µà¤¸à¥à¤¤à¥à¤à¤‚, à¤…à¤šà¥à¤›à¥€ à¤œà¤² à¤¨à¤¿à¤•à¤¾à¤¸à¥€ à¤µà¤¾à¤²à¥‡ à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¥¤</p>
                        </div>
                        
                        <div class="feedback-panel" id="homes-feedback"></div>
                        <button class="action-btn" id="homes-submit" onclick="evaluateVectorControl()" disabled>ðŸ  à¤µà¥‡à¤•à¥à¤Ÿà¤° à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£ à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¥‡à¤‚</button>
                    </div>
                `
            };
            
            document.getElementById('modal-content').innerHTML = content[gameState.currentLanguage];
        }

        // Sound effects
        function playSound(type) {
            // Create audio context for sound effects
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'correct') {
                // Play success sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'incorrect') {
                // Play error sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'complete') {
                // Play completion sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.4);
                oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.6);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            }
        }

        // Particle effects
        function createParticles(x, y, count = 5) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.left = (x + (Math.random() - 0.5) * 20) + 'px';
                particle.style.top = (y + (Math.random() - 0.5) * 20) + 'px';
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }

        // Celebration confetti
        function createCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            document.body.appendChild(celebration);
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                celebration.appendChild(confetti);
            }
            
            setTimeout(() => {
                celebration.remove();
            }, 5000);
        }

        // Check breeding site - show immediate explanation on click
        function checkBreedingSite(evt, siteId, isCorrect) {
            const siteElement = evt.currentTarget;

            if (siteElement.classList.contains('correct') || siteElement.classList.contains('incorrect')) {
                return;
            }

            // Increment attempts counter
            breedingAttempts++;

            if (isCorrect) {
                siteElement.classList.add('correct');
                foundBreedingSites.push(siteId);
                document.getElementById('sites-found').textContent = foundBreedingSites.length;

                // Success sound and particles
                playSound('correct');
                const rect = siteElement.getBoundingClientRect();
                createParticles(rect.left + rect.width/2, rect.top + rect.height/2, 8);

                // Immediate explanation
                const msg = breedingExplanations[siteId]?.correct || 'Correct: this retains standing water.';
                showExplanation(siteElement, `âœ… ${msg}`, 'success');

                // Update score
                const currentScore = foundBreedingSites.length * 10;
                document.getElementById('current-score').textContent = currentScore;

                if (foundBreedingSites.length >= 6) {
                    document.getElementById('homes-submit').disabled = false;
                    playSound('complete');
                    createCelebration();
                }
            } else {
                siteElement.classList.add('incorrect');
                playSound('incorrect');

                // Immediate explanation
                const msg = breedingExplanations[siteId]?.wrong || 'Not a breeding site: no standing water present.';
                showExplanation(siteElement, `âŒ ${msg}`, 'error');

                // Reveal help panel on first mistake
                if (!breedingHelpShown) {
                    document.getElementById('breeding-help').classList.add('show');
                    breedingHelpShown = true;
                }
            }
        }

        // Evaluate vector control
        function evaluateVectorControl() {
            let performance, points, lives;
            
            // Calculate base points based on sites found
            let basePoints = 0;
            let baseLives = 0;
            
            if (foundBreedingSites.length >= 6) {
                performance = 'excellent';
                basePoints = 300;
                baseLives = 20;
            } else if (foundBreedingSites.length >= 5) {
                performance = 'good';
                basePoints = 200;
                baseLives = 15;
            } else if (foundBreedingSites.length >= 4) {
                performance = 'satisfactory';
                basePoints = 150;
                baseLives = 10;
            } else {
                performance = 'needs-improvement';
                basePoints = 100;
                baseLives = 5;
            }
            
            // Apply penalty for too many attempts
            let attemptPenalty = 0;
            if (breedingAttempts > 12) {
                attemptPenalty = Math.floor((breedingAttempts - 12) * 5); // 5 points penalty per extra attempt
                performance = 'needs-improvement'; // Downgrade performance if too many attempts
            } else if (breedingAttempts > 8) {
                attemptPenalty = Math.floor((breedingAttempts - 8) * 3); // 3 points penalty per extra attempt
                if (performance === 'excellent') performance = 'good';
            }
            
            // Calculate final points and lives
            points = Math.max(0, basePoints - attemptPenalty);
            lives = Math.max(1, baseLives - Math.floor(attemptPenalty / 10)); // Reduce lives based on penalty
            
            gameState.knowledgePoints += points;
            gameState.livesProtected += lives;
            updateStats();
            
            const homesFeedback = document.getElementById('homes-feedback');
            const lang = gameState.currentLanguage;
            homesFeedback.innerHTML = `
                <div style="margin-top: 1rem;">
                    <h4>${lang === 'en' ? 'Mosquito Breeding Game Results:' : 'à¤®à¤šà¥à¤›à¤° à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤–à¥‡à¤² à¤ªà¤°à¤¿à¤£à¤¾à¤®:'}</h4>
                    <p>âœ… ${lang === 'en' ? 'Breeding sites found:' : 'à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤¸à¥à¤¥à¤² à¤®à¤¿à¤²à¥‡:'} ${foundBreedingSites.length}/6</p>
                    <p>ðŸŽ¯ ${lang === 'en' ? 'Total attempts:' : 'à¤•à¥à¤² à¤ªà¥à¤°à¤¯à¤¾à¤¸:'} ${breedingAttempts}</p>
                    <p>ðŸ† ${lang === 'en' ? 'Performance:' : 'à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨:'} ${translatePerformance(performance, lang)}</p>
                    <p>ðŸ“ˆ ${lang === 'en' ? 'Points earned:' : 'à¤…à¤°à¥à¤œà¤¿à¤¤ à¤…à¤‚à¤•:'} ${points} ${attemptPenalty > 0 ? `(${lang === 'en' ? 'penalty applied' : 'à¤œà¥à¤°à¥à¤®à¤¾à¤¨à¤¾ à¤²à¤—à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾'})` : ''}</p>
                    <p>ðŸ’š ${lang === 'en' ? 'Lives protected:' : 'à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤œà¥€à¤µà¤¨:'} ${lives}</p>
                </div>
            `;
            homesFeedback.classList.add('show');
            
            const completeText = gameState.currentLanguage === 'en' ? 'ðŸ End Mission' : 'ðŸ à¤®à¤¿à¤¶à¤¨ à¤¸à¤®à¤¾à¤ªà¥à¤¤';
            document.getElementById('homes-submit').textContent = completeText;
            document.getElementById('homes-submit').onclick = () => completeMission('homes');
        }

        // Complete mission
        function completeMission(missionId) {
            gameState.completedMissions.push(missionId);
            gameState.missionsCompleted++;
            
            // Mark location as completed
            const location = document.getElementById(missionId + '-location') || document.querySelector('.' + missionId);
            location.classList.add('completed');
            location.classList.remove('disabled');
            
            closeMissionModal();
            
            // Enable next location
            const sequence = ['clinic', 'school', 'market', 'homes'];
            const currentIndex = sequence.indexOf(missionId);
            
            if (currentIndex < sequence.length - 1) {
                const nextMission = sequence[currentIndex + 1];
                const nextLocation = document.getElementById(nextMission + '-location');
                if (nextLocation) {
                    nextLocation.classList.remove('disabled');
                    const badge = nextLocation.querySelector('.priority-badge');
                    if (badge) badge.style.display = 'flex';
                }
                
                // Update mission text
                const missionTexts = {
                    en: {
                        school: 'Protect vulnerable students at the Village School with limited bed nets!',
                        market: 'Educate the community at the Market with effective health communication!',
                        homes: 'Eliminate deadly mosquito breeding sites in the Family Compounds!'
                    },
                    hi: {
                        school: 'à¤¸à¥€à¤®à¤¿à¤¤ à¤®à¤šà¥à¤›à¤°à¤¦à¤¾à¤¨à¥€ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤—à¤¾à¤‚à¤µ à¤•à¥‡ à¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯ à¤®à¥‡à¤‚ à¤¸à¤‚à¤µà¥‡à¤¦à¤¨à¤¶à¥€à¤² à¤›à¤¾à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤•à¤°à¥‡à¤‚!',
                        market: 'à¤ªà¥à¤°à¤­à¤¾à¤µà¥€ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤¸à¤‚à¤šà¤¾à¤° à¤•à¥‡ à¤¸à¤¾à¤¥ à¤¬à¤¾à¤œà¤¾à¤° à¤®à¥‡à¤‚ à¤¸à¤®à¥à¤¦à¤¾à¤¯ à¤•à¥‹ à¤¶à¤¿à¤•à¥à¤·à¤¿à¤¤ à¤•à¤°à¥‡à¤‚!',
                        homes: 'à¤ªà¤¾à¤°à¤¿à¤µà¤¾à¤°à¤¿à¤• à¤ªà¤°à¤¿à¤¸à¤°à¥‹à¤‚ à¤®à¥‡à¤‚ à¤˜à¤¾à¤¤à¤• à¤®à¤šà¥à¤›à¤° à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤¸à¥à¤¥à¤²à¥‹à¤‚ à¤•à¥‹ à¤¸à¤®à¤¾à¤ªà¥à¤¤ à¤•à¤°à¥‡à¤‚!'
                    }
                };
                
                const textElement = gameState.currentLanguage === 'en' ? 
                    document.getElementById('current-mission-text') : 
                    document.getElementById('current-mission-text-hi');
                
                if (textElement && missionTexts[gameState.currentLanguage][nextMission]) {
                    textElement.textContent = missionTexts[gameState.currentLanguage][nextMission];
                }
            } else {
                // All missions complete
                const completeTexts = {
                    en: 'All missions completed! You are a Malaria Hero! ðŸŽ‰',
                    hi: 'à¤¸à¤­à¥€ à¤®à¤¿à¤¶à¤¨ à¤ªà¥‚à¤°à¥à¤£! à¤†à¤ª à¤à¤• à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤µà¥€à¤° à¤¹à¥ˆà¤‚! ðŸŽ‰'
                };
                
                const textElement = gameState.currentLanguage === 'en' ? 
                    document.getElementById('current-mission-text') : 
                    document.getElementById('current-mission-text-hi');
                
                if (textElement) {
                    textElement.textContent = completeTexts[gameState.currentLanguage];
                }
                
                setTimeout(() => {
                    showGameCompletion();
                }, 2000);
            }
            
            updateStats();
        }

        // Show game completion
        function showGameCompletion() {
            console.log('showGameCompletion called');
            console.log('Lives protected:', gameState.livesProtected);
            console.log('Knowledge points:', gameState.knowledgePoints);
            
            const finalLives = document.getElementById('final-lives');
            const finalPoints = document.getElementById('final-points');
            const finalLivesHi = document.getElementById('final-lives-hi');
            const finalPointsHi = document.getElementById('final-points-hi');
            const completionModal = document.getElementById('completion-modal');
            
            if (finalLives) finalLives.textContent = gameState.livesProtected;
            if (finalPoints) finalPoints.textContent = gameState.knowledgePoints;
            if (finalLivesHi) finalLivesHi.textContent = gameState.livesProtected;
            if (finalPointsHi) finalPointsHi.textContent = gameState.knowledgePoints;
            
            if (completionModal) {
                console.log('Adding active class to completion modal');
                completionModal.classList.add('active');
            } else {
                console.error('Completion modal element not found!');
            }
        }

        // FIXED: Certificate functions work properly now
        function showCertificateModal() {
            document.getElementById('certificate-modal').style.display = 'flex';
            document.getElementById('certificate-modal').classList.add('active');
            const today = new Date().toLocaleDateString();
            document.getElementById('certificate-date').textContent = today;
            document.getElementById('certificate-date-hi').textContent = today;
        }
        
        function closeCertificateModal() {
            document.getElementById('certificate-modal').style.display = 'none';
            document.getElementById('certificate-modal').classList.remove('active');
        }
        
        function generateCertificate() {
            const nameInputEn = document.getElementById('player-name-input');
            const nameInputHi = document.getElementById('player-name-input-hi');
            const nameInput = gameState.currentLanguage === 'en' ? nameInputEn : nameInputHi;
            const name = nameInput.value.trim() || (gameState.currentLanguage === 'en' ? 'Malaria Hero' : 'à¤®à¤²à¥‡à¤°à¤¿à¤¯à¤¾ à¤µà¥€à¤°');
            
            document.getElementById('certificate-name').textContent = name;
            document.getElementById('certificate-name-hi').textContent = name;
            document.getElementById('certificate-lives').textContent = gameState.livesProtected;
            document.getElementById('certificate-points').textContent = gameState.knowledgePoints;
            
            const successMessage = gameState.currentLanguage === 'en' ? 
                'ðŸŽ“ Certificate generated! Click "Download PNG" to save it to your device.' :
                'ðŸŽ“ à¤ªà¥à¤°à¤®à¤¾à¤£à¤ªà¤¤à¥à¤° à¤¤à¥ˆà¤¯à¤¾à¤°! à¤…à¤ªà¤¨à¥‡ à¤¡à¤¿à¤µà¤¾à¤‡à¤¸ à¤®à¥‡à¤‚ à¤¸à¤¹à¥‡à¤œà¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ "PNG à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚" à¤ªà¤° à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚à¥¤';
            alert(successMessage);
        }
        
        function downloadCertificate() {
            const certificate = document.getElementById('certificate-container');
            
            if (window.html2canvas) {
                html2canvas(certificate, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'Malaria-Heroes-Certificate.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    const successMessage = gameState.currentLanguage === 'en' ? 
                        'ðŸ“¥ Certificate downloaded successfully!' :
                        'ðŸ“¥ à¤ªà¥à¤°à¤®à¤¾à¤£à¤ªà¤¤à¥à¤° à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤¹à¥‹ à¤—à¤¯à¤¾!';
                    alert(successMessage);
                }).catch(error => {
                    console.error('Certificate download failed:', error);
                    const errorMessage = gameState.currentLanguage === 'en' ? 
                        'ðŸ“· Certificate download failed. Please take a screenshot manually.' :
                        'ðŸ“· à¤ªà¥à¤°à¤®à¤¾à¤£à¤ªà¤¤à¥à¤° à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤…à¤¸à¤«à¤²à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤®à¥ˆà¤¨à¥à¤¯à¥à¤…à¤² à¤°à¥‚à¤ª à¤¸à¥‡ à¤¸à¥à¤•à¥à¤°à¥€à¤¨à¤¶à¥‰à¤Ÿ à¤²à¥‡à¤‚à¥¤';
                    alert(errorMessage);
                });
            } else {
                const errorMessage = gameState.currentLanguage === 'en' ? 
                    'ðŸ“· Screenshot feature not available. Please take a screenshot manually.' :
                    'ðŸ“· à¤¸à¥à¤•à¥à¤°à¥€à¤¨à¤¶à¥‰à¤Ÿ à¤¸à¥à¤µà¤¿à¤§à¤¾ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥€à¤‚à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤®à¥ˆà¤¨à¥à¤¯à¥à¤…à¤² à¤°à¥‚à¤ª à¤¸à¥‡ à¤¸à¥à¤•à¥à¤°à¥€à¤¨à¤¶à¥‰à¤Ÿ à¤²à¥‡à¤‚à¥¤';
                alert(errorMessage);
            }
        }

        // Restart game
        function restartGame() {
            // Reset all game state
            gameState = {
                currentLanguage: gameState.currentLanguage, // Preserve language choice
                livesProtected: 0,
                knowledgePoints: 0,
                missionsCompleted: 0,
                currentMission: 'clinic',
                completedMissions: []
            };
            
            selectedSymptoms = [];
            protectedStudents = [];
            selectedEducationMethods = [];
            foundBreedingSites = [];
            breedingHelpShown = false;
            
            // Reset UI
            document.getElementById('completion-modal').classList.remove('active');
            
            // Reset locations
            document.querySelectorAll('.location').forEach(location => {
                location.classList.remove('completed');
                if (!location.classList.contains('clinic')) {
                    location.classList.add('disabled');
                    const badge = location.querySelector('.priority-badge');
                    if (badge) badge.style.display = 'none';
                }
            });
            
            const initialTexts = {
                en: 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!',
                hi: 'à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤•à¥à¤²à¤¿à¤¨à¤¿à¤• à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤œà¤¹à¤¾à¤‚ à¤à¤• à¤—à¤‚à¤­à¥€à¤° à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤° 8 à¤µà¤°à¥à¤·à¥€à¤¯ à¤°à¥‹à¤—à¥€ à¤•à¥‹ à¤¤à¤¤à¥à¤•à¤¾à¤² à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤¨à¤¿à¤¦à¤¾à¤¨ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤œà¥€à¤µà¤¨ à¤†à¤ªà¤•à¥€ à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤žà¤¤à¤¾ à¤ªà¤° à¤¨à¤¿à¤°à¥à¤­à¤° à¤¹à¥ˆ!'
            };
            
            const textElement = gameState.currentLanguage === 'en' ? 
                document.getElementById('current-mission-text') : 
                document.getElementById('current-mission-text-hi');
            
            if (textElement) {
                textElement.textContent = initialTexts[gameState.currentLanguage];
            }
            
            updateStats();
        }

        // Reset game completely (for GitHub hosting issues)
        function resetGame() {
            // Clear all localStorage
            localStorage.removeItem('malariaHeroesProgress');
            localStorage.removeItem('malariaHeroesTutorialComplete');
            
            // Reset game state
            gameState = {
                currentLanguage: gameState.currentLanguage, // Preserve language choice
                livesProtected: 0,
                knowledgePoints: 0,
                missionsCompleted: 0,
                currentMission: 'clinic',
                completedMissions: []
            };
            
            // Reset mission tracking variables
            selectedSymptoms = [];
            protectedStudents = [];
            selectedEducationMethods = [];
            foundBreedingSites = [];
            breedingHelpShown = false;
            breedingAttempts = 0;
            
            // Reset UI
            document.getElementById('completion-modal').classList.remove('active');
            
            // Reset locations
            document.querySelectorAll('.location').forEach(location => {
                location.classList.remove('completed');
                if (!location.classList.contains('clinic')) {
                    location.classList.add('disabled');
                    const badge = location.querySelector('.priority-badge');
                    if (badge) badge.style.display = 'none';
                }
            });
            
            // Reset mission text
            const initialTexts = {
                en: 'Visit the Emergency Clinic where a critically ill 8-year-old patient needs immediate medical diagnosis. Lives depend on your expertise!',
                hi: 'à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤•à¥à¤²à¤¿à¤¨à¤¿à¤• à¤®à¥‡à¤‚ à¤œà¤¾à¤à¤‚ à¤œà¤¹à¤¾à¤‚ à¤à¤• à¤—à¤‚à¤­à¥€à¤° à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤° 8 à¤µà¤°à¥à¤·à¥€à¤¯ à¤°à¥‹à¤—à¥€ à¤•à¥‹ à¤¤à¤¤à¥à¤•à¤¾à¤² à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤¾ à¤¨à¤¿à¤¦à¤¾à¤¨ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤œà¥€à¤µà¤¨ à¤†à¤ªà¤•à¥€ à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤žà¤¤à¤¾ à¤ªà¤° à¤¨à¤¿à¤°à¥à¤­à¤° à¤¹à¥ˆ!'
            };
            
            const textElement = gameState.currentLanguage === 'en' ? 
                document.getElementById('current-mission-text') : 
                document.getElementById('current-mission-text-hi');
            
            if (textElement) {
                textElement.textContent = initialTexts[gameState.currentLanguage];
            }
            
            // Update stats and UI
            updateStats();
            updateUI();
            
            // Show tutorial
            setTimeout(() => {
                startTutorial();
            }, 500);
            
            console.log('Game reset successfully');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            console.log('ðŸŒ Malaria Heroes - Professional Edition Loaded!');
            console.log('ðŸ“Š Latest WHO 2024 Statistics: 597,000 deaths, 263 million cases');
            console.log('ðŸ¦Ÿ Vector Control Challenge: 3 wrong attempts max');
            console.log('ðŸ‡®ðŸ‡³ Bilingual Support: Accurate Hindi translations');
        });
    </script>
</body>
</html>
